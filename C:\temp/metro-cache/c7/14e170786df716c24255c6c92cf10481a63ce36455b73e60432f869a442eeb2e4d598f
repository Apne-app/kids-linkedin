{"dependencies":[{"name":"../util/class","data":{"isAsync":false}},{"name":"../util/uri","data":{"isAsync":false}},{"name":"../util/copy_object","data":{"isAsync":false}},{"name":"../util/assign","data":{"isAsync":false}},{"name":"../mixins/deferrable","data":{"isAsync":false}},{"name":"./transport","data":{"isAsync":false}},{"name":"./xhr","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){'use strict';var t=r(d[0]),n=r(d[1]),s=r(d[2]),c=r(d[3]),o=r(d[4]),u=r(d[5]),l=r(d[6]),h=c(t(u,{initialize:function(t,c){if(u.prototype.initialize.call(this,t,c),!g.EventSource)return this.setDeferredStatus('failed');this._xhr=new l(t,c),(c=s(c)).pathname+='/'+t.clientId;var o=new g.EventSource(n.stringify(c)),h=this;o.onopen=function(){h._everConnected=!0,h.setDeferredStatus('succeeded')},o.onerror=function(){h._everConnected?h._handleError([]):(h.setDeferredStatus('failed'),o.close())},o.onmessage=function(t){var n;try{n=JSON.parse(t.data)}catch(t){}n?h._receive(n):h._handleError([])},this._socket=o},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(t,n){this.callback(function(){t.call(n,!0)}),this.errback(function(){t.call(n,!1)})},encode:function(t){return this._xhr.encode(t)},request:function(t){return this._xhr.request(t)}}),{isUsable:function(t,n,s,c){if(!t.clientId)return s.call(c,!1);l.isUsable(t,n,function(o){if(!o)return s.call(c,!1);this.create(t,n).isUsable(s,c)},this)},create:function(t,c){var o=t.transports.eventsource=t.transports.eventsource||{},u=t.clientId,l=s(c);return l.pathname+='/'+(u||''),o[l=n.stringify(l)]=o[l]||new this(t,c),o[l]}});c(h.prototype,o),m.exports=h});","lineCount":1,"map":[[1,28,1,0],[1,41,3,0],[1,45,3,4,"Class"],[1,47,3,17,"require"],[1,49,3,24,"d"],[1,51,3,24],[1,55,4,4,"URI"],[1,57,4,17,"require"],[1,59,4,24,"d"],[1,61,4,24],[1,65,5,4,"copyObject"],[1,67,5,17,"require"],[1,69,5,24,"d"],[1,71,5,24],[1,75,6,4,"assign"],[1,77,6,17,"require"],[1,79,6,24,"d"],[1,81,6,24],[1,85,7,4,"Deferrable"],[1,87,7,17,"require"],[1,89,7,24,"d"],[1,91,7,24],[1,95,8,4,"Transport"],[1,97,8,17,"require"],[1,99,8,24,"d"],[1,101,8,24],[1,105,9,4,"XHR"],[1,107,9,17,"require"],[1,109,9,24,"d"],[1,111,9,24],[1,115,11,4,"EventSource"],[1,117,11,18,"assign"],[1,119,11,25,"Class"],[1,121,11,31,"Transport"],[1,124,12,2,"initialize"],[1,135,12,14],[1,144,12,23,"dispatcher"],[1,146,12,35,"endpoint"],[1,149,14,4],[1,152,13,4,"Transport"],[1,154,13,14,"prototype"],[1,164,13,24,"initialize"],[1,175,13,35,"call"],[1,180,13,40,"this"],[1,185,13,46,"dispatcher"],[1,187,13,58,"endpoint"],[1,191,14,9,"global"],[1,193,14,16,"EventSource"],[1,205,14,29],[1,212,14,36,"this"],[1,217,14,41,"setDeferredStatus"],[1,235,14,59],[1,245,16,4,"this"],[1,250,16,9,"_xhr"],[1,255,16,16],[1,259,16,20,"XHR"],[1,261,16,24,"dispatcher"],[1,263,16,36,"endpoint"],[1,267,18,4,"endpoint"],[1,269,18,15,"copyObject"],[1,271,18,26,"endpoint"],[1,275,19,13,"pathname"],[1,285,19,25],[1,289,19,31,"dispatcher"],[1,291,19,42,"clientId"],[1,300,21,4],[1,304,21,8,"socket"],[1,306,21,17],[1,310,21,21,"global"],[1,312,21,28,"EventSource"],[1,324,21,40,"URI"],[1,326,21,44,"stringify"],[1,336,21,54,"endpoint"],[1,340,22,8,"self"],[1,342,22,17,"this"],[1,347,24,4,"socket"],[1,349,24,11,"onopen"],[1,356,24,20],[1,367,25,6,"self"],[1,369,25,11,"_everConnected"],[1,385,25,28],[1,387,26,6,"self"],[1,389,26,11,"setDeferredStatus"],[1,407,26,29],[1,421,29,4,"socket"],[1,423,29,11,"onerror"],[1,431,29,21],[1,442,30,10,"self"],[1,444,30,15,"_everConnected"],[1,459,31,8,"self"],[1,461,31,13,"_handleError"],[1,479,33,8,"self"],[1,481,33,13,"setDeferredStatus"],[1,499,33,31],[1,509,34,8,"socket"],[1,511,34,15,"close"],[1,521,38,4,"socket"],[1,523,38,11,"onmessage"],[1,533,38,23],[1,542,38,32,"event"],[1,545,39,6],[1,549,39,10,"replies"],[1,551,40,6],[1,555,40,12,"replies"],[1,557,40,22,"JSON"],[1,562,40,27,"parse"],[1,568,40,33,"event"],[1,570,40,39,"data"],[1,576,40,47],[1,582,40,54,"error"],[1,586,42,10,"replies"],[1,588,43,8,"self"],[1,590,43,13,"_receive"],[1,599,43,22,"replies"],[1,602,45,8,"self"],[1,604,45,13,"_handleError"],[1,622,48,4,"this"],[1,627,48,9,"_socket"],[1,635,48,19,"socket"],[1,638,51,2,"close"],[1,644,51,9],[1,655,52,9,"this"],[1,660,52,14,"_socket"],[1,670,53,4,"this"],[1,675,53,9,"_socket"],[1,683,53,17,"onopen"],[1,690,53,26,"this"],[1,695,53,31,"_socket"],[1,703,53,39,"onerror"],[1,711,53,49,"this"],[1,716,53,54,"_socket"],[1,724,53,62,"onmessage"],[1,734,53,74],[1,739,54,4,"this"],[1,744,54,9,"_socket"],[1,752,54,17,"close"],[1,767,55,11,"this"],[1,772,55,16,"_socket"],[1,782,58,2,"isUsable"],[1,791,58,12],[1,800,58,21,"callback"],[1,802,58,31,"context"],[1,805,59,4,"this"],[1,810,59,9,"callback"],[1,819,59,18],[1,830,59,31,"callback"],[1,832,59,40,"call"],[1,837,59,45,"context"],[1,840,59,54],[1,845,60,4,"this"],[1,850,60,9,"errback"],[1,858,60,17],[1,869,60,30,"callback"],[1,871,60,39,"call"],[1,876,60,44,"context"],[1,879,60,53],[1,885,63,2,"encode"],[1,892,63,10],[1,901,63,19,"messages"],[1,904,64,4],[1,911,64,11,"this"],[1,916,64,16,"_xhr"],[1,921,64,21,"encode"],[1,928,64,28,"messages"],[1,932,67,2,"request"],[1,940,67,11],[1,949,67,20,"messages"],[1,952,68,4],[1,959,68,11,"this"],[1,964,68,16,"_xhr"],[1,969,68,21,"request"],[1,977,68,29,"messages"],[1,984,72,2,"isUsable"],[1,993,72,12],[1,1002,72,21,"dispatcher"],[1,1004,72,33,"endpoint"],[1,1006,72,43,"callback"],[1,1008,72,53,"context"],[1,1011,74,4],[1,1015,73,13,"dispatcher"],[1,1017,73,24,"clientId"],[1,1026,74,13],[1,1033,74,20,"callback"],[1,1035,74,29,"call"],[1,1040,74,34,"context"],[1,1043,74,43],[1,1046,76,4,"XHR"],[1,1048,76,8,"isUsable"],[1,1057,76,17,"dispatcher"],[1,1059,76,29,"endpoint"],[1,1061,76,39],[1,1070,76,48,"usable"],[1,1073,77,6],[1,1077,77,11,"usable"],[1,1079,77,19],[1,1086,77,26,"callback"],[1,1088,77,35,"call"],[1,1093,77,40,"context"],[1,1096,77,49],[1,1099,78,6,"this"],[1,1104,78,11,"create"],[1,1111,78,18,"dispatcher"],[1,1113,78,30,"endpoint"],[1,1116,78,40,"isUsable"],[1,1125,78,49,"callback"],[1,1127,78,59,"context"],[1,1131,79,7,"this"],[1,1138,82,2,"create"],[1,1145,82,10],[1,1154,82,19,"dispatcher"],[1,1156,82,31,"endpoint"],[1,1159,83,4],[1,1163,83,8,"sockets"],[1,1165,83,18,"dispatcher"],[1,1167,83,29,"transports"],[1,1178,83,40,"eventsource"],[1,1190,83,54,"dispatcher"],[1,1192,83,65,"transports"],[1,1203,83,76,"eventsource"],[1,1219,84,8,"id"],[1,1221,84,18,"dispatcher"],[1,1223,84,29,"clientId"],[1,1232,86,8,"url"],[1,1234,86,14,"copyObject"],[1,1236,86,25,"endpoint"],[1,1239,91,4],[1,1246,87,4,"url"],[1,1248,87,8,"pathname"],[1,1258,87,20],[1,1263,87,27,"id"],[1,1266,87,33],[1,1270,90,4,"sockets"],[1,1272,88,4,"url"],[1,1274,88,10,"URI"],[1,1276,88,14,"stringify"],[1,1286,88,24,"url"],[1,1290,90,19,"sockets"],[1,1292,90,27,"url"],[1,1296,90,35],[1,1300,90,39,"this"],[1,1305,90,44,"dispatcher"],[1,1307,90,56,"endpoint"],[1,1310,91,11,"sockets"],[1,1312,91,19,"url"],[1,1318,95,0,"assign"],[1,1320,95,7,"EventSource"],[1,1322,95,19,"prototype"],[1,1332,95,30,"Deferrable"],[1,1335,97,0,"module"],[1,1337,97,7,"exports"],[1,1345,97,17,"EventSource"]],"functionMap":{"names":["<global>","Class$argument_1.initialize","socket.onopen","socket.onerror","socket.onmessage","Class$argument_1.close","Class$argument_1.isUsable","callback$argument_0","errback$argument_0","Class$argument_1.encode","Class$argument_1.request","assign$argument_1.isUsable","XHR.isUsable$argument_2","assign$argument_1.create"],"mappings":"AAA;cCW;oBCY;KDG;qBEE;KFO;uBGE;KHQ;GDG;SKE;GLK;YME;kBCC,2CD;iBEC,4CF;GNC;USE;GTE;WUE;GVE;YWG;uCCI;KDG;GXC;UaE;GbU"}},"type":"js/module"}]}