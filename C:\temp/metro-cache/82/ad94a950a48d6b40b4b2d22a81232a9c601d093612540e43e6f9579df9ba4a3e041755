{"dependencies":[{"name":"../util/class","data":{"isAsync":false,"locs":[{"start":{"line":3,"column":17},"end":{"line":3,"column":41}}]}},{"name":"../util/uri","data":{"isAsync":false,"locs":[{"start":{"line":4,"column":17},"end":{"line":4,"column":39}}]}},{"name":"../util/copy_object","data":{"isAsync":false,"locs":[{"start":{"line":5,"column":17},"end":{"line":5,"column":47}}]}},{"name":"../util/assign","data":{"isAsync":false,"locs":[{"start":{"line":6,"column":17},"end":{"line":6,"column":42}}]}},{"name":"../util/to_json","data":{"isAsync":false,"locs":[{"start":{"line":7,"column":17},"end":{"line":7,"column":43}}]}},{"name":"./transport","data":{"isAsync":false,"locs":[{"start":{"line":8,"column":17},"end":{"line":8,"column":39}}]}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var Class = _$$_REQUIRE(_dependencyMap[0], \"../util/class\"),\n      URI = _$$_REQUIRE(_dependencyMap[1], \"../util/uri\"),\n      copyObject = _$$_REQUIRE(_dependencyMap[2], \"../util/copy_object\"),\n      assign = _$$_REQUIRE(_dependencyMap[3], \"../util/assign\"),\n      toJSON = _$$_REQUIRE(_dependencyMap[4], \"../util/to_json\"),\n      Transport = _$$_REQUIRE(_dependencyMap[5], \"./transport\");\n\n  var JSONP = assign(Class(Transport, {\n    encode: function encode(messages) {\n      var url = copyObject(this.endpoint);\n      url.query.message = toJSON(messages);\n      url.query.jsonp = '__jsonp' + JSONP._cbCount + '__';\n      return URI.stringify(url);\n    },\n    request: function request(messages) {\n      var head = document.getElementsByTagName('head')[0],\n          script = document.createElement('script'),\n          callbackName = JSONP.getCallbackName(),\n          endpoint = copyObject(this.endpoint),\n          self = this;\n      endpoint.query.message = toJSON(messages);\n      endpoint.query.jsonp = callbackName;\n\n      var cleanup = function cleanup() {\n        if (!global[callbackName]) return false;\n        global[callbackName] = undefined;\n\n        try {\n          delete global[callbackName];\n        } catch (error) {}\n\n        script.parentNode.removeChild(script);\n      };\n\n      global[callbackName] = function (replies) {\n        cleanup();\n\n        self._receive(replies);\n      };\n\n      script.type = 'text/javascript';\n      script.src = URI.stringify(endpoint);\n      head.appendChild(script);\n\n      script.onerror = function () {\n        cleanup();\n\n        self._handleError(messages);\n      };\n\n      return {\n        abort: cleanup\n      };\n    }\n  }), {\n    _cbCount: 0,\n    getCallbackName: function getCallbackName() {\n      this._cbCount += 1;\n      return '__jsonp' + this._cbCount + '__';\n    },\n    isUsable: function isUsable(dispatcher, endpoint, callback, context) {\n      callback.call(context, true);\n    }\n  });\n  module.exports = JSONP;\n});","lineCount":69,"map":[[2,0,1,0],[4,0,3,0],[4,6,3,4,"Class"],[4,11,3,9],[4,14,3,17,"require"],[4,25,3,24],[4,61,3,0],[5,0,3,0],[5,6,4,4,"URI"],[5,9,4,7],[5,12,4,17,"require"],[5,23,4,24],[5,57,3,0],[6,0,3,0],[6,6,5,4,"copyObject"],[6,16,5,14],[6,19,5,17,"require"],[6,30,5,24],[6,72,3,0],[7,0,3,0],[7,6,6,4,"assign"],[7,12,6,10],[7,15,6,17,"require"],[7,26,6,24],[7,63,3,0],[8,0,3,0],[8,6,7,4,"toJSON"],[8,12,7,10],[8,15,7,17,"require"],[8,26,7,24],[8,64,3,0],[9,0,3,0],[9,6,8,4,"Transport"],[9,15,8,13],[9,18,8,17,"require"],[9,29,8,24],[9,63,3,0],[11,0,10,0],[11,6,10,4,"JSONP"],[11,11,10,9],[11,14,10,12,"assign"],[11,20,10,18],[11,21,10,19,"Class"],[11,26,10,24],[11,27,10,25,"Transport"],[11,36,10,24],[11,38,10,36],[12,0,11,1,"encode"],[12,4,11,1,"encode"],[12,10,11,7],[12,12,11,9],[12,28,11,18,"messages"],[12,36,11,9],[12,38,11,28],[13,0,12,4],[13,10,12,8,"url"],[13,13,12,11],[13,16,12,14,"copyObject"],[13,26,12,24],[13,27,12,25],[13,32,12,30,"endpoint"],[13,40,12,24],[13,41,12,4],[14,0,13,4,"url"],[14,6,13,4,"url"],[14,9,13,7],[14,10,13,8,"query"],[14,15,13,4],[14,16,13,14,"message"],[14,23,13,4],[14,26,13,24,"toJSON"],[14,32,13,30],[14,33,13,31,"messages"],[14,41,13,30],[14,42,13,4],[15,0,14,4,"url"],[15,6,14,4,"url"],[15,9,14,7],[15,10,14,8,"query"],[15,15,14,4],[15,16,14,14,"jsonp"],[15,21,14,4],[15,24,14,24],[15,36,14,36,"JSONP"],[15,41,14,41],[15,42,14,42,"_cbCount"],[15,50,14,24],[15,53,14,53],[15,57,14,4],[16,0,15,4],[16,13,15,11,"URI"],[16,16,15,14],[16,17,15,15,"stringify"],[16,26,15,11],[16,27,15,25,"url"],[16,30,15,11],[16,31,15,4],[17,0,16,3],[17,5,10,36],[18,0,18,2,"request"],[18,4,18,2,"request"],[18,11,18,9],[18,13,18,11],[18,30,18,20,"messages"],[18,38,18,11],[18,40,18,30],[19,0,19,4],[19,10,19,8,"head"],[19,14,19,12],[19,17,19,23,"document"],[19,25,19,31],[19,26,19,32,"getElementsByTagName"],[19,46,19,23],[19,47,19,53],[19,53,19,23],[19,55,19,61],[19,56,19,23],[19,57,19,4],[20,0,19,4],[20,10,20,8,"script"],[20,16,20,14],[20,19,20,23,"document"],[20,27,20,31],[20,28,20,32,"createElement"],[20,41,20,23],[20,42,20,46],[20,50,20,23],[20,51,19,4],[21,0,19,4],[21,10,21,8,"callbackName"],[21,22,21,20],[21,25,21,23,"JSONP"],[21,30,21,28],[21,31,21,29,"getCallbackName"],[21,46,21,23],[21,48,19,4],[22,0,19,4],[22,10,22,8,"endpoint"],[22,18,22,16],[22,21,22,23,"copyObject"],[22,31,22,33],[22,32,22,34],[22,37,22,39,"endpoint"],[22,45,22,33],[22,46,19,4],[23,0,19,4],[23,10,23,8,"self"],[23,14,23,12],[23,17,23,23],[23,21,19,4],[24,0,25,4,"endpoint"],[24,6,25,4,"endpoint"],[24,14,25,12],[24,15,25,13,"query"],[24,20,25,4],[24,21,25,19,"message"],[24,28,25,4],[24,31,25,29,"toJSON"],[24,37,25,35],[24,38,25,36,"messages"],[24,46,25,35],[24,47,25,4],[25,0,26,4,"endpoint"],[25,6,26,4,"endpoint"],[25,14,26,12],[25,15,26,13,"query"],[25,20,26,4],[25,21,26,19,"jsonp"],[25,26,26,4],[25,29,26,29,"callbackName"],[25,41,26,4],[27,0,28,4],[27,10,28,8,"cleanup"],[27,17,28,15],[27,20,28,18],[27,29,28,8,"cleanup"],[27,36,28,18],[27,39,28,29],[28,0,29,6],[28,12,29,10],[28,13,29,11,"global"],[28,19,29,17],[28,20,29,18,"callbackName"],[28,32,29,17],[28,33,29,6],[28,35,29,33],[28,42,29,40],[28,47,29,33],[29,0,30,6,"global"],[29,8,30,6,"global"],[29,14,30,12],[29,15,30,13,"callbackName"],[29,27,30,12],[29,28,30,6],[29,31,30,29,"undefined"],[29,40,30,6],[31,0,31,6],[31,12,31,10],[32,0,31,12],[32,17,31,19,"global"],[32,23,31,25],[32,24,31,26,"callbackName"],[32,36,31,25],[32,37,31,12],[33,0,31,41],[33,9,31,6],[33,10,31,42],[33,17,31,49,"error"],[33,22,31,42],[33,24,31,56],[33,25,31,58],[35,0,32,6,"script"],[35,8,32,6,"script"],[35,14,32,12],[35,15,32,13,"parentNode"],[35,25,32,6],[35,26,32,24,"removeChild"],[35,37,32,6],[35,38,32,36,"script"],[35,44,32,6],[36,0,33,5],[36,7,28,4],[38,0,35,4,"global"],[38,6,35,4,"global"],[38,12,35,10],[38,13,35,11,"callbackName"],[38,25,35,10],[38,26,35,4],[38,29,35,27],[38,39,35,36,"replies"],[38,46,35,27],[38,48,35,45],[39,0,36,6,"cleanup"],[39,8,36,6,"cleanup"],[39,15,36,13],[41,0,37,6,"self"],[41,8,37,6,"self"],[41,12,37,10],[41,13,37,11,"_receive"],[41,21,37,6],[41,22,37,20,"replies"],[41,29,37,6],[42,0,38,5],[42,7,35,4],[44,0,40,4,"script"],[44,6,40,4,"script"],[44,12,40,10],[44,13,40,11,"type"],[44,17,40,4],[44,20,40,18],[44,37,40,4],[45,0,41,4,"script"],[45,6,41,4,"script"],[45,12,41,10],[45,13,41,11,"src"],[45,16,41,4],[45,19,41,18,"URI"],[45,22,41,21],[45,23,41,22,"stringify"],[45,32,41,18],[45,33,41,32,"endpoint"],[45,41,41,18],[45,42,41,4],[46,0,42,4,"head"],[46,6,42,4,"head"],[46,10,42,8],[46,11,42,9,"appendChild"],[46,22,42,4],[46,23,42,21,"script"],[46,29,42,4],[48,0,44,4,"script"],[48,6,44,4,"script"],[48,12,44,10],[48,13,44,11,"onerror"],[48,20,44,4],[48,23,44,21],[48,35,44,32],[49,0,45,6,"cleanup"],[49,8,45,6,"cleanup"],[49,15,45,13],[51,0,46,6,"self"],[51,8,46,6,"self"],[51,12,46,10],[51,13,46,11,"_handleError"],[51,25,46,6],[51,26,46,24,"messages"],[51,34,46,6],[52,0,47,5],[52,7,44,4],[54,0,49,4],[54,13,49,11],[55,0,49,13,"abort"],[55,8,49,13,"abort"],[55,13,49,18],[55,15,49,20,"cleanup"],[56,0,49,11],[56,7,49,4],[57,0,50,3],[58,0,10,36],[58,3,10,24],[58,4,10,18],[58,6,51,4],[59,0,52,2,"_cbCount"],[59,4,52,2,"_cbCount"],[59,12,52,10],[59,14,52,12],[59,15,51,4],[60,0,54,2,"getCallbackName"],[60,4,54,2,"getCallbackName"],[60,19,54,17],[60,21,54,19],[60,48,54,30],[61,0,55,4],[61,11,55,9,"_cbCount"],[61,19,55,4],[61,23,55,21],[61,24,55,4],[62,0,56,4],[62,13,56,11],[62,25,56,23],[62,30,56,28,"_cbCount"],[62,38,56,11],[62,41,56,39],[62,45,56,4],[63,0,57,3],[63,5,51,4],[64,0,59,2,"isUsable"],[64,4,59,2,"isUsable"],[64,12,59,10],[64,14,59,12],[64,32,59,21,"dispatcher"],[64,42,59,12],[64,44,59,33,"endpoint"],[64,52,59,12],[64,54,59,43,"callback"],[64,62,59,12],[64,64,59,53,"context"],[64,71,59,12],[64,73,59,62],[65,0,60,4,"callback"],[65,6,60,4,"callback"],[65,14,60,12],[65,15,60,13,"call"],[65,19,60,4],[65,20,60,18,"context"],[65,27,60,4],[65,29,60,27],[65,33,60,4],[66,0,61,3],[67,0,51,4],[67,3,10,18],[67,4,10,0],[68,0,64,0,"module"],[68,2,64,0,"module"],[68,8,64,6],[68,9,64,7,"exports"],[68,16,64,0],[68,19,64,17,"JSONP"],[68,24,64,0]],"functionMap":{"names":["<global>","Class$argument_1.encode","Class$argument_1.request","cleanup","global.callbackName","script.onerror","assign$argument_1.getCallbackName","assign$argument_1.isUsable"],"mappings":"AAA;SCU;GDK;WEE;kBCU;KDK;2BEE;KFG;qBGM;KHG;GFG;mBMI;GNG;YOE;GPE"}},"type":"js/module"}]}