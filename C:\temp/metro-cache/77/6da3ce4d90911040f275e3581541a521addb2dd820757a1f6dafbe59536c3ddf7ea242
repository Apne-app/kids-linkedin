{"dependencies":[{"name":"./errors","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){var t=r(d[0]),n=function(){this.initialize.apply(this,arguments)};n.prototype={initialize:function(t,n){this.client=t,this.token=n},buildURL:function(t,n){var o='collections/'+t+'/';return void 0===n?o:o+n+'/'},entry:function(t,n,l){return new o(this,t,n,l)},get:function(t,n,o){var l=this;return this.client.get({url:this.buildURL(t,n),signature:this.token}).then(function(t){var n=l.client.collections.entry(t.collection,t.id,t.data);return n.full=t,o&&o(n),n})},add:function(t,n,o,l){var s=this;null===n&&(n=void 0);var c={id:n,data:o};return this.client.post({url:this.buildURL(t),body:c,signature:this.token}).then(function(t){var n=s.client.collections.entry(t.collection,t.id,t.data);return n.full=t,l&&l(n),n})},update:function(t,n,o,l){var s=this,c={data:o};return this.client.put({url:this.buildURL(t,n),body:c,signature:this.token}).then(function(t){var n=s.client.collections.entry(t.collection,t.id,t.data);return n.full=t,l&&l(n),n})},delete:function(t,n,o){return this.client.delete({url:this.buildURL(t,n),signature:this.token},o)},upsert:function(n,o,l){if(!this.client.usingApiSecret)throw new t.SiteError('This method can only be used server-side using your API Secret');var s=arguments[arguments.length-1];l=s.call?s:void 0,Array.isArray(o)||(o=[o]);var c={data:{}};return c.data[n]=o,this.client.post({url:'collections/',serviceName:'api',body:c,signature:this.client.getCollectionsToken()},l)},select:function(n,o,l){if(!this.client.usingApiSecret)throw new t.SiteError('This method can only be used server-side using your API Secret');var s=arguments[arguments.length-1];l=s.call?s:void 0,Array.isArray(o)||(o=[o]);var c={foreign_ids:o.map(function(t){return n+':'+t}).join(',')};return this.client.get({url:'collections/',serviceName:'api',qs:c,signature:this.client.getCollectionsToken()},l)},deleteMany:function(n,o,l){if(!this.client.usingApiSecret)throw new t.SiteError('This method can only be used server-side using your API Secret');var s=arguments[arguments.length-1];l=s.call?s:void 0,Array.isArray(o)||(o=[o]);var c={collection_name:n,ids:o=o.map(function(t){return t.toString()}).join(',')};return this.client.delete({url:'collections/',serviceName:'api',qs:c,signature:this.client.getCollectionsToken()},l)}};var o=function(){this.initialize.apply(this,arguments)};o.prototype={initialize:function(t,n,o,l){this.collection=n,this.store=t,this.id=o,this.data=l},_streamRef:function(){return\"SO:\".concat(this.collection,\":\").concat(this.id)},get:function(t){var n=this;return this.store.get(this.collection,this.id).then(function(o){return n.data=o.data,n.full=o,t&&t(o),o})},add:function(t){var n=this;return this.store.add(this.collection,this.id,this.data).then(function(o){return n.data=o.data,n.full=o,t&&t(o),o})},update:function(t){var n=this;return this.store.update(this.collection,this.id,this.data).then(function(o){return n.data=o.data,n.full=o,t&&t(o),o})},delete:function(t){var n=this;return this.store.delete(this.collection,this.id).then(function(o){return n.data=null,n.full=null,t&&t(o),o})}},m.exports=n});","lineCount":1,"map":[[1,28,1,0],[1,32,1,4,"errors"],[1,34,1,13,"require"],[1,36,1,20,"d"],[1,38,1,20],[1,42,3,4,"Collections"],[1,44,3,18],[1,55,4,2,"this"],[1,60,4,7,"initialize"],[1,71,4,18,"apply"],[1,77,4,24,"this"],[1,82,4,30,"arguments"],[1,94,7,0,"Collections"],[1,96,7,12,"prototype"],[1,107,8,2,"initialize"],[1,118,8,14],[1,127,8,34,"client"],[1,129,8,42,"token"],[1,132,16,4,"this"],[1,137,16,9,"client"],[1,144,16,18,"client"],[1,146,17,4,"this"],[1,151,17,9,"token"],[1,157,17,17,"token"],[1,160,19,2,"buildURL"],[1,169,19,12],[1,178,19,30,"collection"],[1,180,19,42,"itemId"],[1,183,20,4],[1,187,20,8,"url"],[1,189,20,14],[1,204,20,31,"collection"],[1,206,20,44],[1,210,22,4],[1,222,22,19,"undefined"],[1,226,22,8,"itemId"],[1,228,23,13,"url"],[1,230,26,11,"url"],[1,232,26,17,"itemId"],[1,234,26,26],[1,239,28,2,"entry"],[1,245,28,9],[1,254,28,24,"collection"],[1,256,28,36,"itemId"],[1,258,28,44,"itemData"],[1,261,29,4],[1,268,29,11],[1,272,29,15,"CollectionEntry"],[1,274,29,31,"this"],[1,279,29,37,"collection"],[1,281,29,49,"itemId"],[1,283,29,57,"itemData"],[1,287,31,2,"get"],[1,291,31,7],[1,300,31,20,"collection"],[1,302,31,32,"itemId"],[1,304,31,40,"callback"],[1,307,42,4],[1,311,42,8,"self"],[1,313,42,15,"this"],[1,318,43,4],[1,325,43,11,"this"],[1,330,43,16,"client"],[1,337,43,23,"get"],[1,342,44,6,"url"],[1,346,44,11,"this"],[1,351,44,16,"buildURL"],[1,360,44,25,"collection"],[1,362,44,37,"itemId"],[1,365,45,6,"signature"],[1,375,45,17,"this"],[1,380,45,22,"token"],[1,388,46,7,"then"],[1,393,46,12],[1,402,46,22,"response"],[1,405,47,6],[1,409,47,10,"entry"],[1,411,47,18,"self"],[1,413,47,23,"client"],[1,420,47,30,"collections"],[1,432,47,42,"entry"],[1,438,47,48,"response"],[1,440,47,57,"collection"],[1,451,47,69,"response"],[1,453,47,78,"id"],[1,456,47,82,"response"],[1,458,47,91,"data"],[1,464,54,6],[1,471,48,6,"entry"],[1,473,48,12,"full"],[1,478,48,19,"response"],[1,480,50,10,"callback"],[1,483,51,8,"callback"],[1,485,51,17,"entry"],[1,488,54,13,"entry"],[1,493,57,2,"add"],[1,497,57,7],[1,506,57,20,"collection"],[1,508,57,32,"itemId"],[1,510,57,40,"itemData"],[1,512,57,50,"callback"],[1,515,69,4],[1,519,69,8,"self"],[1,521,69,15,"this"],[1,526,71,19],[1,533,71,8,"itemId"],[1,537,72,6,"itemId"],[1,544,72,15,"undefined"],[1,547,75,4],[1,551,75,8,"body"],[1,554,76,6,"id"],[1,557,76,10,"itemId"],[1,559,77,6,"data"],[1,564,77,12,"itemData"],[1,567,79,4],[1,574,79,11,"this"],[1,579,79,16,"client"],[1,586,79,23,"post"],[1,592,80,6,"url"],[1,596,80,11,"this"],[1,601,80,16,"buildURL"],[1,610,80,25,"collection"],[1,613,81,6,"body"],[1,618,81,12,"body"],[1,620,82,6,"signature"],[1,630,82,17,"this"],[1,635,82,22,"token"],[1,643,83,7,"then"],[1,648,83,12],[1,657,83,22,"response"],[1,660,84,6],[1,664,84,10,"entry"],[1,666,84,18,"self"],[1,668,84,23,"client"],[1,675,84,30,"collections"],[1,687,84,42,"entry"],[1,693,84,48,"response"],[1,695,84,57,"collection"],[1,706,84,69,"response"],[1,708,84,78,"id"],[1,711,84,82,"response"],[1,713,84,91,"data"],[1,719,91,6],[1,726,85,6,"entry"],[1,728,85,12,"full"],[1,733,85,19,"response"],[1,735,87,10,"callback"],[1,738,88,8,"callback"],[1,740,88,17,"entry"],[1,743,91,13,"entry"],[1,748,94,2,"update"],[1,755,94,10],[1,764,94,26,"collection"],[1,766,94,38,"entryId"],[1,768,94,47,"data"],[1,770,94,53,"callback"],[1,773,107,4],[1,777,107,8,"self"],[1,779,107,15,"this"],[1,784,108,8,"body"],[1,787,109,6,"data"],[1,792,109,12,"data"],[1,795,111,4],[1,802,111,11,"this"],[1,807,111,16,"client"],[1,814,111,23,"put"],[1,819,112,6,"url"],[1,823,112,11,"this"],[1,828,112,16,"buildURL"],[1,837,112,25,"collection"],[1,839,112,37,"entryId"],[1,842,113,6,"body"],[1,847,113,12,"body"],[1,849,114,6,"signature"],[1,859,114,17,"this"],[1,864,114,22,"token"],[1,872,115,7,"then"],[1,877,115,12],[1,886,115,22,"response"],[1,889,116,6],[1,893,116,10,"entry"],[1,895,116,18,"self"],[1,897,116,23,"client"],[1,904,116,30,"collections"],[1,916,116,42,"entry"],[1,922,116,48,"response"],[1,924,116,57,"collection"],[1,935,116,69,"response"],[1,937,116,78,"id"],[1,940,116,82,"response"],[1,942,116,91,"data"],[1,948,123,6],[1,955,117,6,"entry"],[1,957,117,12,"full"],[1,962,117,19,"response"],[1,964,119,10,"callback"],[1,967,120,8,"callback"],[1,969,120,17,"entry"],[1,972,123,13,"entry"],[1,977,126,2,"delete"],[1,984,126,10],[1,993,126,27,"collection"],[1,995,126,39,"entryId"],[1,997,126,48,"callback"],[1,1000,136,4],[1,1007,136,11,"this"],[1,1012,136,16,"client"],[1,1019,136,11],[1,1027,137,6,"url"],[1,1031,137,11,"this"],[1,1036,137,16,"buildURL"],[1,1045,137,25,"collection"],[1,1047,137,37,"entryId"],[1,1050,138,6,"signature"],[1,1060,138,17,"this"],[1,1065,138,22,"token"],[1,1072,139,7,"callback"],[1,1076,141,2,"upsert"],[1,1083,141,10],[1,1092,141,26,"collection"],[1,1094,141,38,"data"],[1,1096,141,44,"callback"],[1,1099,151,4],[1,1103,151,9,"this"],[1,1108,151,14,"client"],[1,1115,151,21,"usingApiSecret"],[1,1130,152,6],[1,1136,152,12],[1,1140,152,16,"errors"],[1,1142,152,23,"SiteError"],[1,1152,152,33],[1,1218,155,4],[1,1222,155,8,"last"],[1,1224,155,15,"arguments"],[1,1234,155,25,"arguments"],[1,1244,155,35,"length"],[1,1251,155,44],[1,1254,157,4,"callback"],[1,1256,157,15,"last"],[1,1258,157,20,"call"],[1,1263,157,27,"last"],[1,1270,157,34,"undefined"],[1,1272,159,9,"Array"],[1,1278,159,15,"isArray"],[1,1286,159,23,"data"],[1,1291,160,6,"data"],[1,1294,160,14,"data"],[1,1298,163,4],[1,1302,163,8,"data_json"],[1,1305,164,6,"data"],[1,1314,167,4],[1,1321,166,4,"data_json"],[1,1323,166,13],[1,1328,166,22,"collection"],[1,1331,166,36,"data"],[1,1333,167,11,"this"],[1,1338,167,16,"client"],[1,1345,167,23,"post"],[1,1351,168,6,"url"],[1,1355,168,11],[1,1370,169,6,"serviceName"],[1,1382,169,19],[1,1388,170,6,"body"],[1,1393,170,12,"data_json"],[1,1395,171,6,"signature"],[1,1405,171,17,"this"],[1,1410,171,22,"client"],[1,1417,171,29,"getCollectionsToken"],[1,1440,172,7,"callback"],[1,1444,174,2,"select"],[1,1451,174,10],[1,1460,174,26,"collection"],[1,1462,174,38,"ids"],[1,1464,174,43,"callback"],[1,1467,184,4],[1,1471,184,9,"this"],[1,1476,184,14,"client"],[1,1483,184,21,"usingApiSecret"],[1,1498,185,6],[1,1504,185,12],[1,1508,185,16,"errors"],[1,1510,185,23,"SiteError"],[1,1520,185,33],[1,1586,188,4],[1,1590,188,8,"last"],[1,1592,188,15,"arguments"],[1,1602,188,25,"arguments"],[1,1612,188,35,"length"],[1,1619,188,44],[1,1622,190,4,"callback"],[1,1624,190,15,"last"],[1,1626,190,20,"call"],[1,1631,190,27,"last"],[1,1638,190,34,"undefined"],[1,1640,192,9,"Array"],[1,1646,192,15,"isArray"],[1,1654,192,23,"ids"],[1,1659,193,6,"ids"],[1,1662,193,13,"ids"],[1,1666,196,4],[1,1670,196,8,"params"],[1,1673,197,6,"foreign_ids"],[1,1685,197,19,"ids"],[1,1687,197,23,"map"],[1,1691,197,27],[1,1700,197,37,"id"],[1,1703,198,8],[1,1710,198,15,"collection"],[1,1712,198,28],[1,1716,198,34,"id"],[1,1720,199,9,"join"],[1,1725,199,14],[1,1731,201,4],[1,1738,201,11,"this"],[1,1743,201,16,"client"],[1,1750,201,23,"get"],[1,1755,202,6,"url"],[1,1759,202,11],[1,1774,203,6,"serviceName"],[1,1786,203,19],[1,1792,204,6,"qs"],[1,1795,204,10,"params"],[1,1797,205,6,"signature"],[1,1807,205,17,"this"],[1,1812,205,22,"client"],[1,1819,205,29,"getCollectionsToken"],[1,1842,206,7,"callback"],[1,1846,208,2,"deleteMany"],[1,1857,208,14],[1,1866,208,34,"collection"],[1,1868,208,46,"ids"],[1,1870,208,51,"callback"],[1,1873,218,4],[1,1877,218,9,"this"],[1,1882,218,14,"client"],[1,1889,218,21,"usingApiSecret"],[1,1904,219,6],[1,1910,219,12],[1,1914,219,16,"errors"],[1,1916,219,23,"SiteError"],[1,1926,219,33],[1,1992,222,4],[1,1996,222,8,"last"],[1,1998,222,15,"arguments"],[1,2008,222,25,"arguments"],[1,2018,222,35,"length"],[1,2025,222,44],[1,2028,224,4,"callback"],[1,2030,224,15,"last"],[1,2032,224,20,"call"],[1,2037,224,27,"last"],[1,2044,224,34,"undefined"],[1,2046,226,9,"Array"],[1,2052,226,15,"isArray"],[1,2060,226,23,"ids"],[1,2065,227,6,"ids"],[1,2068,227,13,"ids"],[1,2072,233,4],[1,2076,233,8,"params"],[1,2079,234,6,"collection_name"],[1,2095,234,23,"collection"],[1,2097,235,6,"ids"],[1,2101,230,4,"ids"],[1,2103,230,10,"ids"],[1,2105,230,14,"map"],[1,2109,230,18],[1,2118,230,28,"id"],[1,2121,231,6],[1,2128,231,13,"id"],[1,2130,231,16,"toString"],[1,2143,232,7,"join"],[1,2148,232,12],[1,2154,237,4],[1,2161,237,11,"this"],[1,2166,237,16,"client"],[1,2173,237,23,"delete"],[1,2181,238,6,"url"],[1,2185,238,11],[1,2200,239,6,"serviceName"],[1,2212,239,19],[1,2218,240,6,"qs"],[1,2221,240,10,"params"],[1,2223,241,6,"signature"],[1,2233,241,17,"this"],[1,2238,241,22,"client"],[1,2245,241,29,"getCollectionsToken"],[1,2268,242,7,"callback"],[1,2273,246,0],[1,2277,246,4,"CollectionEntry"],[1,2279,246,22],[1,2290,247,2,"this"],[1,2295,247,7,"initialize"],[1,2306,247,18,"apply"],[1,2312,247,24,"this"],[1,2317,247,30,"arguments"],[1,2329,250,0,"CollectionEntry"],[1,2331,250,16,"prototype"],[1,2342,251,2,"initialize"],[1,2353,251,14],[1,2362,251,34,"store"],[1,2364,251,41,"collection"],[1,2366,251,53,"id"],[1,2368,251,57,"data"],[1,2371,252,4,"this"],[1,2376,252,9,"collection"],[1,2387,252,22,"collection"],[1,2389,253,4,"this"],[1,2394,253,9,"store"],[1,2400,253,17,"store"],[1,2402,254,4,"this"],[1,2407,254,9,"id"],[1,2410,254,14,"id"],[1,2412,255,4,"this"],[1,2417,255,9,"data"],[1,2422,255,16,"data"],[1,2425,257,2,"_streamRef"],[1,2436,257,14],[1,2447,258,4],[1,2453,258,11],[1,2459,258,17,"concat"],[1,2466,258,24,"this"],[1,2471,258,29,"collection"],[1,2482,258,41],[1,2487,258,46,"concat"],[1,2494,258,53,"this"],[1,2499,258,58,"id"],[1,2504,260,2,"get"],[1,2508,260,7],[1,2517,260,20,"callback"],[1,2520,261,4],[1,2524,261,8,"_this"],[1,2526,261,16,"this"],[1,2531,271,4],[1,2538,271,11,"this"],[1,2543,271,16,"store"],[1,2549,271,22,"get"],[1,2553,271,26,"this"],[1,2558,271,31,"collection"],[1,2569,271,43,"this"],[1,2574,271,48,"id"],[1,2578,271,52,"then"],[1,2583,271,57],[1,2592,271,67,"response"],[1,2595,279,6],[1,2602,272,6,"_this"],[1,2604,272,12,"data"],[1,2609,272,19,"response"],[1,2611,272,28,"data"],[1,2616,273,6,"_this"],[1,2618,273,12,"full"],[1,2623,273,19,"response"],[1,2625,275,10,"callback"],[1,2628,276,8,"callback"],[1,2630,276,17,"response"],[1,2633,279,13,"response"],[1,2638,282,2,"add"],[1,2642,282,7],[1,2651,282,20,"callback"],[1,2654,283,4],[1,2658,283,8,"_this2"],[1,2660,283,17,"this"],[1,2665,293,4],[1,2672,293,11,"this"],[1,2677,293,16,"store"],[1,2683,293,22,"add"],[1,2687,293,26,"this"],[1,2692,293,31,"collection"],[1,2703,293,43,"this"],[1,2708,293,48,"id"],[1,2711,293,52,"this"],[1,2716,293,57,"data"],[1,2722,293,63,"then"],[1,2727,293,68],[1,2736,293,78,"response"],[1,2739,301,6],[1,2746,294,6,"_this2"],[1,2748,294,13,"data"],[1,2753,294,20,"response"],[1,2755,294,29,"data"],[1,2760,295,6,"_this2"],[1,2762,295,13,"full"],[1,2767,295,20,"response"],[1,2769,297,10,"callback"],[1,2772,298,8,"callback"],[1,2774,298,17,"response"],[1,2777,301,13,"response"],[1,2782,304,2,"update"],[1,2789,304,10],[1,2798,304,26,"callback"],[1,2801,305,4],[1,2805,305,8,"_this3"],[1,2807,305,17,"this"],[1,2812,316,4],[1,2819,316,11,"this"],[1,2824,316,16,"store"],[1,2830,316,22,"update"],[1,2837,316,29,"this"],[1,2842,316,34,"collection"],[1,2853,316,46,"this"],[1,2858,316,51,"id"],[1,2861,316,55,"this"],[1,2866,316,60,"data"],[1,2872,316,66,"then"],[1,2877,316,71],[1,2886,316,81,"response"],[1,2889,324,6],[1,2896,317,6,"_this3"],[1,2898,317,13,"data"],[1,2903,317,20,"response"],[1,2905,317,29,"data"],[1,2910,318,6,"_this3"],[1,2912,318,13,"full"],[1,2917,318,20,"response"],[1,2919,320,10,"callback"],[1,2922,321,8,"callback"],[1,2924,321,17,"response"],[1,2927,324,13,"response"],[1,2932,327,2,"delete"],[1,2939,327,10],[1,2948,327,27,"callback"],[1,2951,328,4],[1,2955,328,8,"_this4"],[1,2957,328,17,"this"],[1,2962,338,4],[1,2969,338,11,"this"],[1,2974,338,16,"store"],[1,2980,338,22,"delete"],[1,2987,338,29,"this"],[1,2992,338,34,"collection"],[1,3003,338,46,"this"],[1,3008,338,51,"id"],[1,3012,338,55,"then"],[1,3017,338,60],[1,3026,338,70,"response"],[1,3029,346,6],[1,3036,339,6,"_this4"],[1,3038,339,13,"data"],[1,3043,339,20],[1,3048,340,6,"_this4"],[1,3050,340,13,"full"],[1,3055,340,20],[1,3060,342,10,"callback"],[1,3063,343,8,"callback"],[1,3065,343,17,"response"],[1,3068,346,13,"response"],[1,3074,350,0,"module"],[1,3076,350,7,"exports"],[1,3084,350,17,"Collections"]],"functionMap":{"names":["<global>","Collections","initialize","buildURL","entry","get","client.get.then$argument_0","add","client.post.then$argument_0","update","client.put.then$argument_0","_delete","upsert","select","ids.map$argument_0","deleteMany","CollectionEntry","_streamRef","store.get.then$argument_0","store.add.then$argument_0","store.update.then$argument_0","store._delete.then$argument_0"],"mappings":"AAA;kBCE;CDE;cEG;GFU;YGC;GHQ;SIC;GJE;OKC;YCe;KDS;GLC;OOC;YC0B;KDS;GPC;USC;YCqB;KDS;GTC;UWC;GXc;UYC;GZgC;UaC;2BCuB;ODE;GbQ;ceC;kBDsB;KCE;GfW;sBgBG;ChBE;cEG;GFK;ciBC;GjBE;OKC;yDaW;KbS;GLC;OOC;oEYW;KZS;GPC;USC;uEWY;KXS;GTC;UWC;4DUW;KVS;GXC"}},"type":"js/module"}]}