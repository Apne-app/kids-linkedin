{"dependencies":[{"name":"./globals","data":{"isAsync":false,"locs":[{"start":{"line":4,"column":16},"end":{"line":4,"column":36}}]}},{"name":"./constants","data":{"isAsync":false,"locs":[{"start":{"line":5,"column":18},"end":{"line":5,"column":40}}]}},{"name":"./manage-subscribers","data":{"isAsync":false,"locs":[{"start":{"line":6,"column":27},"end":{"line":6,"column":58}}]}},{"name":"./socket-io","data":{"isAsync":false,"locs":[{"start":{"line":7,"column":18},"end":{"line":7,"column":40}}]}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.attachSharedListeners = void 0;\n\n  var globals_1 = _$$_REQUIRE(_dependencyMap[0], \"./globals\");\n\n  var constants_1 = _$$_REQUIRE(_dependencyMap[1], \"./constants\");\n\n  var manage_subscribers_1 = _$$_REQUIRE(_dependencyMap[2], \"./manage-subscribers\");\n\n  var socket_io_1 = _$$_REQUIRE(_dependencyMap[3], \"./socket-io\");\n\n  var bindMessageHandler = function bindMessageHandler(webSocketInstance, url) {\n    webSocketInstance.onmessage = function (message) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        if (subscriber.optionsRef.current.onMessage) {\n          subscriber.optionsRef.current.onMessage(message);\n        }\n\n        if (typeof subscriber.optionsRef.current.filter === 'function' && subscriber.optionsRef.current.filter(message) !== true) {\n          return;\n        }\n\n        subscriber.setLastMessage(message);\n      });\n    };\n  };\n\n  var bindOpenHandler = function bindOpenHandler(webSocketInstance, url) {\n    webSocketInstance.onopen = function (event) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        subscriber.reconnectCount.current = 0;\n\n        if (subscriber.optionsRef.current.onOpen) {\n          subscriber.optionsRef.current.onOpen(event);\n        }\n\n        subscriber.setReadyState(constants_1.ReadyState.OPEN);\n      });\n    };\n  };\n\n  var bindCloseHandler = function bindCloseHandler(webSocketInstance, url) {\n    webSocketInstance.onclose = function (event) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        if (subscriber.optionsRef.current.onClose) {\n          subscriber.optionsRef.current.onClose(event);\n        }\n\n        subscriber.setReadyState(constants_1.ReadyState.CLOSED);\n      });\n      delete globals_1.sharedWebSockets[url];\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        var _a, _b;\n\n        if (subscriber.optionsRef.current.shouldReconnect && subscriber.optionsRef.current.shouldReconnect(event)) {\n          var reconnectAttempts = (_a = subscriber.optionsRef.current.reconnectAttempts) !== null && _a !== void 0 ? _a : constants_1.DEFAULT_RECONNECT_LIMIT;\n\n          if (subscriber.reconnectCount.current < reconnectAttempts) {\n            setTimeout(function () {\n              subscriber.reconnectCount.current++;\n              subscriber.reconnect.current();\n            }, (_b = subscriber.optionsRef.current.reconnectInterval) !== null && _b !== void 0 ? _b : constants_1.DEFAULT_RECONNECT_INTERVAL_MS);\n          } else {\n            subscriber.optionsRef.current.onReconnectStop && subscriber.optionsRef.current.onReconnectStop(subscriber.optionsRef.current.reconnectAttempts);\n            console.warn(\"Max reconnect attempts of \" + reconnectAttempts + \" exceeded\");\n          }\n        }\n      });\n    };\n  };\n\n  var bindErrorHandler = function bindErrorHandler(webSocketInstance, url) {\n    webSocketInstance.onerror = function (error) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        if (subscriber.optionsRef.current.onError) {\n          subscriber.optionsRef.current.onError(error);\n        }\n      });\n    };\n  };\n\n  exports.attachSharedListeners = function (webSocketInstance, url, optionsRef, sendMessage) {\n    var interval;\n\n    if (optionsRef.current.fromSocketIO) {\n      interval = socket_io_1.setUpSocketIOPing(sendMessage);\n    }\n\n    bindMessageHandler(webSocketInstance, url);\n    bindCloseHandler(webSocketInstance, url);\n    bindOpenHandler(webSocketInstance, url);\n    bindErrorHandler(webSocketInstance, url);\n    return function () {\n      if (interval) clearInterval(interval);\n    };\n  };\n});","lineCount":102,"map":[[2,0,1,0],[4,0,2,0,"Object"],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,0],[4,24,2,22,"exports"],[4,31,2,0],[4,33,2,31],[4,45,2,0],[4,47,2,45],[5,0,2,47,"value"],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,0,2,45],[6,3,2,0],[7,0,3,0,"exports"],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"attachSharedListeners"],[7,31,3,0],[7,34,3,32],[7,39,3,37],[7,40,3,0],[9,0,4,0],[9,6,4,4,"globals_1"],[9,15,4,13],[9,18,4,16,"require"],[9,29,4,23],[9,61,4,0],[11,0,5,0],[11,6,5,4,"constants_1"],[11,17,5,15],[11,20,5,18,"require"],[11,31,5,25],[11,65,5,0],[13,0,6,0],[13,6,6,4,"manage_subscribers_1"],[13,26,6,24],[13,29,6,27,"require"],[13,40,6,34],[13,83,6,0],[15,0,7,0],[15,6,7,4,"socket_io_1"],[15,17,7,15],[15,20,7,18,"require"],[15,31,7,25],[15,65,7,0],[17,0,8,0],[17,6,8,4,"bindMessageHandler"],[17,24,8,22],[17,27,8,25],[17,36,8,4,"bindMessageHandler"],[17,54,8,25],[17,55,8,35,"webSocketInstance"],[17,72,8,25],[17,74,8,54,"url"],[17,77,8,25],[17,79,8,59],[18,0,9,4,"webSocketInstance"],[18,4,9,4,"webSocketInstance"],[18,21,9,21],[18,22,9,22,"onmessage"],[18,31,9,4],[18,34,9,34],[18,44,9,44,"message"],[18,51,9,34],[18,53,9,53],[19,0,10,8,"manage_subscribers_1"],[19,6,10,8,"manage_subscribers_1"],[19,26,10,28],[19,27,10,29,"getSubscribers"],[19,41,10,8],[19,42,10,44,"url"],[19,45,10,8],[19,47,10,49,"forEach"],[19,54,10,8],[19,55,10,57],[19,65,10,67,"subscriber"],[19,75,10,57],[19,77,10,79],[20,0,11,12],[20,12,11,16,"subscriber"],[20,22,11,26],[20,23,11,27,"optionsRef"],[20,33,11,16],[20,34,11,38,"current"],[20,41,11,16],[20,42,11,46,"onMessage"],[20,51,11,12],[20,53,11,57],[21,0,12,16,"subscriber"],[21,10,12,16,"subscriber"],[21,20,12,26],[21,21,12,27,"optionsRef"],[21,31,12,16],[21,32,12,38,"current"],[21,39,12,16],[21,40,12,46,"onMessage"],[21,49,12,16],[21,50,12,56,"message"],[21,57,12,16],[22,0,13,13],[24,0,14,12],[24,12,14,16],[24,19,14,23,"subscriber"],[24,29,14,33],[24,30,14,34,"optionsRef"],[24,40,14,23],[24,41,14,45,"current"],[24,48,14,23],[24,49,14,53,"filter"],[24,55,14,16],[24,60,14,64],[24,70,14,16],[24,74,15,16,"subscriber"],[24,84,15,26],[24,85,15,27,"optionsRef"],[24,95,15,16],[24,96,15,38,"current"],[24,103,15,16],[24,104,15,46,"filter"],[24,110,15,16],[24,111,15,53,"message"],[24,118,15,16],[24,124,15,66],[24,128,14,12],[24,130,15,72],[25,0,16,16],[26,0,17,13],[28,0,18,12,"subscriber"],[28,8,18,12,"subscriber"],[28,18,18,22],[28,19,18,23,"setLastMessage"],[28,33,18,12],[28,34,18,38,"message"],[28,41,18,12],[29,0,19,9],[29,7,10,8],[30,0,20,5],[30,5,9,4],[31,0,21,1],[31,3,8,0],[33,0,22,0],[33,6,22,4,"bindOpenHandler"],[33,21,22,19],[33,24,22,22],[33,33,22,4,"bindOpenHandler"],[33,48,22,22],[33,49,22,32,"webSocketInstance"],[33,66,22,22],[33,68,22,51,"url"],[33,71,22,22],[33,73,22,56],[34,0,23,4,"webSocketInstance"],[34,4,23,4,"webSocketInstance"],[34,21,23,21],[34,22,23,22,"onopen"],[34,28,23,4],[34,31,23,31],[34,41,23,41,"event"],[34,46,23,31],[34,48,23,48],[35,0,24,8,"manage_subscribers_1"],[35,6,24,8,"manage_subscribers_1"],[35,26,24,28],[35,27,24,29,"getSubscribers"],[35,41,24,8],[35,42,24,44,"url"],[35,45,24,8],[35,47,24,49,"forEach"],[35,54,24,8],[35,55,24,57],[35,65,24,67,"subscriber"],[35,75,24,57],[35,77,24,79],[36,0,25,12,"subscriber"],[36,8,25,12,"subscriber"],[36,18,25,22],[36,19,25,23,"reconnectCount"],[36,33,25,12],[36,34,25,38,"current"],[36,41,25,12],[36,44,25,48],[36,45,25,12],[38,0,26,12],[38,12,26,16,"subscriber"],[38,22,26,26],[38,23,26,27,"optionsRef"],[38,33,26,16],[38,34,26,38,"current"],[38,41,26,16],[38,42,26,46,"onOpen"],[38,48,26,12],[38,50,26,54],[39,0,27,16,"subscriber"],[39,10,27,16,"subscriber"],[39,20,27,26],[39,21,27,27,"optionsRef"],[39,31,27,16],[39,32,27,38,"current"],[39,39,27,16],[39,40,27,46,"onOpen"],[39,46,27,16],[39,47,27,53,"event"],[39,52,27,16],[40,0,28,13],[42,0,29,12,"subscriber"],[42,8,29,12,"subscriber"],[42,18,29,22],[42,19,29,23,"setReadyState"],[42,32,29,12],[42,33,29,37,"constants_1"],[42,44,29,48],[42,45,29,49,"ReadyState"],[42,55,29,37],[42,56,29,60,"OPEN"],[42,60,29,12],[43,0,30,9],[43,7,24,8],[44,0,31,5],[44,5,23,4],[45,0,32,1],[45,3,22,0],[47,0,33,0],[47,6,33,4,"bindCloseHandler"],[47,22,33,20],[47,25,33,23],[47,34,33,4,"bindCloseHandler"],[47,50,33,23],[47,51,33,33,"webSocketInstance"],[47,68,33,23],[47,70,33,52,"url"],[47,73,33,23],[47,75,33,57],[48,0,34,4,"webSocketInstance"],[48,4,34,4,"webSocketInstance"],[48,21,34,21],[48,22,34,22,"onclose"],[48,29,34,4],[48,32,34,32],[48,42,34,42,"event"],[48,47,34,32],[48,49,34,49],[49,0,35,8,"manage_subscribers_1"],[49,6,35,8,"manage_subscribers_1"],[49,26,35,28],[49,27,35,29,"getSubscribers"],[49,41,35,8],[49,42,35,44,"url"],[49,45,35,8],[49,47,35,49,"forEach"],[49,54,35,8],[49,55,35,57],[49,65,35,67,"subscriber"],[49,75,35,57],[49,77,35,79],[50,0,36,12],[50,12,36,16,"subscriber"],[50,22,36,26],[50,23,36,27,"optionsRef"],[50,33,36,16],[50,34,36,38,"current"],[50,41,36,16],[50,42,36,46,"onClose"],[50,49,36,12],[50,51,36,55],[51,0,37,16,"subscriber"],[51,10,37,16,"subscriber"],[51,20,37,26],[51,21,37,27,"optionsRef"],[51,31,37,16],[51,32,37,38,"current"],[51,39,37,16],[51,40,37,46,"onClose"],[51,47,37,16],[51,48,37,54,"event"],[51,53,37,16],[52,0,38,13],[54,0,39,12,"subscriber"],[54,8,39,12,"subscriber"],[54,18,39,22],[54,19,39,23,"setReadyState"],[54,32,39,12],[54,33,39,37,"constants_1"],[54,44,39,48],[54,45,39,49,"ReadyState"],[54,55,39,37],[54,56,39,60,"CLOSED"],[54,62,39,12],[55,0,40,9],[55,7,35,8],[56,0,41,8],[56,13,41,15,"globals_1"],[56,22,41,24],[56,23,41,25,"sharedWebSockets"],[56,39,41,15],[56,40,41,42,"url"],[56,43,41,15],[56,44,41,8],[57,0,42,8,"manage_subscribers_1"],[57,6,42,8,"manage_subscribers_1"],[57,26,42,28],[57,27,42,29,"getSubscribers"],[57,41,42,8],[57,42,42,44,"url"],[57,45,42,8],[57,47,42,49,"forEach"],[57,54,42,8],[57,55,42,57],[57,65,42,67,"subscriber"],[57,75,42,57],[57,77,42,79],[58,0,43,12],[58,12,43,16,"_a"],[58,14,43,12],[58,16,43,20,"_b"],[58,18,43,12],[60,0,44,12],[60,12,44,16,"subscriber"],[60,22,44,26],[60,23,44,27,"optionsRef"],[60,33,44,16],[60,34,44,38,"current"],[60,41,44,16],[60,42,44,46,"shouldReconnect"],[60,57,44,16],[60,61,45,16,"subscriber"],[60,71,45,26],[60,72,45,27,"optionsRef"],[60,82,45,16],[60,83,45,38,"current"],[60,90,45,16],[60,91,45,46,"shouldReconnect"],[60,106,45,16],[60,107,45,62,"event"],[60,112,45,16],[60,113,44,12],[60,115,45,70],[61,0,46,16],[61,14,46,20,"reconnectAttempts"],[61,31,46,37],[61,34,46,40],[61,35,46,41,"_a"],[61,37,46,43],[61,40,46,46,"subscriber"],[61,50,46,56],[61,51,46,57,"optionsRef"],[61,61,46,46],[61,62,46,68,"current"],[61,69,46,46],[61,70,46,76,"reconnectAttempts"],[61,87,46,40],[61,93,46,99],[61,97,46,40],[61,101,46,107,"_a"],[61,103,46,109],[61,108,46,114],[61,113,46,119],[61,114,46,40],[61,117,46,123,"_a"],[61,119,46,40],[61,122,46,128,"constants_1"],[61,133,46,139],[61,134,46,140,"DEFAULT_RECONNECT_LIMIT"],[61,157,46,16],[63,0,47,16],[63,14,47,20,"subscriber"],[63,24,47,30],[63,25,47,31,"reconnectCount"],[63,39,47,20],[63,40,47,46,"current"],[63,47,47,20],[63,50,47,56,"reconnectAttempts"],[63,67,47,16],[63,69,47,75],[64,0,48,20,"setTimeout"],[64,12,48,20,"setTimeout"],[64,22,48,30],[64,23,48,31],[64,35,48,43],[65,0,49,24,"subscriber"],[65,14,49,24,"subscriber"],[65,24,49,34],[65,25,49,35,"reconnectCount"],[65,39,49,24],[65,40,49,50,"current"],[65,47,49,24],[66,0,50,24,"subscriber"],[66,14,50,24,"subscriber"],[66,24,50,34],[66,25,50,35,"reconnect"],[66,34,50,24],[66,35,50,45,"current"],[66,42,50,24],[67,0,51,21],[67,13,48,30],[67,15,51,23],[67,16,51,24,"_b"],[67,18,51,26],[67,21,51,29,"subscriber"],[67,31,51,39],[67,32,51,40,"optionsRef"],[67,42,51,29],[67,43,51,51,"current"],[67,50,51,29],[67,51,51,59,"reconnectInterval"],[67,68,51,23],[67,74,51,82],[67,78,51,23],[67,82,51,90,"_b"],[67,84,51,92],[67,89,51,97],[67,94,51,102],[67,95,51,23],[67,98,51,106,"_b"],[67,100,51,23],[67,103,51,111,"constants_1"],[67,114,51,122],[67,115,51,123,"DEFAULT_RECONNECT_INTERVAL_MS"],[67,144,48,30],[67,145,48,20],[68,0,52,17],[68,11,47,16],[68,17,53,21],[69,0,54,20,"subscriber"],[69,12,54,20,"subscriber"],[69,22,54,30],[69,23,54,31,"optionsRef"],[69,33,54,20],[69,34,54,42,"current"],[69,41,54,20],[69,42,54,50,"onReconnectStop"],[69,57,54,20],[69,61,54,69,"subscriber"],[69,71,54,79],[69,72,54,80,"optionsRef"],[69,82,54,69],[69,83,54,91,"current"],[69,90,54,69],[69,91,54,99,"onReconnectStop"],[69,106,54,69],[69,107,54,115,"subscriber"],[69,117,54,125],[69,118,54,126,"optionsRef"],[69,128,54,115],[69,129,54,137,"current"],[69,136,54,115],[69,137,54,145,"reconnectAttempts"],[69,154,54,69],[69,155,54,20],[70,0,55,20,"console"],[70,12,55,20,"console"],[70,19,55,27],[70,20,55,28,"warn"],[70,24,55,20],[70,25,55,33],[70,56,55,64,"reconnectAttempts"],[70,73,55,33],[70,76,55,84],[70,87,55,20],[71,0,56,17],[72,0,57,13],[73,0,58,9],[73,7,42,8],[74,0,59,5],[74,5,34,4],[75,0,60,1],[75,3,33,0],[77,0,61,0],[77,6,61,4,"bindErrorHandler"],[77,22,61,20],[77,25,61,23],[77,34,61,4,"bindErrorHandler"],[77,50,61,23],[77,51,61,33,"webSocketInstance"],[77,68,61,23],[77,70,61,52,"url"],[77,73,61,23],[77,75,61,57],[78,0,62,4,"webSocketInstance"],[78,4,62,4,"webSocketInstance"],[78,21,62,21],[78,22,62,22,"onerror"],[78,29,62,4],[78,32,62,32],[78,42,62,42,"error"],[78,47,62,32],[78,49,62,49],[79,0,63,8,"manage_subscribers_1"],[79,6,63,8,"manage_subscribers_1"],[79,26,63,28],[79,27,63,29,"getSubscribers"],[79,41,63,8],[79,42,63,44,"url"],[79,45,63,8],[79,47,63,49,"forEach"],[79,54,63,8],[79,55,63,57],[79,65,63,67,"subscriber"],[79,75,63,57],[79,77,63,79],[80,0,64,12],[80,12,64,16,"subscriber"],[80,22,64,26],[80,23,64,27,"optionsRef"],[80,33,64,16],[80,34,64,38,"current"],[80,41,64,16],[80,42,64,46,"onError"],[80,49,64,12],[80,51,64,55],[81,0,65,16,"subscriber"],[81,10,65,16,"subscriber"],[81,20,65,26],[81,21,65,27,"optionsRef"],[81,31,65,16],[81,32,65,38,"current"],[81,39,65,16],[81,40,65,46,"onError"],[81,47,65,16],[81,48,65,54,"error"],[81,53,65,16],[82,0,66,13],[83,0,67,9],[83,7,63,8],[84,0,68,5],[84,5,62,4],[85,0,69,1],[85,3,61,0],[87,0,70,0,"exports"],[87,2,70,0,"exports"],[87,9,70,7],[87,10,70,8,"attachSharedListeners"],[87,31,70,0],[87,34,70,32],[87,44,70,42,"webSocketInstance"],[87,61,70,32],[87,63,70,61,"url"],[87,66,70,32],[87,68,70,66,"optionsRef"],[87,78,70,32],[87,80,70,78,"sendMessage"],[87,91,70,32],[87,93,70,91],[88,0,71,4],[88,8,71,8,"interval"],[88,16,71,4],[90,0,72,4],[90,8,72,8,"optionsRef"],[90,18,72,18],[90,19,72,19,"current"],[90,26,72,8],[90,27,72,27,"fromSocketIO"],[90,39,72,4],[90,41,72,41],[91,0,73,8,"interval"],[91,6,73,8,"interval"],[91,14,73,16],[91,17,73,19,"socket_io_1"],[91,28,73,30],[91,29,73,31,"setUpSocketIOPing"],[91,46,73,19],[91,47,73,49,"sendMessage"],[91,58,73,19],[91,59,73,8],[92,0,74,5],[94,0,75,4,"bindMessageHandler"],[94,4,75,4,"bindMessageHandler"],[94,22,75,22],[94,23,75,23,"webSocketInstance"],[94,40,75,22],[94,42,75,42,"url"],[94,45,75,22],[94,46,75,4],[95,0,76,4,"bindCloseHandler"],[95,4,76,4,"bindCloseHandler"],[95,20,76,20],[95,21,76,21,"webSocketInstance"],[95,38,76,20],[95,40,76,40,"url"],[95,43,76,20],[95,44,76,4],[96,0,77,4,"bindOpenHandler"],[96,4,77,4,"bindOpenHandler"],[96,19,77,19],[96,20,77,20,"webSocketInstance"],[96,37,77,19],[96,39,77,39,"url"],[96,42,77,19],[96,43,77,4],[97,0,78,4,"bindErrorHandler"],[97,4,78,4,"bindErrorHandler"],[97,20,78,20],[97,21,78,21,"webSocketInstance"],[97,38,78,20],[97,40,78,40,"url"],[97,43,78,20],[97,44,78,4],[98,0,79,4],[98,11,79,11],[98,23,79,23],[99,0,80,8],[99,10,80,12,"interval"],[99,18,80,8],[99,20,81,12,"clearInterval"],[99,33,81,25],[99,34,81,26,"interval"],[99,42,81,25],[99,43,81,12],[100,0,82,5],[100,5,79,4],[101,0,83,1],[101,3,70,0]],"functionMap":{"names":["<global>","bindMessageHandler","webSocketInstance.onmessage","manage_subscribers_1.getSubscribers.forEach$argument_0","bindOpenHandler","webSocketInstance.onopen","bindCloseHandler","webSocketInstance.onclose","setTimeout$argument_0","bindErrorHandler","webSocketInstance.onerror","exports.attachSharedListeners","<anonymous>"],"mappings":"AAA;yBCO;kCCC;yDCC;SDS;KDC;CDC;sBIC;+BCC;yDFC;SEM;KDC;CJC;uBMC;gCCC;yDJC;SIK;yDJE;+BKM;qBLG;SIO;KDC;CNC;uBSC;gCCC;yDPC;SOI;KDC;CTC;gCWC;WCS;KDG;CXC"}},"type":"js/module"}]}