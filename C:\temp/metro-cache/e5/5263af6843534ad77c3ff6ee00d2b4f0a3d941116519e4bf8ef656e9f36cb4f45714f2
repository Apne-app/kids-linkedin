{"dependencies":[{"name":"../util/class","data":{"isAsync":false,"locs":[{"start":{"line":3,"column":17},"end":{"line":3,"column":41}}]}},{"name":"../util/promise","data":{"isAsync":false,"locs":[{"start":{"line":4,"column":17},"end":{"line":4,"column":43}}]}},{"name":"../util/set","data":{"isAsync":false,"locs":[{"start":{"line":5,"column":17},"end":{"line":5,"column":39}}]}},{"name":"../util/uri","data":{"isAsync":false,"locs":[{"start":{"line":6,"column":17},"end":{"line":6,"column":39}}]}},{"name":"../util/browser","data":{"isAsync":false,"locs":[{"start":{"line":7,"column":17},"end":{"line":7,"column":43}}]}},{"name":"../util/copy_object","data":{"isAsync":false,"locs":[{"start":{"line":8,"column":17},"end":{"line":8,"column":47}}]}},{"name":"../util/assign","data":{"isAsync":false,"locs":[{"start":{"line":9,"column":17},"end":{"line":9,"column":42}}]}},{"name":"../util/to_json","data":{"isAsync":false,"locs":[{"start":{"line":10,"column":17},"end":{"line":10,"column":43}}]}},{"name":"../util/websocket","data":{"isAsync":false,"locs":[{"start":{"line":11,"column":17},"end":{"line":11,"column":45}}]}},{"name":"../mixins/deferrable","data":{"isAsync":false,"locs":[{"start":{"line":12,"column":17},"end":{"line":12,"column":48}}]}},{"name":"./transport","data":{"isAsync":false,"locs":[{"start":{"line":13,"column":17},"end":{"line":13,"column":39}}]}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){'use strict';var t=r(d[0]),n=r(d[1]),s=r(d[2]),o=r(d[3]),c=r(d[4]),h=r(d[5]),u=r(d[6]),f=r(d[7]),l=r(d[8]),_=r(d[9]),p=u(t(r(d[10]),{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(t,n){this.callback(function(){t.call(n,!0)}),this.errback(function(){t.call(n,!1)}),this.connect()},request:function(t){this._pending=this._pending||new s;for(var o=0,c=t.length;o<c;o++)this._pending.add(t[o]);var h=this,u=new n(function(n,s){h.callback(function(s){s&&1===s.readyState&&(s.send(f(t)),n(s))}),h.connect()});return{abort:function(){u.then(function(t){t.close()})}}},connect:function(){if(!p._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var t=this._createSocket();if(!t)return this.setDeferredStatus('failed');var n=this;t.onopen=function(){t.headers&&n._storeCookies(t.headers['set-cookie']),n._socket=t,n._state=n.CONNECTED,n._everConnected=!0,n.setDeferredStatus('succeeded',t)};var s=!1;t.onclose=t.onerror=function(){if(!s){s=!0;var o=n._state===n.CONNECTED;t.onopen=t.onclose=t.onerror=t.onmessage=null,delete n._socket,n._state=n.UNCONNECTED;var c=n._pending?n._pending.toArray():[];delete n._pending,o||n._everConnected?(n.setDeferredStatus('unknown'),n._handleError(c,o)):n.setDeferredStatus('failed')}},t.onmessage=function(t){var s;try{s=JSON.parse(t.data)}catch(t){}if(s){for(var o=0,c=(s=[].concat(s)).length;o<c;o++)void 0!==s[o].successful&&n._pending.remove(s[o]);n._receive(s)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var t=p.getSocketUrl(this.endpoint),n=this._dispatcher.headers,s=this._dispatcher.wsExtensions,o=this._getCookies(),c=this._dispatcher.tls,h={extensions:s,headers:n,proxy:this._proxy,tls:c};''!==o&&(h.headers.Cookie=o);try{return l.create(t,[],h)}catch(t){}}}),{PROTOCOLS:{'http:':'ws:','https:':'wss:'},create:function(t,n){var s=t.transports.websocket=t.transports.websocket||{};return s[n.href]=s[n.href]||new this(t,n),s[n.href]},getSocketUrl:function(t){return(t=h(t)).protocol=this.PROTOCOLS[t.protocol],o.stringify(t)},isUsable:function(t,n,s,o){this.create(t,n).isUsable(s,o)}});u(p.prototype,_),c.Event&&void 0!==g.onbeforeunload&&c.Event.on(g,'beforeunload',function(){void 0===p._unloaded&&(p._unloaded=!0)}),m.exports=p});","lineCount":1,"map":[[1,28,1,0],[1,41,3,0],[1,45,3,4,"Class"],[1,47,3,17,"require"],[1,49,3,24,"d"],[1,51,3,24],[1,55,4,4,"Promise"],[1,57,4,17,"require"],[1,59,4,24,"d"],[1,61,4,24],[1,65,5,4,"Set"],[1,67,5,17,"require"],[1,69,5,24,"d"],[1,71,5,24],[1,75,6,4,"URI"],[1,77,6,17,"require"],[1,79,6,24,"d"],[1,81,6,24],[1,85,7,4,"browser"],[1,87,7,17,"require"],[1,89,7,24,"d"],[1,91,7,24],[1,95,8,4,"copyObject"],[1,97,8,17,"require"],[1,99,8,24,"d"],[1,101,8,24],[1,105,9,4,"assign"],[1,107,9,17,"require"],[1,109,9,24,"d"],[1,111,9,24],[1,115,10,4,"toJSON"],[1,117,10,17,"require"],[1,119,10,24,"d"],[1,121,10,24],[1,125,11,4,"ws"],[1,127,11,17,"require"],[1,129,11,24,"d"],[1,131,11,24],[1,135,12,4,"Deferrable"],[1,137,12,17,"require"],[1,139,12,24,"d"],[1,141,12,24],[1,145,15,4,"WebSocket"],[1,147,15,16,"assign"],[1,149,15,23,"Class"],[1,151,13,17,"require"],[1,153,13,24,"d"],[1,155,13,24],[1,161,16,2,"UNCONNECTED"],[1,173,16,16],[1,175,17,2,"CONNECTING"],[1,186,17,16],[1,188,18,2,"CONNECTED"],[1,198,18,16],[1,200,20,2,"batching"],[1,210,20,16],[1,212,22,2,"isUsable"],[1,221,22,12],[1,230,22,21,"callback"],[1,232,22,31,"context"],[1,235,23,4,"this"],[1,240,23,9,"callback"],[1,249,23,18],[1,260,23,31,"callback"],[1,262,23,40,"call"],[1,267,23,45,"context"],[1,270,23,54],[1,275,24,4,"this"],[1,280,24,9,"errback"],[1,288,24,17],[1,299,24,30,"callback"],[1,301,24,39,"call"],[1,306,24,44,"context"],[1,309,24,53],[1,314,25,4,"this"],[1,319,25,9,"connect"],[1,330,28,2,"request"],[1,338,28,11],[1,347,28,20,"messages"],[1,350,29,4,"this"],[1,355,29,9,"_pending"],[1,364,29,20,"this"],[1,369,29,25,"_pending"],[1,379,29,37],[1,383,29,41,"Set"],[1,385,30,4],[1,389,30,9],[1,393,30,13,"i"],[1,395,30,17],[1,397,30,20,"n"],[1,399,30,24,"messages"],[1,401,30,33,"length"],[1,408,30,41,"i"],[1,410,30,45,"n"],[1,412,30,48,"i"],[1,416,30,53,"this"],[1,421,30,58,"_pending"],[1,430,30,67,"add"],[1,434,30,71,"messages"],[1,436,30,80,"i"],[1,440,32,4],[1,444,32,8,"self"],[1,446,32,15,"this"],[1,451,34,8,"promise"],[1,453,34,18],[1,457,34,22,"Promise"],[1,459,34,30],[1,468,34,39,"resolve"],[1,470,34,48,"reject"],[1,473,35,6,"self"],[1,475,35,11,"callback"],[1,484,35,20],[1,493,35,29,"socket"],[1,496,36,13,"socket"],[1,499,36,45],[1,503,36,23,"socket"],[1,505,36,30,"readyState"],[1,518,37,8,"socket"],[1,520,37,15,"send"],[1,525,37,20,"toJSON"],[1,527,37,27,"messages"],[1,531,38,8,"resolve"],[1,533,38,16,"socket"],[1,539,41,6,"self"],[1,541,41,11,"connect"],[1,553,44,4],[1,560,45,6,"abort"],[1,566,45,13],[1,577,45,26,"promise"],[1,579,45,34,"then"],[1,584,45,39],[1,593,45,48,"ws"],[1,596,45,54,"ws"],[1,598,45,57,"close"],[1,611,49,2,"connect"],[1,619,49,11],[1,630,50,4],[1,634,50,8,"WebSocket"],[1,636,50,18,"_unloaded"],[1,648,52,4,"this"],[1,653,52,9,"_state"],[1,660,52,18,"this"],[1,665,52,23,"_state"],[1,673,52,33,"this"],[1,678,52,38,"UNCONNECTED"],[1,690,53,8,"this"],[1,695,53,13,"_state"],[1,704,53,24,"this"],[1,709,53,29,"UNCONNECTED"],[1,722,53,4],[1,723,54,4,"this"],[1,728,54,9,"_state"],[1,735,54,18,"this"],[1,740,54,23,"CONNECTING"],[1,751,56,4],[1,755,56,8,"socket"],[1,757,56,17,"this"],[1,762,56,22,"_createSocket"],[1,778,57,4],[1,782,57,9,"socket"],[1,784,57,17],[1,791,57,24,"this"],[1,796,57,29,"setDeferredStatus"],[1,814,57,47],[1,824,59,4],[1,828,59,8,"self"],[1,830,59,15,"this"],[1,835,61,4,"socket"],[1,837,61,11,"onopen"],[1,844,61,20],[1,855,62,10,"socket"],[1,857,62,17,"headers"],[1,866,62,26,"self"],[1,868,62,31,"_storeCookies"],[1,882,62,45,"socket"],[1,884,62,52,"headers"],[1,892,62,60],[1,907,63,6,"self"],[1,909,63,11,"_socket"],[1,917,63,21,"socket"],[1,919,64,6,"self"],[1,921,64,11,"_state"],[1,928,64,20,"self"],[1,930,64,25,"CONNECTED"],[1,940,65,6,"self"],[1,942,65,11,"_everConnected"],[1,958,65,28],[1,960,66,6,"self"],[1,962,66,11,"setDeferredStatus"],[1,980,66,29],[1,992,66,42,"socket"],[1,996,69,4],[1,1000,69,8,"closed"],[1,1003,69,17],[1,1005,70,4,"socket"],[1,1007,70,11,"onclose"],[1,1015,70,21,"socket"],[1,1017,70,28,"onerror"],[1,1025,70,38],[1,1036,71,6],[1,1040,71,10,"closed"],[1,1042,71,6],[1,1043,72,6,"closed"],[1,1046,72,15],[1,1048,74,6],[1,1052,74,10,"wasConnected"],[1,1054,74,26,"self"],[1,1056,74,31,"_state"],[1,1065,74,42,"self"],[1,1067,74,47,"CONNECTED"],[1,1077,75,6,"socket"],[1,1079,75,13,"onopen"],[1,1086,75,22,"socket"],[1,1088,75,29,"onclose"],[1,1096,75,39,"socket"],[1,1098,75,46,"onerror"],[1,1106,75,56,"socket"],[1,1108,75,63,"onmessage"],[1,1118,75,75],[1,1130,77,13,"self"],[1,1132,77,18,"_socket"],[1,1140,78,6,"self"],[1,1142,78,11,"_state"],[1,1149,78,20,"self"],[1,1151,78,25,"UNCONNECTED"],[1,1163,80,6],[1,1167,80,10,"pending"],[1,1169,80,20,"self"],[1,1171,80,25,"_pending"],[1,1180,80,36,"self"],[1,1182,80,41,"_pending"],[1,1191,80,50,"toArray"],[1,1211,81,13,"self"],[1,1213,81,18,"_pending"],[1,1222,83,10,"wasConnected"],[1,1225,83,26,"self"],[1,1227,83,31,"_everConnected"],[1,1243,84,8,"self"],[1,1245,84,13,"setDeferredStatus"],[1,1263,84,31],[1,1274,85,8,"self"],[1,1276,85,13,"_handleError"],[1,1289,85,26,"pending"],[1,1291,85,35,"wasConnected"],[1,1295,87,8,"self"],[1,1297,87,13,"setDeferredStatus"],[1,1315,87,31],[1,1327,91,4,"socket"],[1,1329,91,11,"onmessage"],[1,1339,91,23],[1,1348,91,32,"event"],[1,1351,92,6],[1,1355,92,10,"replies"],[1,1357,93,6],[1,1361,93,12,"replies"],[1,1363,93,22,"JSON"],[1,1368,93,27,"parse"],[1,1374,93,33,"event"],[1,1376,93,39,"data"],[1,1382,93,47],[1,1388,93,54,"error"],[1,1392,95,6],[1,1395,95,11,"replies"],[1,1397,95,6],[1,1398,99,6],[1,1402,99,11],[1,1406,99,15,"i"],[1,1408,99,19],[1,1410,99,22,"n"],[1,1413,97,6,"replies"],[1,1418,97,19,"concat"],[1,1425,97,26,"replies"],[1,1429,99,34,"length"],[1,1436,99,42,"i"],[1,1438,99,46,"n"],[1,1440,99,49,"i"],[1,1449,100,38,"undefined"],[1,1453,100,12,"replies"],[1,1455,100,20,"i"],[1,1458,100,23,"successful"],[1,1470,101,8,"self"],[1,1472,101,13,"_pending"],[1,1481,101,22,"remove"],[1,1488,101,29,"replies"],[1,1490,101,37,"i"],[1,1494,103,6,"self"],[1,1496,103,11,"_receive"],[1,1505,103,20,"replies"],[1,1512,107,2,"close"],[1,1518,107,9],[1,1529,108,9,"this"],[1,1534,108,14,"_socket"],[1,1543,109,4,"this"],[1,1548,109,9,"_socket"],[1,1556,109,17,"close"],[1,1565,112,2,"_createSocket"],[1,1579,112,17],[1,1590,113,4],[1,1594,113,8,"url"],[1,1596,113,21,"WebSocket"],[1,1598,113,31,"getSocketUrl"],[1,1611,113,44,"this"],[1,1616,113,49,"endpoint"],[1,1626,114,8,"headers"],[1,1628,114,21,"this"],[1,1633,114,26,"_dispatcher"],[1,1645,114,38,"headers"],[1,1653,115,8,"extensions"],[1,1655,115,21,"this"],[1,1660,115,26,"_dispatcher"],[1,1672,115,38,"wsExtensions"],[1,1685,116,8,"cookie"],[1,1687,116,21,"this"],[1,1692,116,26,"_getCookies"],[1,1706,117,8,"tls"],[1,1708,117,21,"this"],[1,1713,117,26,"_dispatcher"],[1,1725,117,38,"tls"],[1,1729,118,8,"options"],[1,1732,118,23,"extensions"],[1,1743,118,35,"extensions"],[1,1745,118,47,"headers"],[1,1753,118,56,"headers"],[1,1755,118,65,"proxy"],[1,1761,118,72,"this"],[1,1766,118,77,"_proxy"],[1,1773,118,85,"tls"],[1,1777,118,90,"tls"],[1,1780,120,19],[1,1785,120,8,"cookie"],[1,1789,120,23,"options"],[1,1791,120,31,"headers"],[1,1799,120,23],[1,1806,120,51,"cookie"],[1,1809,122,4],[1,1813,123,6],[1,1820,123,13,"ws"],[1,1822,123,16,"create"],[1,1829,123,23,"url"],[1,1834,123,32,"options"],[1,1837,124,6],[1,1843,124,13,"e"],[1,1852,130,2,"PROTOCOLS"],[1,1863,131,4,"http:"],[1,1871,131,14],[1,1877,132,4,"https:"],[1,1886,132,14],[1,1894,135,2,"create"],[1,1901,135,10],[1,1910,135,19,"dispatcher"],[1,1912,135,31,"endpoint"],[1,1915,136,4],[1,1919,136,8,"sockets"],[1,1921,136,18,"dispatcher"],[1,1923,136,29,"transports"],[1,1934,136,40,"websocket"],[1,1944,136,52,"dispatcher"],[1,1946,136,63,"transports"],[1,1957,136,74,"websocket"],[1,1971,138,4],[1,1978,137,4,"sockets"],[1,1980,137,12,"endpoint"],[1,1982,137,21,"href"],[1,1988,137,29,"sockets"],[1,1990,137,37,"endpoint"],[1,1992,137,46,"href"],[1,1999,137,55],[1,2003,137,59,"this"],[1,2008,137,64,"dispatcher"],[1,2010,137,76,"endpoint"],[1,2013,138,11,"sockets"],[1,2015,138,19,"endpoint"],[1,2017,138,28,"href"],[1,2024,141,2,"getSocketUrl"],[1,2037,141,16],[1,2046,141,25,"endpoint"],[1,2049,144,4],[1,2056,142,4,"endpoint"],[1,2058,142,15,"copyObject"],[1,2060,142,26,"endpoint"],[1,2064,143,13,"protocol"],[1,2073,143,24,"this"],[1,2078,143,29,"PROTOCOLS"],[1,2088,143,39,"endpoint"],[1,2090,143,48,"protocol"],[1,2100,144,11,"URI"],[1,2102,144,15,"stringify"],[1,2112,144,25,"endpoint"],[1,2116,147,2,"isUsable"],[1,2125,147,12],[1,2134,147,21,"dispatcher"],[1,2136,147,33,"endpoint"],[1,2138,147,43,"callback"],[1,2140,147,53,"context"],[1,2143,148,4,"this"],[1,2148,148,9,"create"],[1,2155,148,16,"dispatcher"],[1,2157,148,28,"endpoint"],[1,2160,148,38,"isUsable"],[1,2169,148,47,"callback"],[1,2171,148,57,"context"],[1,2177,152,0,"assign"],[1,2179,152,7,"WebSocket"],[1,2181,152,17,"prototype"],[1,2191,152,28,"Deferrable"],[1,2194,154,4,"browser"],[1,2196,154,12,"Event"],[1,2208,154,47,"undefined"],[1,2212,154,21,"global"],[1,2214,154,28,"onbeforeunload"],[1,2230,155,2,"browser"],[1,2232,155,10,"Event"],[1,2238,155,16,"on"],[1,2241,155,19,"global"],[1,2243,155,27],[1,2258,155,43],[1,2274,156,32,"undefined"],[1,2278,156,8,"WebSocket"],[1,2280,156,18,"_unloaded"],[1,2292,157,6,"WebSocket"],[1,2294,157,16,"_unloaded"],[1,2305,157,28],[1,2310,161,0,"module"],[1,2312,161,7,"exports"],[1,2320,161,17,"WebSocket"]],"functionMap":{"names":["<global>","Class$argument_1.isUsable","callback$argument_0","errback$argument_0","Class$argument_1.request","Promise$argument_0","self.callback$argument_0","abort","promise.then$argument_0","Class$argument_1.connect","socket.onopen","socket.onerror","socket.onmessage","Class$argument_1.close","Class$argument_1._createSocket","assign$argument_1.create","assign$argument_1.getSocketUrl","assign$argument_1.isUsable","browser.Event.on$argument_2"],"mappings":"AAA;YCqB;kBCC,2CD;iBEC,4CF;GDE;WIE;8BCM;oBCC;ODI;KDG;aGG,0BC,2BD,GH;GJE;WSE;oBCY;KDM;sCEG;KFmB;uBGE;KHa;GTC;SaE;GbG;iBcE;Gde;UeQ;GfI;gBgBE;GhBI;YiBE;GjBE;2CkBM;GlBG"}},"type":"js/module"}]}