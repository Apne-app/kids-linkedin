{"dependencies":[{"name":"./globals","data":{"isAsync":false}},{"name":"./constants","data":{"isAsync":false}},{"name":"./manage-subscribers","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  var globals_1 = _$$_REQUIRE(_dependencyMap[0], \"./globals\");\n\n  var constants_1 = _$$_REQUIRE(_dependencyMap[1], \"./constants\");\n\n  var manage_subscribers_1 = _$$_REQUIRE(_dependencyMap[2], \"./manage-subscribers\");\n\n  exports.attachSharedListeners = function (webSocketInstance, url) {\n    webSocketInstance.onmessage = function (message) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        if (subscriber.optionsRef.current.onMessage) {\n          subscriber.optionsRef.current.onMessage(message);\n        }\n\n        if (typeof subscriber.optionsRef.current.filter === 'function' && subscriber.optionsRef.current.filter(message) !== true) {\n          return;\n        }\n\n        subscriber.setLastMessage(message);\n      });\n    };\n\n    webSocketInstance.onclose = function (event) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        if (subscriber.optionsRef.current.onClose) {\n          subscriber.optionsRef.current.onClose(event);\n        }\n\n        subscriber.setReadyState(constants_1.ReadyState.CLOSED);\n      });\n      delete globals_1.sharedWebSockets[url];\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        var _a, _b;\n\n        if (subscriber.optionsRef.current.shouldReconnect && subscriber.optionsRef.current.shouldReconnect(event)) {\n          var reconnectAttempts = (_a = subscriber.optionsRef.current.reconnectAttempts, _a !== null && _a !== void 0 ? _a : constants_1.DEFAULT_RECONNECT_LIMIT);\n\n          if (subscriber.reconnectCount.current < reconnectAttempts) {\n            if (subscriber.reconnectCount.current++ === 0) {\n              subscriber.reconnect.current();\n            } else {\n              setTimeout(function () {\n                subscriber.reconnect.current();\n              }, (_b = subscriber.optionsRef.current.reconnectInterval, _b !== null && _b !== void 0 ? _b : constants_1.DEFAULT_RECONNECT_INTERVAL_MS));\n            }\n          } else {\n            console.error(\"Max reconnect attempts of \" + reconnectAttempts + \" exceeded\");\n          }\n        }\n      });\n    };\n\n    webSocketInstance.onerror = function (error) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        if (subscriber.optionsRef.current.onError) {\n          subscriber.optionsRef.current.onError(error);\n        }\n      });\n    };\n\n    webSocketInstance.onopen = function (event) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        subscriber.reconnectCount.current = 0;\n\n        if (subscriber.optionsRef.current.onOpen) {\n          subscriber.optionsRef.current.onOpen(event);\n        }\n\n        subscriber.setReadyState(constants_1.ReadyState.OPEN);\n      });\n    };\n  };\n});","lineCount":79,"map":[[2,0,1,0],[4,0,2,0,"Object"],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,0],[4,24,2,22,"exports"],[4,31,2,0],[4,33,2,31],[4,45,2,0],[4,47,2,45],[5,0,2,47,"value"],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,0,2,45],[6,3,2,0],[8,0,3,0],[8,6,3,4,"globals_1"],[8,15,3,13],[8,18,3,16,"require"],[8,29,3,23],[8,61,3,0],[10,0,4,0],[10,6,4,4,"constants_1"],[10,17,4,15],[10,20,4,18,"require"],[10,31,4,25],[10,65,4,0],[12,0,5,0],[12,6,5,4,"manage_subscribers_1"],[12,26,5,24],[12,29,5,27,"require"],[12,40,5,34],[12,83,5,0],[14,0,6,0,"exports"],[14,2,6,0,"exports"],[14,9,6,7],[14,10,6,8,"attachSharedListeners"],[14,31,6,0],[14,34,6,32],[14,44,6,42,"webSocketInstance"],[14,61,6,32],[14,63,6,61,"url"],[14,66,6,32],[14,68,6,66],[15,0,7,4,"webSocketInstance"],[15,4,7,4,"webSocketInstance"],[15,21,7,21],[15,22,7,22,"onmessage"],[15,31,7,4],[15,34,7,34],[15,44,7,44,"message"],[15,51,7,34],[15,53,7,53],[16,0,8,8,"manage_subscribers_1"],[16,6,8,8,"manage_subscribers_1"],[16,26,8,28],[16,27,8,29,"getSubscribers"],[16,41,8,8],[16,42,8,44,"url"],[16,45,8,8],[16,47,8,49,"forEach"],[16,54,8,8],[16,55,8,57],[16,65,8,67,"subscriber"],[16,75,8,57],[16,77,8,79],[17,0,9,12],[17,12,9,16,"subscriber"],[17,22,9,26],[17,23,9,27,"optionsRef"],[17,33,9,16],[17,34,9,38,"current"],[17,41,9,16],[17,42,9,46,"onMessage"],[17,51,9,12],[17,53,9,57],[18,0,10,16,"subscriber"],[18,10,10,16,"subscriber"],[18,20,10,26],[18,21,10,27,"optionsRef"],[18,31,10,16],[18,32,10,38,"current"],[18,39,10,16],[18,40,10,46,"onMessage"],[18,49,10,16],[18,50,10,56,"message"],[18,57,10,16],[19,0,11,13],[21,0,12,12],[21,12,12,16],[21,19,12,23,"subscriber"],[21,29,12,33],[21,30,12,34,"optionsRef"],[21,40,12,23],[21,41,12,45,"current"],[21,48,12,23],[21,49,12,53,"filter"],[21,55,12,16],[21,60,12,64],[21,70,12,16],[21,74,13,16,"subscriber"],[21,84,13,26],[21,85,13,27,"optionsRef"],[21,95,13,16],[21,96,13,38,"current"],[21,103,13,16],[21,104,13,46,"filter"],[21,110,13,16],[21,111,13,53,"message"],[21,118,13,16],[21,124,13,66],[21,128,12,12],[21,130,13,72],[22,0,14,16],[23,0,15,13],[25,0,16,12,"subscriber"],[25,8,16,12,"subscriber"],[25,18,16,22],[25,19,16,23,"setLastMessage"],[25,33,16,12],[25,34,16,38,"message"],[25,41,16,12],[26,0,17,9],[26,7,8,8],[27,0,18,5],[27,5,7,4],[29,0,19,4,"webSocketInstance"],[29,4,19,4,"webSocketInstance"],[29,21,19,21],[29,22,19,22,"onclose"],[29,29,19,4],[29,32,19,32],[29,42,19,42,"event"],[29,47,19,32],[29,49,19,49],[30,0,20,8,"manage_subscribers_1"],[30,6,20,8,"manage_subscribers_1"],[30,26,20,28],[30,27,20,29,"getSubscribers"],[30,41,20,8],[30,42,20,44,"url"],[30,45,20,8],[30,47,20,49,"forEach"],[30,54,20,8],[30,55,20,57],[30,65,20,67,"subscriber"],[30,75,20,57],[30,77,20,79],[31,0,21,12],[31,12,21,16,"subscriber"],[31,22,21,26],[31,23,21,27,"optionsRef"],[31,33,21,16],[31,34,21,38,"current"],[31,41,21,16],[31,42,21,46,"onClose"],[31,49,21,12],[31,51,21,55],[32,0,22,16,"subscriber"],[32,10,22,16,"subscriber"],[32,20,22,26],[32,21,22,27,"optionsRef"],[32,31,22,16],[32,32,22,38,"current"],[32,39,22,16],[32,40,22,46,"onClose"],[32,47,22,16],[32,48,22,54,"event"],[32,53,22,16],[33,0,23,13],[35,0,24,12,"subscriber"],[35,8,24,12,"subscriber"],[35,18,24,22],[35,19,24,23,"setReadyState"],[35,32,24,12],[35,33,24,37,"constants_1"],[35,44,24,48],[35,45,24,49,"ReadyState"],[35,55,24,37],[35,56,24,60,"CLOSED"],[35,62,24,12],[36,0,25,9],[36,7,20,8],[37,0,26,8],[37,13,26,15,"globals_1"],[37,22,26,24],[37,23,26,25,"sharedWebSockets"],[37,39,26,15],[37,40,26,42,"url"],[37,43,26,15],[37,44,26,8],[38,0,27,8,"manage_subscribers_1"],[38,6,27,8,"manage_subscribers_1"],[38,26,27,28],[38,27,27,29,"getSubscribers"],[38,41,27,8],[38,42,27,44,"url"],[38,45,27,8],[38,47,27,49,"forEach"],[38,54,27,8],[38,55,27,57],[38,65,27,67,"subscriber"],[38,75,27,57],[38,77,27,79],[39,0,28,12],[39,12,28,16,"_a"],[39,14,28,12],[39,16,28,20,"_b"],[39,18,28,12],[41,0,29,12],[41,12,29,16,"subscriber"],[41,22,29,26],[41,23,29,27,"optionsRef"],[41,33,29,16],[41,34,29,38,"current"],[41,41,29,16],[41,42,29,46,"shouldReconnect"],[41,57,29,16],[41,61,30,16,"subscriber"],[41,71,30,26],[41,72,30,27,"optionsRef"],[41,82,30,16],[41,83,30,38,"current"],[41,90,30,16],[41,91,30,46,"shouldReconnect"],[41,106,30,16],[41,107,30,62,"event"],[41,112,30,16],[41,113,29,12],[41,115,30,70],[42,0,31,16],[42,14,31,20,"reconnectAttempts"],[42,31,31,37],[42,35,31,41,"_a"],[42,37,31,43],[42,40,31,46,"subscriber"],[42,50,31,56],[42,51,31,57,"optionsRef"],[42,61,31,46],[42,62,31,68,"current"],[42,69,31,46],[42,70,31,76,"reconnectAttempts"],[42,87,31,41],[42,89,31,96,"_a"],[42,91,31,98],[42,96,31,103],[42,100,31,96],[42,104,31,111,"_a"],[42,106,31,113],[42,111,31,118],[42,116,31,123],[42,117,31,96],[42,120,31,127,"_a"],[42,122,31,96],[42,125,31,132,"constants_1"],[42,136,31,143],[42,137,31,144,"DEFAULT_RECONNECT_LIMIT"],[42,160,31,37],[42,161,31,16],[44,0,32,16],[44,14,32,20,"subscriber"],[44,24,32,30],[44,25,32,31,"reconnectCount"],[44,39,32,20],[44,40,32,46,"current"],[44,47,32,20],[44,50,32,56,"reconnectAttempts"],[44,67,32,16],[44,69,32,75],[45,0,33,20],[45,16,33,24,"subscriber"],[45,26,33,34],[45,27,33,35,"reconnectCount"],[45,41,33,24],[45,42,33,50,"current"],[45,49,33,24],[45,56,33,64],[45,57,33,20],[45,59,33,67],[46,0,34,24,"subscriber"],[46,14,34,24,"subscriber"],[46,24,34,34],[46,25,34,35,"reconnect"],[46,34,34,24],[46,35,34,45,"current"],[46,42,34,24],[47,0,35,21],[47,13,33,20],[47,19,36,25],[48,0,37,24,"setTimeout"],[48,14,37,24,"setTimeout"],[48,24,37,34],[48,25,37,35],[48,37,37,47],[49,0,38,28,"subscriber"],[49,16,38,28,"subscriber"],[49,26,38,38],[49,27,38,39,"reconnect"],[49,36,38,28],[49,37,38,49,"current"],[49,44,38,28],[50,0,39,25],[50,15,37,34],[50,18,39,28,"_b"],[50,20,39,30],[50,23,39,33,"subscriber"],[50,33,39,43],[50,34,39,44,"optionsRef"],[50,44,39,33],[50,45,39,55,"current"],[50,52,39,33],[50,53,39,63,"reconnectInterval"],[50,70,39,28],[50,72,39,83,"_b"],[50,74,39,85],[50,79,39,90],[50,83,39,83],[50,87,39,98,"_b"],[50,89,39,100],[50,94,39,105],[50,99,39,110],[50,100,39,83],[50,103,39,114,"_b"],[50,105,39,83],[50,108,39,119,"constants_1"],[50,119,39,130],[50,120,39,131,"DEFAULT_RECONNECT_INTERVAL_MS"],[50,149,37,34],[50,151,37,24],[51,0,40,21],[52,0,41,17],[52,11,32,16],[52,17,42,21],[53,0,43,20,"console"],[53,12,43,20,"console"],[53,19,43,27],[53,20,43,28,"error"],[53,25,43,20],[53,26,43,34],[53,57,43,65,"reconnectAttempts"],[53,74,43,34],[53,77,43,85],[53,88,43,20],[54,0,44,17],[55,0,45,13],[56,0,46,9],[56,7,27,8],[57,0,47,5],[57,5,19,4],[59,0,48,4,"webSocketInstance"],[59,4,48,4,"webSocketInstance"],[59,21,48,21],[59,22,48,22,"onerror"],[59,29,48,4],[59,32,48,32],[59,42,48,42,"error"],[59,47,48,32],[59,49,48,49],[60,0,49,8,"manage_subscribers_1"],[60,6,49,8,"manage_subscribers_1"],[60,26,49,28],[60,27,49,29,"getSubscribers"],[60,41,49,8],[60,42,49,44,"url"],[60,45,49,8],[60,47,49,49,"forEach"],[60,54,49,8],[60,55,49,57],[60,65,49,67,"subscriber"],[60,75,49,57],[60,77,49,79],[61,0,50,12],[61,12,50,16,"subscriber"],[61,22,50,26],[61,23,50,27,"optionsRef"],[61,33,50,16],[61,34,50,38,"current"],[61,41,50,16],[61,42,50,46,"onError"],[61,49,50,12],[61,51,50,55],[62,0,51,16,"subscriber"],[62,10,51,16,"subscriber"],[62,20,51,26],[62,21,51,27,"optionsRef"],[62,31,51,16],[62,32,51,38,"current"],[62,39,51,16],[62,40,51,46,"onError"],[62,47,51,16],[62,48,51,54,"error"],[62,53,51,16],[63,0,52,13],[64,0,53,9],[64,7,49,8],[65,0,54,5],[65,5,48,4],[67,0,55,4,"webSocketInstance"],[67,4,55,4,"webSocketInstance"],[67,21,55,21],[67,22,55,22,"onopen"],[67,28,55,4],[67,31,55,31],[67,41,55,41,"event"],[67,46,55,31],[67,48,55,48],[68,0,56,8,"manage_subscribers_1"],[68,6,56,8,"manage_subscribers_1"],[68,26,56,28],[68,27,56,29,"getSubscribers"],[68,41,56,8],[68,42,56,44,"url"],[68,45,56,8],[68,47,56,49,"forEach"],[68,54,56,8],[68,55,56,57],[68,65,56,67,"subscriber"],[68,75,56,57],[68,77,56,79],[69,0,57,12,"subscriber"],[69,8,57,12,"subscriber"],[69,18,57,22],[69,19,57,23,"reconnectCount"],[69,33,57,12],[69,34,57,38,"current"],[69,41,57,12],[69,44,57,48],[69,45,57,12],[71,0,58,12],[71,12,58,16,"subscriber"],[71,22,58,26],[71,23,58,27,"optionsRef"],[71,33,58,16],[71,34,58,38,"current"],[71,41,58,16],[71,42,58,46,"onOpen"],[71,48,58,12],[71,50,58,54],[72,0,59,16,"subscriber"],[72,10,59,16,"subscriber"],[72,20,59,26],[72,21,59,27,"optionsRef"],[72,31,59,16],[72,32,59,38,"current"],[72,39,59,16],[72,40,59,46,"onOpen"],[72,46,59,16],[72,47,59,53,"event"],[72,52,59,16],[73,0,60,13],[75,0,61,12,"subscriber"],[75,8,61,12,"subscriber"],[75,18,61,22],[75,19,61,23,"setReadyState"],[75,32,61,12],[75,33,61,37,"constants_1"],[75,44,61,48],[75,45,61,49,"ReadyState"],[75,55,61,37],[75,56,61,60,"OPEN"],[75,60,61,12],[76,0,62,9],[76,7,56,8],[77,0,63,5],[77,5,55,4],[78,0,64,1],[78,3,6,0]],"functionMap":{"names":["<global>","exports.attachSharedListeners","webSocketInstance.onmessage","manage_subscribers_1.getSubscribers.forEach$argument_0","webSocketInstance.onclose","setTimeout$argument_0","webSocketInstance.onerror","webSocketInstance.onopen"],"mappings":"AAA;gCCK;kCCC;yDCC;SDS;KDC;gCGC;yDDC;SCK;yDDE;mCEU;yBFE;SCO;KHC;gCKC;yDHC;SGI;KLC;+BMC;yDJC;SIM;KNC;CDC"}},"type":"js/module"}]}