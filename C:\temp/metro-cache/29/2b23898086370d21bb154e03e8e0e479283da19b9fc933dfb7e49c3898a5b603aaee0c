{"dependencies":[{"name":"./globals","data":{"isAsync":false}},{"name":"./constants","data":{"isAsync":false}},{"name":"./manage-subscribers","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.attachSharedListeners = void 0;\n\n  var globals_1 = _$$_REQUIRE(_dependencyMap[0], \"./globals\");\n\n  var constants_1 = _$$_REQUIRE(_dependencyMap[1], \"./constants\");\n\n  var manage_subscribers_1 = _$$_REQUIRE(_dependencyMap[2], \"./manage-subscribers\");\n\n  var bindMessageHandler = function bindMessageHandler(webSocketInstance, url) {\n    webSocketInstance.onmessage = function (message) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        if (subscriber.optionsRef.current.onMessage) {\n          subscriber.optionsRef.current.onMessage(message);\n        }\n\n        if (typeof subscriber.optionsRef.current.filter === 'function' && subscriber.optionsRef.current.filter(message) !== true) {\n          return;\n        }\n\n        subscriber.setLastMessage(message);\n      });\n    };\n  };\n\n  var bindOpenHandler = function bindOpenHandler(webSocketInstance, url) {\n    webSocketInstance.onopen = function (event) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        subscriber.reconnectCount.current = 0;\n\n        if (subscriber.optionsRef.current.onOpen) {\n          subscriber.optionsRef.current.onOpen(event);\n        }\n\n        subscriber.setReadyState(constants_1.ReadyState.OPEN);\n      });\n    };\n  };\n\n  var bindCloseHandler = function bindCloseHandler(webSocketInstance, url) {\n    webSocketInstance.onclose = function (event) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        if (subscriber.optionsRef.current.onClose) {\n          subscriber.optionsRef.current.onClose(event);\n        }\n\n        subscriber.setReadyState(constants_1.ReadyState.CLOSED);\n      });\n      delete globals_1.sharedWebSockets[url];\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        var _a, _b;\n\n        if (subscriber.optionsRef.current.shouldReconnect && subscriber.optionsRef.current.shouldReconnect(event)) {\n          var reconnectAttempts = (_a = subscriber.optionsRef.current.reconnectAttempts) !== null && _a !== void 0 ? _a : constants_1.DEFAULT_RECONNECT_LIMIT;\n\n          if (subscriber.reconnectCount.current < reconnectAttempts) {\n            if (subscriber.reconnectCount.current++ === 0) {\n              subscriber.reconnect.current();\n            } else {\n              setTimeout(function () {\n                subscriber.reconnect.current();\n              }, (_b = subscriber.optionsRef.current.reconnectInterval) !== null && _b !== void 0 ? _b : constants_1.DEFAULT_RECONNECT_INTERVAL_MS);\n            }\n          } else {\n            subscriber.optionsRef.current.onReconnectStop && subscriber.optionsRef.current.onReconnectStop(subscriber.optionsRef.current.reconnectAttempts);\n            console.warn(\"Max reconnect attempts of \" + reconnectAttempts + \" exceeded\");\n          }\n        }\n      });\n    };\n  };\n\n  var bindErrorHandler = function bindErrorHandler(webSocketInstance, url) {\n    webSocketInstance.onerror = function (error) {\n      manage_subscribers_1.getSubscribers(url).forEach(function (subscriber) {\n        if (subscriber.optionsRef.current.onError) {\n          subscriber.optionsRef.current.onError(error);\n        }\n      });\n    };\n  };\n\n  exports.attachSharedListeners = function (webSocketInstance, url) {\n    bindMessageHandler(webSocketInstance, url);\n    bindCloseHandler(webSocketInstance, url);\n    bindOpenHandler(webSocketInstance, url);\n    bindErrorHandler(webSocketInstance, url);\n  };\n});","lineCount":94,"map":[[2,0,1,0],[4,0,2,0,"Object"],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,0],[4,24,2,22,"exports"],[4,31,2,0],[4,33,2,31],[4,45,2,0],[4,47,2,45],[5,0,2,47,"value"],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,0,2,45],[6,3,2,0],[7,0,3,0,"exports"],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"attachSharedListeners"],[7,31,3,0],[7,34,3,32],[7,39,3,37],[7,40,3,0],[9,0,4,0],[9,6,4,4,"globals_1"],[9,15,4,13],[9,18,4,16,"require"],[9,29,4,23],[9,61,4,0],[11,0,5,0],[11,6,5,4,"constants_1"],[11,17,5,15],[11,20,5,18,"require"],[11,31,5,25],[11,65,5,0],[13,0,6,0],[13,6,6,4,"manage_subscribers_1"],[13,26,6,24],[13,29,6,27,"require"],[13,40,6,34],[13,83,6,0],[15,0,7,0],[15,6,7,4,"bindMessageHandler"],[15,24,7,22],[15,27,7,25],[15,36,7,4,"bindMessageHandler"],[15,54,7,25],[15,55,7,35,"webSocketInstance"],[15,72,7,25],[15,74,7,54,"url"],[15,77,7,25],[15,79,7,59],[16,0,8,4,"webSocketInstance"],[16,4,8,4,"webSocketInstance"],[16,21,8,21],[16,22,8,22,"onmessage"],[16,31,8,4],[16,34,8,34],[16,44,8,44,"message"],[16,51,8,34],[16,53,8,53],[17,0,9,8,"manage_subscribers_1"],[17,6,9,8,"manage_subscribers_1"],[17,26,9,28],[17,27,9,29,"getSubscribers"],[17,41,9,8],[17,42,9,44,"url"],[17,45,9,8],[17,47,9,49,"forEach"],[17,54,9,8],[17,55,9,57],[17,65,9,67,"subscriber"],[17,75,9,57],[17,77,9,79],[18,0,10,12],[18,12,10,16,"subscriber"],[18,22,10,26],[18,23,10,27,"optionsRef"],[18,33,10,16],[18,34,10,38,"current"],[18,41,10,16],[18,42,10,46,"onMessage"],[18,51,10,12],[18,53,10,57],[19,0,11,16,"subscriber"],[19,10,11,16,"subscriber"],[19,20,11,26],[19,21,11,27,"optionsRef"],[19,31,11,16],[19,32,11,38,"current"],[19,39,11,16],[19,40,11,46,"onMessage"],[19,49,11,16],[19,50,11,56,"message"],[19,57,11,16],[20,0,12,13],[22,0,13,12],[22,12,13,16],[22,19,13,23,"subscriber"],[22,29,13,33],[22,30,13,34,"optionsRef"],[22,40,13,23],[22,41,13,45,"current"],[22,48,13,23],[22,49,13,53,"filter"],[22,55,13,16],[22,60,13,64],[22,70,13,16],[22,74,14,16,"subscriber"],[22,84,14,26],[22,85,14,27,"optionsRef"],[22,95,14,16],[22,96,14,38,"current"],[22,103,14,16],[22,104,14,46,"filter"],[22,110,14,16],[22,111,14,53,"message"],[22,118,14,16],[22,124,14,66],[22,128,13,12],[22,130,14,72],[23,0,15,16],[24,0,16,13],[26,0,17,12,"subscriber"],[26,8,17,12,"subscriber"],[26,18,17,22],[26,19,17,23,"setLastMessage"],[26,33,17,12],[26,34,17,38,"message"],[26,41,17,12],[27,0,18,9],[27,7,9,8],[28,0,19,5],[28,5,8,4],[29,0,20,1],[29,3,7,0],[31,0,21,0],[31,6,21,4,"bindOpenHandler"],[31,21,21,19],[31,24,21,22],[31,33,21,4,"bindOpenHandler"],[31,48,21,22],[31,49,21,32,"webSocketInstance"],[31,66,21,22],[31,68,21,51,"url"],[31,71,21,22],[31,73,21,56],[32,0,22,4,"webSocketInstance"],[32,4,22,4,"webSocketInstance"],[32,21,22,21],[32,22,22,22,"onopen"],[32,28,22,4],[32,31,22,31],[32,41,22,41,"event"],[32,46,22,31],[32,48,22,48],[33,0,23,8,"manage_subscribers_1"],[33,6,23,8,"manage_subscribers_1"],[33,26,23,28],[33,27,23,29,"getSubscribers"],[33,41,23,8],[33,42,23,44,"url"],[33,45,23,8],[33,47,23,49,"forEach"],[33,54,23,8],[33,55,23,57],[33,65,23,67,"subscriber"],[33,75,23,57],[33,77,23,79],[34,0,24,12,"subscriber"],[34,8,24,12,"subscriber"],[34,18,24,22],[34,19,24,23,"reconnectCount"],[34,33,24,12],[34,34,24,38,"current"],[34,41,24,12],[34,44,24,48],[34,45,24,12],[36,0,25,12],[36,12,25,16,"subscriber"],[36,22,25,26],[36,23,25,27,"optionsRef"],[36,33,25,16],[36,34,25,38,"current"],[36,41,25,16],[36,42,25,46,"onOpen"],[36,48,25,12],[36,50,25,54],[37,0,26,16,"subscriber"],[37,10,26,16,"subscriber"],[37,20,26,26],[37,21,26,27,"optionsRef"],[37,31,26,16],[37,32,26,38,"current"],[37,39,26,16],[37,40,26,46,"onOpen"],[37,46,26,16],[37,47,26,53,"event"],[37,52,26,16],[38,0,27,13],[40,0,28,12,"subscriber"],[40,8,28,12,"subscriber"],[40,18,28,22],[40,19,28,23,"setReadyState"],[40,32,28,12],[40,33,28,37,"constants_1"],[40,44,28,48],[40,45,28,49,"ReadyState"],[40,55,28,37],[40,56,28,60,"OPEN"],[40,60,28,12],[41,0,29,9],[41,7,23,8],[42,0,30,5],[42,5,22,4],[43,0,31,1],[43,3,21,0],[45,0,32,0],[45,6,32,4,"bindCloseHandler"],[45,22,32,20],[45,25,32,23],[45,34,32,4,"bindCloseHandler"],[45,50,32,23],[45,51,32,33,"webSocketInstance"],[45,68,32,23],[45,70,32,52,"url"],[45,73,32,23],[45,75,32,57],[46,0,33,4,"webSocketInstance"],[46,4,33,4,"webSocketInstance"],[46,21,33,21],[46,22,33,22,"onclose"],[46,29,33,4],[46,32,33,32],[46,42,33,42,"event"],[46,47,33,32],[46,49,33,49],[47,0,34,8,"manage_subscribers_1"],[47,6,34,8,"manage_subscribers_1"],[47,26,34,28],[47,27,34,29,"getSubscribers"],[47,41,34,8],[47,42,34,44,"url"],[47,45,34,8],[47,47,34,49,"forEach"],[47,54,34,8],[47,55,34,57],[47,65,34,67,"subscriber"],[47,75,34,57],[47,77,34,79],[48,0,35,12],[48,12,35,16,"subscriber"],[48,22,35,26],[48,23,35,27,"optionsRef"],[48,33,35,16],[48,34,35,38,"current"],[48,41,35,16],[48,42,35,46,"onClose"],[48,49,35,12],[48,51,35,55],[49,0,36,16,"subscriber"],[49,10,36,16,"subscriber"],[49,20,36,26],[49,21,36,27,"optionsRef"],[49,31,36,16],[49,32,36,38,"current"],[49,39,36,16],[49,40,36,46,"onClose"],[49,47,36,16],[49,48,36,54,"event"],[49,53,36,16],[50,0,37,13],[52,0,38,12,"subscriber"],[52,8,38,12,"subscriber"],[52,18,38,22],[52,19,38,23,"setReadyState"],[52,32,38,12],[52,33,38,37,"constants_1"],[52,44,38,48],[52,45,38,49,"ReadyState"],[52,55,38,37],[52,56,38,60,"CLOSED"],[52,62,38,12],[53,0,39,9],[53,7,34,8],[54,0,40,8],[54,13,40,15,"globals_1"],[54,22,40,24],[54,23,40,25,"sharedWebSockets"],[54,39,40,15],[54,40,40,42,"url"],[54,43,40,15],[54,44,40,8],[55,0,41,8,"manage_subscribers_1"],[55,6,41,8,"manage_subscribers_1"],[55,26,41,28],[55,27,41,29,"getSubscribers"],[55,41,41,8],[55,42,41,44,"url"],[55,45,41,8],[55,47,41,49,"forEach"],[55,54,41,8],[55,55,41,57],[55,65,41,67,"subscriber"],[55,75,41,57],[55,77,41,79],[56,0,42,12],[56,12,42,16,"_a"],[56,14,42,12],[56,16,42,20,"_b"],[56,18,42,12],[58,0,43,12],[58,12,43,16,"subscriber"],[58,22,43,26],[58,23,43,27,"optionsRef"],[58,33,43,16],[58,34,43,38,"current"],[58,41,43,16],[58,42,43,46,"shouldReconnect"],[58,57,43,16],[58,61,44,16,"subscriber"],[58,71,44,26],[58,72,44,27,"optionsRef"],[58,82,44,16],[58,83,44,38,"current"],[58,90,44,16],[58,91,44,46,"shouldReconnect"],[58,106,44,16],[58,107,44,62,"event"],[58,112,44,16],[58,113,43,12],[58,115,44,70],[59,0,45,16],[59,14,45,20,"reconnectAttempts"],[59,31,45,37],[59,34,45,40],[59,35,45,41,"_a"],[59,37,45,43],[59,40,45,46,"subscriber"],[59,50,45,56],[59,51,45,57,"optionsRef"],[59,61,45,46],[59,62,45,68,"current"],[59,69,45,46],[59,70,45,76,"reconnectAttempts"],[59,87,45,40],[59,93,45,99],[59,97,45,40],[59,101,45,107,"_a"],[59,103,45,109],[59,108,45,114],[59,113,45,119],[59,114,45,40],[59,117,45,123,"_a"],[59,119,45,40],[59,122,45,128,"constants_1"],[59,133,45,139],[59,134,45,140,"DEFAULT_RECONNECT_LIMIT"],[59,157,45,16],[61,0,46,16],[61,14,46,20,"subscriber"],[61,24,46,30],[61,25,46,31,"reconnectCount"],[61,39,46,20],[61,40,46,46,"current"],[61,47,46,20],[61,50,46,56,"reconnectAttempts"],[61,67,46,16],[61,69,46,75],[62,0,47,20],[62,16,47,24,"subscriber"],[62,26,47,34],[62,27,47,35,"reconnectCount"],[62,41,47,24],[62,42,47,50,"current"],[62,49,47,24],[62,56,47,64],[62,57,47,20],[62,59,47,67],[63,0,48,24,"subscriber"],[63,14,48,24,"subscriber"],[63,24,48,34],[63,25,48,35,"reconnect"],[63,34,48,24],[63,35,48,45,"current"],[63,42,48,24],[64,0,49,21],[64,13,47,20],[64,19,50,25],[65,0,51,24,"setTimeout"],[65,14,51,24,"setTimeout"],[65,24,51,34],[65,25,51,35],[65,37,51,47],[66,0,52,28,"subscriber"],[66,16,52,28,"subscriber"],[66,26,52,38],[66,27,52,39,"reconnect"],[66,36,52,28],[66,37,52,49,"current"],[66,44,52,28],[67,0,53,25],[67,15,51,34],[67,17,53,27],[67,18,53,28,"_b"],[67,20,53,30],[67,23,53,33,"subscriber"],[67,33,53,43],[67,34,53,44,"optionsRef"],[67,44,53,33],[67,45,53,55,"current"],[67,52,53,33],[67,53,53,63,"reconnectInterval"],[67,70,53,27],[67,76,53,86],[67,80,53,27],[67,84,53,94,"_b"],[67,86,53,96],[67,91,53,101],[67,96,53,106],[67,97,53,27],[67,100,53,110,"_b"],[67,102,53,27],[67,105,53,115,"constants_1"],[67,116,53,126],[67,117,53,127,"DEFAULT_RECONNECT_INTERVAL_MS"],[67,146,51,34],[67,147,51,24],[68,0,54,21],[69,0,55,17],[69,11,46,16],[69,17,56,21],[70,0,57,20,"subscriber"],[70,12,57,20,"subscriber"],[70,22,57,30],[70,23,57,31,"optionsRef"],[70,33,57,20],[70,34,57,42,"current"],[70,41,57,20],[70,42,57,50,"onReconnectStop"],[70,57,57,20],[70,61,57,69,"subscriber"],[70,71,57,79],[70,72,57,80,"optionsRef"],[70,82,57,69],[70,83,57,91,"current"],[70,90,57,69],[70,91,57,99,"onReconnectStop"],[70,106,57,69],[70,107,57,115,"subscriber"],[70,117,57,125],[70,118,57,126,"optionsRef"],[70,128,57,115],[70,129,57,137,"current"],[70,136,57,115],[70,137,57,145,"reconnectAttempts"],[70,154,57,69],[70,155,57,20],[71,0,58,20,"console"],[71,12,58,20,"console"],[71,19,58,27],[71,20,58,28,"warn"],[71,24,58,20],[71,25,58,33],[71,56,58,64,"reconnectAttempts"],[71,73,58,33],[71,76,58,84],[71,87,58,20],[72,0,59,17],[73,0,60,13],[74,0,61,9],[74,7,41,8],[75,0,62,5],[75,5,33,4],[76,0,63,1],[76,3,32,0],[78,0,64,0],[78,6,64,4,"bindErrorHandler"],[78,22,64,20],[78,25,64,23],[78,34,64,4,"bindErrorHandler"],[78,50,64,23],[78,51,64,33,"webSocketInstance"],[78,68,64,23],[78,70,64,52,"url"],[78,73,64,23],[78,75,64,57],[79,0,65,4,"webSocketInstance"],[79,4,65,4,"webSocketInstance"],[79,21,65,21],[79,22,65,22,"onerror"],[79,29,65,4],[79,32,65,32],[79,42,65,42,"error"],[79,47,65,32],[79,49,65,49],[80,0,66,8,"manage_subscribers_1"],[80,6,66,8,"manage_subscribers_1"],[80,26,66,28],[80,27,66,29,"getSubscribers"],[80,41,66,8],[80,42,66,44,"url"],[80,45,66,8],[80,47,66,49,"forEach"],[80,54,66,8],[80,55,66,57],[80,65,66,67,"subscriber"],[80,75,66,57],[80,77,66,79],[81,0,67,12],[81,12,67,16,"subscriber"],[81,22,67,26],[81,23,67,27,"optionsRef"],[81,33,67,16],[81,34,67,38,"current"],[81,41,67,16],[81,42,67,46,"onError"],[81,49,67,12],[81,51,67,55],[82,0,68,16,"subscriber"],[82,10,68,16,"subscriber"],[82,20,68,26],[82,21,68,27,"optionsRef"],[82,31,68,16],[82,32,68,38,"current"],[82,39,68,16],[82,40,68,46,"onError"],[82,47,68,16],[82,48,68,54,"error"],[82,53,68,16],[83,0,69,13],[84,0,70,9],[84,7,66,8],[85,0,71,5],[85,5,65,4],[86,0,72,1],[86,3,64,0],[88,0,73,0,"exports"],[88,2,73,0,"exports"],[88,9,73,7],[88,10,73,8,"attachSharedListeners"],[88,31,73,0],[88,34,73,32],[88,44,73,42,"webSocketInstance"],[88,61,73,32],[88,63,73,61,"url"],[88,66,73,32],[88,68,73,66],[89,0,74,4,"bindMessageHandler"],[89,4,74,4,"bindMessageHandler"],[89,22,74,22],[89,23,74,23,"webSocketInstance"],[89,40,74,22],[89,42,74,42,"url"],[89,45,74,22],[89,46,74,4],[90,0,75,4,"bindCloseHandler"],[90,4,75,4,"bindCloseHandler"],[90,20,75,20],[90,21,75,21,"webSocketInstance"],[90,38,75,20],[90,40,75,40,"url"],[90,43,75,20],[90,44,75,4],[91,0,76,4,"bindOpenHandler"],[91,4,76,4,"bindOpenHandler"],[91,19,76,19],[91,20,76,20,"webSocketInstance"],[91,37,76,19],[91,39,76,39,"url"],[91,42,76,19],[91,43,76,4],[92,0,77,4,"bindErrorHandler"],[92,4,77,4,"bindErrorHandler"],[92,20,77,20],[92,21,77,21,"webSocketInstance"],[92,38,77,20],[92,40,77,40,"url"],[92,43,77,20],[92,44,77,4],[93,0,78,1],[93,3,73,0]],"functionMap":{"names":["<global>","bindMessageHandler","webSocketInstance.onmessage","manage_subscribers_1.getSubscribers.forEach$argument_0","bindOpenHandler","webSocketInstance.onopen","bindCloseHandler","webSocketInstance.onclose","setTimeout$argument_0","bindErrorHandler","webSocketInstance.onerror","exports.attachSharedListeners"],"mappings":"AAA;yBCM;kCCC;yDCC;SDS;KDC;CDC;sBIC;+BCC;yDFC;SEM;KDC;CJC;uBMC;gCCC;yDJC;SIK;yDJE;mCKU;yBLE;SIQ;KDC;CNC;uBSC;gCCC;yDPC;SOI;KDC;CTC;gCWC;CXK"}},"type":"js/module"}]}