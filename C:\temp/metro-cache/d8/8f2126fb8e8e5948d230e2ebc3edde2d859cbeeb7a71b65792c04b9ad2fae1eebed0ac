{"dependencies":[{"name":"./globals","data":{"isAsync":false,"locs":[{"start":{"line":4,"column":16},"end":{"line":4,"column":36}}]}},{"name":"./constants","data":{"isAsync":false,"locs":[{"start":{"line":5,"column":18},"end":{"line":5,"column":40}}]}},{"name":"./attach-listener","data":{"isAsync":false,"locs":[{"start":{"line":6,"column":24},"end":{"line":6,"column":52}}]}},{"name":"./attach-shared-listeners","data":{"isAsync":false,"locs":[{"start":{"line":7,"column":32},"end":{"line":7,"column":68}}]}},{"name":"./manage-subscribers","data":{"isAsync":false,"locs":[{"start":{"line":8,"column":27},"end":{"line":8,"column":58}}]}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.createOrJoinSocket = void 0;\n\n  var globals_1 = _$$_REQUIRE(_dependencyMap[0], \"./globals\");\n\n  var constants_1 = _$$_REQUIRE(_dependencyMap[1], \"./constants\");\n\n  var attach_listener_1 = _$$_REQUIRE(_dependencyMap[2], \"./attach-listener\");\n\n  var attach_shared_listeners_1 = _$$_REQUIRE(_dependencyMap[3], \"./attach-shared-listeners\");\n\n  var manage_subscribers_1 = _$$_REQUIRE(_dependencyMap[4], \"./manage-subscribers\");\n\n  var cleanSubscribers = function cleanSubscribers(url, subscriber, optionsRef, setReadyState, clearSocketIoPingInterval) {\n    return function () {\n      manage_subscribers_1.removeSubscriber(url, subscriber);\n\n      if (!manage_subscribers_1.hasSubscribers(url)) {\n        try {\n          globals_1.sharedWebSockets[url].onclose = function (event) {\n            if (optionsRef.current.onClose) {\n              optionsRef.current.onClose(event);\n            }\n\n            setReadyState(constants_1.ReadyState.CLOSED);\n          };\n\n          globals_1.sharedWebSockets[url].close();\n        } catch (e) {}\n\n        if (clearSocketIoPingInterval) clearSocketIoPingInterval();\n        delete globals_1.sharedWebSockets[url];\n      }\n    };\n  };\n\n  exports.createOrJoinSocket = function (webSocketRef, url, setReadyState, optionsRef, setLastMessage, startRef, reconnectCount, sendMessage) {\n    if (optionsRef.current.share) {\n      var clearSocketIoPingInterval = null;\n\n      if (globals_1.sharedWebSockets[url] === undefined) {\n        setReadyState(constants_1.ReadyState.CONNECTING);\n        globals_1.sharedWebSockets[url] = new WebSocket(url, optionsRef.current.protocols);\n        clearSocketIoPingInterval = attach_shared_listeners_1.attachSharedListeners(globals_1.sharedWebSockets[url], url, optionsRef, sendMessage);\n      } else {\n        setReadyState(globals_1.sharedWebSockets[url].readyState);\n      }\n\n      var subscriber = {\n        setLastMessage: setLastMessage,\n        setReadyState: setReadyState,\n        optionsRef: optionsRef,\n        reconnectCount: reconnectCount,\n        reconnect: startRef\n      };\n      manage_subscribers_1.addSubscriber(url, subscriber);\n      webSocketRef.current = globals_1.sharedWebSockets[url];\n      return cleanSubscribers(url, subscriber, optionsRef, setReadyState, clearSocketIoPingInterval);\n    } else {\n      setReadyState(constants_1.ReadyState.CONNECTING);\n      webSocketRef.current = new WebSocket(url, optionsRef.current.protocols);\n      return attach_listener_1.attachListeners(webSocketRef.current, {\n        setLastMessage: setLastMessage,\n        setReadyState: setReadyState\n      }, optionsRef, startRef.current, reconnectCount, sendMessage);\n    }\n  };\n});","lineCount":73,"map":[[2,0,1,0],[4,0,2,0,"Object"],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,0],[4,24,2,22,"exports"],[4,31,2,0],[4,33,2,31],[4,45,2,0],[4,47,2,45],[5,0,2,47,"value"],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,0,2,45],[6,3,2,0],[7,0,3,0,"exports"],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"createOrJoinSocket"],[7,28,3,0],[7,31,3,29],[7,36,3,34],[7,37,3,0],[9,0,4,0],[9,6,4,4,"globals_1"],[9,15,4,13],[9,18,4,16,"require"],[9,29,4,23],[9,61,4,0],[11,0,5,0],[11,6,5,4,"constants_1"],[11,17,5,15],[11,20,5,18,"require"],[11,31,5,25],[11,65,5,0],[13,0,6,0],[13,6,6,4,"attach_listener_1"],[13,23,6,21],[13,26,6,24,"require"],[13,37,6,31],[13,77,6,0],[15,0,7,0],[15,6,7,4,"attach_shared_listeners_1"],[15,31,7,29],[15,34,7,32,"require"],[15,45,7,39],[15,93,7,0],[17,0,8,0],[17,6,8,4,"manage_subscribers_1"],[17,26,8,24],[17,29,8,27,"require"],[17,40,8,34],[17,83,8,0],[19,0,10,0],[19,6,10,4,"cleanSubscribers"],[19,22,10,20],[19,25,10,23],[19,34,10,4,"cleanSubscribers"],[19,50,10,23],[19,51,10,33,"url"],[19,54,10,23],[19,56,10,38,"subscriber"],[19,66,10,23],[19,68,10,50,"optionsRef"],[19,78,10,23],[19,80,10,62,"setReadyState"],[19,93,10,23],[19,95,10,77,"clearSocketIoPingInterval"],[19,120,10,23],[19,122,10,104],[20,0,11,4],[20,11,11,11],[20,23,11,23],[21,0,12,8,"manage_subscribers_1"],[21,6,12,8,"manage_subscribers_1"],[21,26,12,28],[21,27,12,29,"removeSubscriber"],[21,43,12,8],[21,44,12,46,"url"],[21,47,12,8],[21,49,12,51,"subscriber"],[21,59,12,8],[23,0,13,8],[23,10,13,12],[23,11,13,13,"manage_subscribers_1"],[23,31,13,33],[23,32,13,34,"hasSubscribers"],[23,46,13,13],[23,47,13,49,"url"],[23,50,13,13],[23,51,13,8],[23,53,13,55],[24,0,14,12],[24,12,14,16],[25,0,15,16,"globals_1"],[25,10,15,16,"globals_1"],[25,19,15,25],[25,20,15,26,"sharedWebSockets"],[25,36,15,16],[25,37,15,43,"url"],[25,40,15,16],[25,42,15,48,"onclose"],[25,49,15,16],[25,52,15,58],[25,62,15,68,"event"],[25,67,15,58],[25,69,15,75],[26,0,16,20],[26,16,16,24,"optionsRef"],[26,26,16,34],[26,27,16,35,"current"],[26,34,16,24],[26,35,16,43,"onClose"],[26,42,16,20],[26,44,16,52],[27,0,17,24,"optionsRef"],[27,14,17,24,"optionsRef"],[27,24,17,34],[27,25,17,35,"current"],[27,32,17,24],[27,33,17,43,"onClose"],[27,40,17,24],[27,41,17,51,"event"],[27,46,17,24],[28,0,18,21],[30,0,19,20,"setReadyState"],[30,12,19,20,"setReadyState"],[30,25,19,33],[30,26,19,34,"constants_1"],[30,37,19,45],[30,38,19,46,"ReadyState"],[30,48,19,34],[30,49,19,57,"CLOSED"],[30,55,19,33],[30,56,19,20],[31,0,20,17],[31,11,15,16],[33,0,21,16,"globals_1"],[33,10,21,16,"globals_1"],[33,19,21,25],[33,20,21,26,"sharedWebSockets"],[33,36,21,16],[33,37,21,43,"url"],[33,40,21,16],[33,42,21,48,"close"],[33,47,21,16],[34,0,22,13],[34,9,14,12],[34,10,23,12],[34,17,23,19,"e"],[34,18,23,12],[34,20,23,22],[34,21,24,13],[36,0,25,12],[36,12,25,16,"clearSocketIoPingInterval"],[36,37,25,12],[36,39,26,16,"clearSocketIoPingInterval"],[36,64,26,41],[37,0,27,12],[37,15,27,19,"globals_1"],[37,24,27,28],[37,25,27,29,"sharedWebSockets"],[37,41,27,19],[37,42,27,46,"url"],[37,45,27,19],[37,46,27,12],[38,0,28,9],[39,0,29,5],[39,5,11,4],[40,0,30,1],[40,3,10,0],[42,0,31,0,"exports"],[42,2,31,0,"exports"],[42,9,31,7],[42,10,31,8,"createOrJoinSocket"],[42,28,31,0],[42,31,31,29],[42,41,31,39,"webSocketRef"],[42,53,31,29],[42,55,31,53,"url"],[42,58,31,29],[42,60,31,58,"setReadyState"],[42,73,31,29],[42,75,31,73,"optionsRef"],[42,85,31,29],[42,87,31,85,"setLastMessage"],[42,101,31,29],[42,103,31,101,"startRef"],[42,111,31,29],[42,113,31,111,"reconnectCount"],[42,127,31,29],[42,129,31,127,"sendMessage"],[42,140,31,29],[42,142,31,140],[43,0,32,4],[43,8,32,8,"optionsRef"],[43,18,32,18],[43,19,32,19,"current"],[43,26,32,8],[43,27,32,27,"share"],[43,32,32,4],[43,34,32,34],[44,0,33,8],[44,10,33,12,"clearSocketIoPingInterval"],[44,35,33,37],[44,38,33,40],[44,42,33,8],[46,0,34,8],[46,10,34,12,"globals_1"],[46,19,34,21],[46,20,34,22,"sharedWebSockets"],[46,36,34,12],[46,37,34,39,"url"],[46,40,34,12],[46,46,34,48,"undefined"],[46,55,34,8],[46,57,34,59],[47,0,35,12,"setReadyState"],[47,8,35,12,"setReadyState"],[47,21,35,25],[47,22,35,26,"constants_1"],[47,33,35,37],[47,34,35,38,"ReadyState"],[47,44,35,26],[47,45,35,49,"CONNECTING"],[47,55,35,25],[47,56,35,12],[48,0,36,12,"globals_1"],[48,8,36,12,"globals_1"],[48,17,36,21],[48,18,36,22,"sharedWebSockets"],[48,34,36,12],[48,35,36,39,"url"],[48,38,36,12],[48,42,36,46],[48,46,36,50,"WebSocket"],[48,55,36,46],[48,56,36,60,"url"],[48,59,36,46],[48,61,36,65,"optionsRef"],[48,71,36,75],[48,72,36,76,"current"],[48,79,36,65],[48,80,36,84,"protocols"],[48,89,36,46],[48,90,36,12],[49,0,37,12,"clearSocketIoPingInterval"],[49,8,37,12,"clearSocketIoPingInterval"],[49,33,37,37],[49,36,37,40,"attach_shared_listeners_1"],[49,61,37,65],[49,62,37,66,"attachSharedListeners"],[49,83,37,40],[49,84,37,88,"globals_1"],[49,93,37,97],[49,94,37,98,"sharedWebSockets"],[49,110,37,88],[49,111,37,115,"url"],[49,114,37,88],[49,115,37,40],[49,117,37,121,"url"],[49,120,37,40],[49,122,37,126,"optionsRef"],[49,132,37,40],[49,134,37,138,"sendMessage"],[49,145,37,40],[49,146,37,12],[50,0,38,9],[50,7,34,8],[50,13,39,13],[51,0,40,12,"setReadyState"],[51,8,40,12,"setReadyState"],[51,21,40,25],[51,22,40,26,"globals_1"],[51,31,40,35],[51,32,40,36,"sharedWebSockets"],[51,48,40,26],[51,49,40,53,"url"],[51,52,40,26],[51,54,40,58,"readyState"],[51,64,40,25],[51,65,40,12],[52,0,41,9],[54,0,42,8],[54,10,42,12,"subscriber"],[54,20,42,22],[54,23,42,25],[55,0,43,12,"setLastMessage"],[55,8,43,12,"setLastMessage"],[55,22,43,26],[55,24,43,28,"setLastMessage"],[55,38,42,25],[56,0,44,12,"setReadyState"],[56,8,44,12,"setReadyState"],[56,21,44,25],[56,23,44,27,"setReadyState"],[56,36,42,25],[57,0,45,12,"optionsRef"],[57,8,45,12,"optionsRef"],[57,18,45,22],[57,20,45,24,"optionsRef"],[57,30,42,25],[58,0,46,12,"reconnectCount"],[58,8,46,12,"reconnectCount"],[58,22,46,26],[58,24,46,28,"reconnectCount"],[58,38,42,25],[59,0,47,12,"reconnect"],[59,8,47,12,"reconnect"],[59,17,47,21],[59,19,47,23,"startRef"],[60,0,42,25],[60,7,42,8],[61,0,49,8,"manage_subscribers_1"],[61,6,49,8,"manage_subscribers_1"],[61,26,49,28],[61,27,49,29,"addSubscriber"],[61,40,49,8],[61,41,49,43,"url"],[61,44,49,8],[61,46,49,48,"subscriber"],[61,56,49,8],[62,0,50,8,"webSocketRef"],[62,6,50,8,"webSocketRef"],[62,18,50,20],[62,19,50,21,"current"],[62,26,50,8],[62,29,50,31,"globals_1"],[62,38,50,40],[62,39,50,41,"sharedWebSockets"],[62,55,50,31],[62,56,50,58,"url"],[62,59,50,31],[62,60,50,8],[63,0,51,8],[63,13,51,15,"cleanSubscribers"],[63,29,51,31],[63,30,51,32,"url"],[63,33,51,31],[63,35,51,37,"subscriber"],[63,45,51,31],[63,47,51,49,"optionsRef"],[63,57,51,31],[63,59,51,61,"setReadyState"],[63,72,51,31],[63,74,51,76,"clearSocketIoPingInterval"],[63,99,51,31],[63,100,51,8],[64,0,52,5],[64,5,32,4],[64,11,53,9],[65,0,54,8,"setReadyState"],[65,6,54,8,"setReadyState"],[65,19,54,21],[65,20,54,22,"constants_1"],[65,31,54,33],[65,32,54,34,"ReadyState"],[65,42,54,22],[65,43,54,45,"CONNECTING"],[65,53,54,21],[65,54,54,8],[66,0,55,8,"webSocketRef"],[66,6,55,8,"webSocketRef"],[66,18,55,20],[66,19,55,21,"current"],[66,26,55,8],[66,29,55,31],[66,33,55,35,"WebSocket"],[66,42,55,31],[66,43,55,45,"url"],[66,46,55,31],[66,48,55,50,"optionsRef"],[66,58,55,60],[66,59,55,61,"current"],[66,66,55,50],[66,67,55,69,"protocols"],[66,76,55,31],[66,77,55,8],[67,0,56,8],[67,13,56,15,"attach_listener_1"],[67,30,56,32],[67,31,56,33,"attachListeners"],[67,46,56,15],[67,47,56,49,"webSocketRef"],[67,59,56,61],[67,60,56,62,"current"],[67,67,56,15],[67,69,56,71],[68,0,57,12,"setLastMessage"],[68,8,57,12,"setLastMessage"],[68,22,57,26],[68,24,57,28,"setLastMessage"],[68,38,56,71],[69,0,58,12,"setReadyState"],[69,8,58,12,"setReadyState"],[69,21,58,25],[69,23,58,27,"setReadyState"],[70,0,56,71],[70,7,56,15],[70,9,59,11,"optionsRef"],[70,19,56,15],[70,21,59,23,"startRef"],[70,29,59,31],[70,30,59,32,"current"],[70,37,56,15],[70,39,59,41,"reconnectCount"],[70,53,56,15],[70,55,59,57,"sendMessage"],[70,66,56,15],[70,67,56,8],[71,0,60,5],[72,0,61,1],[72,3,31,0]],"functionMap":{"names":["<global>","cleanSubscribers","<anonymous>","globals_1.sharedWebSockets.url.onclose","exports.createOrJoinSocket"],"mappings":"AAA;uBCS;WCC;0DCI;iBDK;KDS;CDC;6BIC;CJ8B"}},"type":"js/module"}]}