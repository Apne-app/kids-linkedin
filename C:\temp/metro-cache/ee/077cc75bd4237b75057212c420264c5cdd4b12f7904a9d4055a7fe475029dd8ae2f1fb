{"dependencies":[{"name":"../util/class","data":{"isAsync":false}},{"name":"../util/assign","data":{"isAsync":false}},{"name":"../mixins/publisher","data":{"isAsync":false}},{"name":"./grammar","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){'use strict';var n=r(d[0]),s=r(d[1]),t=r(d[2]),u=r(d[3]),h=n({initialize:function(n){this.id=this.name=n},push:function(n){this.trigger('message',n)},isUnused:function(){return 0===this.countListeners('message')}});s(h.prototype,t),s(h,{HANDSHAKE:'/meta/handshake',CONNECT:'/meta/connect',SUBSCRIBE:'/meta/subscribe',UNSUBSCRIBE:'/meta/unsubscribe',DISCONNECT:'/meta/disconnect',META:'meta',SERVICE:'service',expand:function(n){var s=this.parse(n),t=['/**',n],u=s.slice();u[u.length-1]='*',t.push(this.unparse(u));for(var h=1,c=s.length;h<c;h++)(u=s.slice(0,h)).push('**'),t.push(this.unparse(u));return t},isValid:function(n){return u.CHANNEL_NAME.test(n)||u.CHANNEL_PATTERN.test(n)},parse:function(n){return this.isValid(n)?n.split('/').slice(1):null},unparse:function(n){return'/'+n.join('/')},isMeta:function(n){var s=this.parse(n);return s?s[0]===this.META:null},isService:function(n){var s=this.parse(n);return s?s[0]===this.SERVICE:null},isSubscribable:function(n){return this.isValid(n)?!this.isMeta(n)&&!this.isService(n):null},Set:n({initialize:function(){this._channels={}},getKeys:function(){var n=[];for(var s in this._channels)n.push(s);return n},remove:function(n){delete this._channels[n]},hasSubscription:function(n){return this._channels.hasOwnProperty(n)},subscribe:function(n,s){for(var t,u=0,c=n.length;u<c;u++){t=n[u],(this._channels[t]=this._channels[t]||new h(t)).bind('message',s)}},unsubscribe:function(n,s){var t=this._channels[n];return!!t&&(t.unbind('message',s),!!t.isUnused()&&(this.remove(n),!0))},distributeMessage:function(n){for(var s=h.expand(n.channel),t=0,u=s.length;t<u;t++){var c=this._channels[s[t]];c&&c.trigger('message',n)}}})}),m.exports=h});","lineCount":1,"map":[[1,28,1,0],[1,41,3,0],[1,45,3,4,"Class"],[1,47,3,16,"require"],[1,49,3,23,"d"],[1,51,3,23],[1,55,4,4,"assign"],[1,57,4,16,"require"],[1,59,4,23,"d"],[1,61,4,23],[1,65,5,4,"Publisher"],[1,67,5,16,"require"],[1,69,5,23,"d"],[1,71,5,23],[1,75,6,4,"Grammar"],[1,77,6,16,"require"],[1,79,6,23,"d"],[1,81,6,23],[1,85,8,4,"Channel"],[1,87,8,14,"Class"],[1,90,9,2,"initialize"],[1,101,9,14],[1,110,9,23,"name"],[1,113,10,4,"this"],[1,118,10,9,"id"],[1,121,10,14,"this"],[1,126,10,19,"name"],[1,131,10,26,"name"],[1,134,13,2,"push"],[1,139,13,8],[1,148,13,17,"message"],[1,151,14,4,"this"],[1,156,14,9,"trigger"],[1,164,14,17],[1,174,14,28,"message"],[1,178,17,2,"isUnused"],[1,187,17,12],[1,198,18,4],[1,205,18,46],[1,209,18,11,"this"],[1,214,18,16,"countListeners"],[1,229,18,31],[1,243,22,0,"assign"],[1,245,22,7,"Channel"],[1,247,22,15,"prototype"],[1,257,22,26,"Publisher"],[1,260,24,0,"assign"],[1,262,24,7,"Channel"],[1,265,25,2,"HANDSHAKE"],[1,275,25,16],[1,293,26,2,"CONNECT"],[1,301,26,16],[1,317,27,2,"SUBSCRIBE"],[1,327,27,16],[1,345,28,2,"UNSUBSCRIBE"],[1,357,28,16],[1,377,29,2,"DISCONNECT"],[1,388,29,16],[1,407,31,2,"META"],[1,412,31,16],[1,419,32,2,"SERVICE"],[1,427,32,16],[1,437,34,2,"expand"],[1,444,34,10],[1,453,34,19,"name"],[1,456,35,4],[1,460,35,8,"segments"],[1,462,35,19,"this"],[1,467,35,24,"parse"],[1,473,35,30,"name"],[1,476,36,8,"channels"],[1,479,36,20],[1,485,36,27,"name"],[1,488,38,8,"copy"],[1,490,38,15,"segments"],[1,492,38,24,"slice"],[1,500,39,4,"copy"],[1,502,39,9,"copy"],[1,504,39,14,"length"],[1,511,39,23],[1,514,39,28],[1,518,40,4,"channels"],[1,520,40,13,"push"],[1,525,40,18,"this"],[1,530,40,23,"unparse"],[1,538,40,31,"copy"],[1,542,42,4],[1,546,42,9],[1,550,42,13,"i"],[1,552,42,17],[1,554,42,20,"n"],[1,556,42,24,"segments"],[1,558,42,33,"length"],[1,565,42,41,"i"],[1,567,42,45,"n"],[1,569,42,48,"i"],[1,574,43,6,"copy"],[1,576,43,13,"segments"],[1,578,43,22,"slice"],[1,584,43,28],[1,586,43,31,"i"],[1,590,44,11,"push"],[1,595,44,16],[1,601,45,6,"channels"],[1,603,45,15,"push"],[1,608,45,20,"this"],[1,613,45,25,"unparse"],[1,621,45,33,"copy"],[1,625,48,4],[1,632,48,11,"channels"],[1,635,51,2,"isValid"],[1,643,51,11],[1,652,51,20,"name"],[1,655,52,4],[1,662,52,11,"Grammar"],[1,664,52,19,"CHANNEL_NAME"],[1,677,52,32,"test"],[1,682,52,37,"name"],[1,686,53,11,"Grammar"],[1,688,53,19,"CHANNEL_PATTERN"],[1,704,53,35,"test"],[1,709,53,40,"name"],[1,713,56,2,"parse"],[1,719,56,9],[1,728,56,18,"name"],[1,731,57,4],[1,738,57,9,"this"],[1,743,57,14,"isValid"],[1,751,57,22,"name"],[1,754,58,11,"name"],[1,756,58,16,"split"],[1,762,58,22],[1,767,58,27,"slice"],[1,773,58,33],[1,776,57,36],[1,782,61,2,"unparse"],[1,790,61,11],[1,799,61,20,"segments"],[1,802,62,4],[1,808,62,11],[1,812,62,17,"segments"],[1,814,62,26,"join"],[1,819,62,31],[1,825,65,2,"isMeta"],[1,832,65,10],[1,841,65,19,"name"],[1,844,66,4],[1,848,66,8,"segments"],[1,850,66,19,"this"],[1,855,66,24,"parse"],[1,861,66,30,"name"],[1,864,67,4],[1,871,67,11,"segments"],[1,873,67,23,"segments"],[1,875,67,32],[1,880,67,39,"this"],[1,885,67,44,"META"],[1,890,67,52],[1,896,70,2,"isService"],[1,906,70,13],[1,915,70,22,"name"],[1,918,71,4],[1,922,71,8,"segments"],[1,924,71,19,"this"],[1,929,71,24,"parse"],[1,935,71,30,"name"],[1,938,72,4],[1,945,72,11,"segments"],[1,947,72,23,"segments"],[1,949,72,32],[1,954,72,39,"this"],[1,959,72,44,"SERVICE"],[1,967,72,55],[1,973,75,2,"isSubscribable"],[1,988,75,18],[1,997,75,27,"name"],[1,1000,76,4],[1,1007,76,9,"this"],[1,1012,76,14,"isValid"],[1,1020,76,22,"name"],[1,1024,77,12,"this"],[1,1029,77,17,"isMeta"],[1,1036,77,24,"name"],[1,1041,77,34,"this"],[1,1046,77,39,"isService"],[1,1056,77,49,"name"],[1,1059,76,36],[1,1065,80,2,"Set"],[1,1069,80,7,"Class"],[1,1072,81,4,"initialize"],[1,1083,81,16],[1,1094,82,6,"this"],[1,1099,82,11,"_channels"],[1,1113,85,4,"getKeys"],[1,1121,85,13],[1,1132,86,6],[1,1136,86,10,"keys"],[1,1141,87,6],[1,1145,87,11],[1,1149,87,15,"key"],[1,1154,87,22,"this"],[1,1159,87,27,"_channels"],[1,1169,87,38,"keys"],[1,1171,87,43,"push"],[1,1176,87,48,"key"],[1,1179,88,6],[1,1186,88,13,"keys"],[1,1189,91,4,"remove"],[1,1196,91,12],[1,1205,91,21,"name"],[1,1215,92,13,"this"],[1,1220,92,18,"_channels"],[1,1230,92,28,"name"],[1,1234,95,4,"hasSubscription"],[1,1250,95,21],[1,1259,95,30,"name"],[1,1262,96,6],[1,1269,96,13,"this"],[1,1274,96,18,"_channels"],[1,1284,96,28,"hasOwnProperty"],[1,1299,96,43,"name"],[1,1303,99,4,"subscribe"],[1,1313,99,15],[1,1322,99,24,"names"],[1,1324,99,31,"subscription"],[1,1327,101,6],[1,1331,100,6],[1,1335,100,10,"name"],[1,1337,101,15,"i"],[1,1339,101,19],[1,1341,101,22,"n"],[1,1343,101,26,"names"],[1,1345,101,32,"length"],[1,1352,101,40,"i"],[1,1354,101,44,"n"],[1,1356,101,47,"i"],[1,1360,101,52],[1,1361,102,8,"name"],[1,1363,102,15,"names"],[1,1365,102,21,"i"],[1,1369,103,22,"this"],[1,1374,103,27,"_channels"],[1,1384,103,37,"name"],[1,1387,103,45,"this"],[1,1392,103,50,"_channels"],[1,1402,103,60,"name"],[1,1406,103,69],[1,1410,103,73,"Channel"],[1,1412,103,81,"name"],[1,1416,104,16,"bind"],[1,1421,104,21],[1,1431,104,32,"subscription"],[1,1436,108,4,"unsubscribe"],[1,1448,108,17],[1,1457,108,26,"name"],[1,1459,108,32,"subscription"],[1,1462,109,6],[1,1466,109,10,"channel"],[1,1468,109,20,"this"],[1,1473,109,25,"_channels"],[1,1483,109,35,"name"],[1,1486,110,6],[1,1494,110,11,"channel"],[1,1498,111,6,"channel"],[1,1500,111,14,"unbind"],[1,1507,111,21],[1,1517,111,32,"subscription"],[1,1522,113,10,"channel"],[1,1524,113,18,"isUnused"],[1,1537,114,8,"this"],[1,1542,114,13,"remove"],[1,1549,114,20,"name"],[1,1553,115,15],[1,1558,121,4,"distributeMessage"],[1,1576,121,23],[1,1585,121,32,"message"],[1,1588,124,6],[1,1592,122,6],[1,1596,122,10,"channels"],[1,1598,122,21,"Channel"],[1,1600,122,29,"expand"],[1,1607,122,36,"message"],[1,1609,122,44,"channel"],[1,1618,124,15,"i"],[1,1620,124,19],[1,1622,124,22,"n"],[1,1624,124,26,"channels"],[1,1626,124,35,"length"],[1,1633,124,43,"i"],[1,1635,124,47,"n"],[1,1637,124,50,"i"],[1,1641,124,55],[1,1642,125,8],[1,1646,125,12,"channel"],[1,1648,125,22,"this"],[1,1653,125,27,"_channels"],[1,1663,125,37,"channels"],[1,1665,125,46,"i"],[1,1669,126,12,"channel"],[1,1672,126,21,"channel"],[1,1674,126,29,"trigger"],[1,1682,126,37],[1,1692,126,48,"message"],[1,1701,132,0,"module"],[1,1703,132,7,"exports"],[1,1711,132,17,"Channel"]],"functionMap":{"names":["<global>","Class$argument_0.initialize","Class$argument_0.push","Class$argument_0.isUnused","assign$argument_1.expand","assign$argument_1.isValid","assign$argument_1.parse","assign$argument_1.unparse","assign$argument_1.isMeta","assign$argument_1.isService","assign$argument_1.isSubscribable","Class$argument_0.getKeys","Class$argument_0.remove","Class$argument_0.hasSubscription","Class$argument_0.subscribe","Class$argument_0.unsubscribe","Class$argument_0.distributeMessage"],"mappings":"AAA;cCQ;GDE;QEE;GFE;YGE;GHE;UIe;GJe;WKE;GLG;SME;GNG;WOE;GPE;UQE;GRG;aSE;GTG;kBUE;GVG;gBCG;KDE;aWE;KXI;YYE;KZE;qBaE;KbE;ecE;KdO;iBeE;KfW;uBgBE;KhBO"}},"type":"js/module"}]}