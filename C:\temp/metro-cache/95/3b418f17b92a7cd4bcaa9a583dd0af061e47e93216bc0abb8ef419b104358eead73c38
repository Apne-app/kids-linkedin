{"dependencies":[{"name":"../util/class","data":{"isAsync":false,"locs":[{"start":{"line":3,"column":16},"end":{"line":3,"column":40}}]}},{"name":"../util/uri","data":{"isAsync":false,"locs":[{"start":{"line":4,"column":16},"end":{"line":4,"column":38}}]}},{"name":"../util/cookies","data":{"isAsync":false,"locs":[{"start":{"line":5,"column":16},"end":{"line":5,"column":42}}]}},{"name":"../util/assign","data":{"isAsync":false,"locs":[{"start":{"line":6,"column":16},"end":{"line":6,"column":41}}]}},{"name":"../mixins/logging","data":{"isAsync":false,"locs":[{"start":{"line":7,"column":16},"end":{"line":7,"column":44}}]}},{"name":"../mixins/publisher","data":{"isAsync":false,"locs":[{"start":{"line":8,"column":16},"end":{"line":8,"column":46}}]}},{"name":"../transport","data":{"isAsync":false,"locs":[{"start":{"line":9,"column":16},"end":{"line":9,"column":39}}]}},{"name":"./scheduler","data":{"isAsync":false,"locs":[{"start":{"line":10,"column":16},"end":{"line":10,"column":38}}]}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){'use strict';var t=r(d[0]),s=r(d[1]),n=r(d[2]),o=r(d[3]),h=r(d[4]),l=r(d[5]),c=r(d[6]),p=r(d[7]),u=t({className:'Dispatcher',MAX_REQUEST_SIZE:2048,DEFAULT_RETRY:5,UP:1,DOWN:2,initialize:function(t,o,h){this._client=t,this.endpoint=s.parse(o),this._alternates=h.endpoints||{},this.cookies=n.CookieJar&&new n.CookieJar,this._disabled=[],this._envelopes={},this.headers={},this.retry=h.retry||this.DEFAULT_RETRY,this._scheduler=h.scheduler||p,this._state=0,this.transports={},this.wsExtensions=[],this.proxy=h.proxy||{},'string'==typeof this._proxy&&(this._proxy={origin:this._proxy});var l=h.websocketExtensions;if(l)for(var c=0,u=(l=[].concat(l)).length;c<u;c++)this.addWebsocketExtension(l[c]);for(var _ in this.tls=h.tls||{},this.tls.ca=this.tls.ca||h.ca,this._alternates)this._alternates[_]=s.parse(this._alternates[_]);this.maxRequestSize=this.MAX_REQUEST_SIZE},endpointFor:function(t){return this._alternates[t]||this.endpoint},addWebsocketExtension:function(t){this.wsExtensions.push(t)},disable:function(t){this._disabled.push(t),c.disable(t)},setHeader:function(t,s){this.headers[t]=s},close:function(){var t=this._transport;delete this._transport,t&&t.close()},getConnectionTypes:function(){return c.getConnectionTypes()},selectTransport:function(t){c.get(this,t,this._disabled,function(t){this.debug('Selected ? transport for ?',t.connectionType,t.endpoint.href),t!==this._transport&&(this._transport&&this._transport.close(),this._transport=t,this.connectionType=t.connectionType)},this)},sendMessage:function(t,s,n){n=n||{};var o,h=t.id,l=n.attempts,c=n.deadline&&(new Date).getTime()+1e3*n.deadline,p=this._envelopes[h];p||(o=new this._scheduler(t,{timeout:s,interval:this.retry,attempts:l,deadline:c}),p=this._envelopes[h]={message:t,scheduler:o}),this._sendEnvelope(p)},_sendEnvelope:function(t){if(this._transport&&!t.request&&!t.timer){var s=t.message,n=t.scheduler,o=this;if(!n.isDeliverable())return n.abort(),void delete this._envelopes[s.id];t.timer=g.setTimeout(function(){o.handleError(s)},1e3*n.getTimeout()),n.send(),t.request=this._transport.sendMessage(s)}},handleResponse:function(t){var s=this._envelopes[t.id];void 0!==t.successful&&s&&(s.scheduler.succeed(),delete this._envelopes[t.id],g.clearTimeout(s.timer)),this.trigger('message',t),this._state!==this.UP&&(this._state=this.UP,this._client.trigger('transport:up'))},handleError:function(t,s){var n=this._envelopes[t.id],o=n&&n.request,h=this;if(o){o.then(function(t){t&&t.abort&&t.abort()});var l=n.scheduler;l.fail(),g.clearTimeout(n.timer),n.request=n.timer=null,s?this._sendEnvelope(n):n.timer=g.setTimeout(function(){n.timer=null,h._sendEnvelope(n)},1e3*l.getInterval()),this._state!==this.DOWN&&(this._state=this.DOWN,this._client.trigger('transport:down'))}}});u.create=function(t,s,n){return new u(t,s,n)},o(u.prototype,l),o(u.prototype,h),m.exports=u});","lineCount":1,"map":[[1,28,1,0],[1,41,3,0],[1,45,3,4,"Class"],[1,47,3,16,"require"],[1,49,3,23,"d"],[1,51,3,23],[1,55,4,4,"URI"],[1,57,4,16,"require"],[1,59,4,23,"d"],[1,61,4,23],[1,65,5,4,"cookies"],[1,67,5,16,"require"],[1,69,5,23,"d"],[1,71,5,23],[1,75,6,4,"assign"],[1,77,6,16,"require"],[1,79,6,23,"d"],[1,81,6,23],[1,85,7,4,"Logging"],[1,87,7,16,"require"],[1,89,7,23,"d"],[1,91,7,23],[1,95,8,4,"Publisher"],[1,97,8,16,"require"],[1,99,8,23,"d"],[1,101,8,23],[1,105,9,4,"Transport"],[1,107,9,16,"require"],[1,109,9,23,"d"],[1,111,9,23],[1,115,10,4,"Scheduler"],[1,117,10,16,"require"],[1,119,10,23,"d"],[1,121,10,23],[1,125,12,4,"Dispatcher"],[1,127,12,17,"Class"],[1,130,12,25,"className"],[1,140,12,36],[1,153,13,2,"MAX_REQUEST_SIZE"],[1,170,13,20],[1,175,14,2,"DEFAULT_RETRY"],[1,189,14,20],[1,191,16,2,"UP"],[1,194,16,8],[1,196,17,2,"DOWN"],[1,201,17,8],[1,203,19,2,"initialize"],[1,214,19,14],[1,223,19,23,"client"],[1,225,19,31,"endpoint"],[1,227,19,41,"options"],[1,230,20,4,"this"],[1,235,20,9,"_client"],[1,243,20,23,"client"],[1,245,21,4,"this"],[1,250,21,9,"endpoint"],[1,259,21,23,"URI"],[1,261,21,27,"parse"],[1,267,21,33,"endpoint"],[1,270,22,4,"this"],[1,275,22,9,"_alternates"],[1,287,22,23,"options"],[1,289,22,31,"endpoints"],[1,303,24,4,"this"],[1,308,24,9,"cookies"],[1,316,24,24,"cookies"],[1,318,24,32,"CookieJar"],[1,329,24,45],[1,333,24,49,"cookies"],[1,335,24,57,"CookieJar"],[1,345,25,4,"this"],[1,350,25,9,"_disabled"],[1,363,26,4,"this"],[1,368,26,9,"_envelopes"],[1,382,27,4,"this"],[1,387,27,9,"headers"],[1,398,28,4,"this"],[1,403,28,9,"retry"],[1,409,28,24,"options"],[1,411,28,32,"retry"],[1,418,28,41,"this"],[1,423,28,46,"DEFAULT_RETRY"],[1,437,29,4,"this"],[1,442,29,9,"_scheduler"],[1,453,29,24,"options"],[1,455,29,32,"scheduler"],[1,466,29,45,"Scheduler"],[1,468,30,4,"this"],[1,473,30,9,"_state"],[1,480,30,24],[1,482,31,4,"this"],[1,487,31,9,"transports"],[1,501,32,4,"this"],[1,506,32,9,"wsExtensions"],[1,522,34,4,"this"],[1,527,34,9,"proxy"],[1,533,34,17,"options"],[1,535,34,25,"proxy"],[1,545,35,31],[1,562,35,15,"this"],[1,567,35,20,"_proxy"],[1,576,35,41,"this"],[1,581,35,46,"_proxy"],[1,589,35,57,"origin"],[1,596,35,65,"this"],[1,601,35,70,"_proxy"],[1,610,37,4],[1,614,37,8,"exts"],[1,616,37,15,"options"],[1,618,37,23,"websocketExtensions"],[1,638,38,4],[1,641,38,8,"exts"],[1,643,40,6],[1,647,40,11],[1,651,40,15,"i"],[1,653,40,19],[1,655,40,22,"n"],[1,658,39,6,"exts"],[1,663,39,16,"concat"],[1,670,39,23,"exts"],[1,674,40,31,"length"],[1,681,40,39,"i"],[1,683,40,43,"n"],[1,685,40,46,"i"],[1,689,41,8,"this"],[1,694,41,13,"addWebsocketExtension"],[1,716,41,35,"exts"],[1,718,41,40,"i"],[1,722,47,4],[1,726,47,9],[1,730,47,13,"type"],[1,735,44,4,"this"],[1,740,44,9,"tls"],[1,744,44,15,"options"],[1,746,44,23,"tls"],[1,754,45,4,"this"],[1,759,45,9,"tls"],[1,763,45,13,"ca"],[1,766,45,18,"this"],[1,771,45,23,"tls"],[1,775,45,27,"ca"],[1,779,45,33,"options"],[1,781,45,41,"ca"],[1,784,47,21,"this"],[1,789,47,26,"_alternates"],[1,801,48,6,"this"],[1,806,48,11,"_alternates"],[1,818,48,23,"type"],[1,821,48,31,"URI"],[1,823,48,35,"parse"],[1,829,48,41,"this"],[1,834,48,46,"_alternates"],[1,846,48,58,"type"],[1,850,50,4,"this"],[1,855,50,9,"maxRequestSize"],[1,870,50,26,"this"],[1,875,50,31,"MAX_REQUEST_SIZE"],[1,893,53,2,"endpointFor"],[1,905,53,15],[1,914,53,24,"connectionType"],[1,917,54,4],[1,924,54,11,"this"],[1,929,54,16,"_alternates"],[1,941,54,28,"connectionType"],[1,945,54,47,"this"],[1,950,54,52,"endpoint"],[1,960,57,2,"addWebsocketExtension"],[1,982,57,25],[1,991,57,34,"extension"],[1,994,58,4,"this"],[1,999,58,9,"wsExtensions"],[1,1012,58,22,"push"],[1,1017,58,27,"extension"],[1,1021,61,2,"disable"],[1,1029,61,11],[1,1038,61,20,"feature"],[1,1041,62,4,"this"],[1,1046,62,9,"_disabled"],[1,1056,62,19,"push"],[1,1061,62,24,"feature"],[1,1064,63,4,"Transport"],[1,1066,63,14,"disable"],[1,1074,63,22,"feature"],[1,1078,66,2,"setHeader"],[1,1088,66,13],[1,1097,66,22,"name"],[1,1099,66,28,"value"],[1,1102,67,4,"this"],[1,1107,67,9,"headers"],[1,1115,67,17,"name"],[1,1118,67,25,"value"],[1,1121,70,2,"close"],[1,1127,70,9],[1,1138,71,4],[1,1142,71,8,"transport"],[1,1144,71,20,"this"],[1,1149,71,25,"_transport"],[1,1167,72,11,"this"],[1,1172,72,16,"_transport"],[1,1183,73,8,"transport"],[1,1186,73,19,"transport"],[1,1188,73,29,"close"],[1,1197,76,2,"getConnectionTypes"],[1,1216,76,22],[1,1227,77,4],[1,1234,77,11,"Transport"],[1,1236,77,21,"getConnectionTypes"],[1,1258,80,2,"selectTransport"],[1,1274,80,19],[1,1283,80,28,"transportTypes"],[1,1286,81,4,"Transport"],[1,1288,81,14,"get"],[1,1292,81,18,"this"],[1,1297,81,24,"transportTypes"],[1,1299,81,40,"this"],[1,1304,81,45,"_disabled"],[1,1314,81,56],[1,1323,81,65,"transport"],[1,1326,82,6,"this"],[1,1331,82,11,"debug"],[1,1337,82,17],[1,1366,82,47,"transport"],[1,1368,82,57,"connectionType"],[1,1383,82,73,"transport"],[1,1385,82,83,"endpoint"],[1,1394,82,92,"href"],[1,1400,84,10,"transport"],[1,1404,84,24,"this"],[1,1409,84,29,"_transport"],[1,1422,85,10,"this"],[1,1427,85,15,"_transport"],[1,1439,85,27,"this"],[1,1444,85,32,"_transport"],[1,1455,85,43,"close"],[1,1463,87,6,"this"],[1,1468,87,11,"_transport"],[1,1479,87,24,"transport"],[1,1481,88,6,"this"],[1,1486,88,11,"connectionType"],[1,1501,88,28,"transport"],[1,1503,88,38,"connectionType"],[1,1520,89,7,"this"],[1,1527,92,2,"sendMessage"],[1,1539,92,15],[1,1548,92,24,"message"],[1,1550,92,33,"timeout"],[1,1552,92,42,"options"],[1,1555,93,4,"options"],[1,1557,93,14,"options"],[1,1563,95,4],[1,1567,99,8,"scheduler"],[1,1569,95,8,"id"],[1,1571,95,19,"message"],[1,1573,95,27,"id"],[1,1576,96,8,"attempts"],[1,1578,96,19,"options"],[1,1580,96,27,"attempts"],[1,1589,97,8,"deadline"],[1,1591,97,19,"options"],[1,1593,97,27,"deadline"],[1,1604,97,39],[1,1608,97,43,"Date"],[1,1614,97,50,"getTime"],[1,1624,97,82],[1,1628,97,63,"options"],[1,1630,97,71,"deadline"],[1,1639,98,8,"envelope"],[1,1641,98,19,"this"],[1,1646,98,24,"_envelopes"],[1,1657,98,35,"id"],[1,1660,101,9,"envelope"],[1,1664,102,6,"scheduler"],[1,1666,102,18],[1,1670,102,22,"this"],[1,1675,102,27,"_scheduler"],[1,1686,102,38,"message"],[1,1689,102,49,"timeout"],[1,1697,102,58,"timeout"],[1,1699,102,67,"interval"],[1,1708,102,77,"this"],[1,1713,102,82,"retry"],[1,1719,102,89,"attempts"],[1,1728,102,99,"attempts"],[1,1730,102,109,"deadline"],[1,1739,102,119,"deadline"],[1,1743,103,6,"envelope"],[1,1745,103,18,"this"],[1,1750,103,23,"_envelopes"],[1,1761,103,34,"id"],[1,1765,103,42,"message"],[1,1773,103,51,"message"],[1,1775,103,60,"scheduler"],[1,1785,103,71,"scheduler"],[1,1789,106,4,"this"],[1,1794,106,9,"_sendEnvelope"],[1,1808,106,23,"envelope"],[1,1812,109,2,"_sendEnvelope"],[1,1826,109,17],[1,1835,109,26,"envelope"],[1,1838,110,4],[1,1841,110,9,"this"],[1,1846,110,14,"_transport"],[1,1859,111,8,"envelope"],[1,1861,111,17,"request"],[1,1871,111,28,"envelope"],[1,1873,111,37,"timer"],[1,1879,111,4],[1,1880,113,4],[1,1884,113,8,"message"],[1,1886,113,20,"envelope"],[1,1888,113,29,"message"],[1,1896,114,8,"scheduler"],[1,1898,114,20,"envelope"],[1,1900,114,29,"scheduler"],[1,1910,115,8,"self"],[1,1912,115,20,"this"],[1,1917,117,4],[1,1921,117,9,"scheduler"],[1,1923,117,19,"isDeliverable"],[1,1939,120,6],[1,1946,118,6,"scheduler"],[1,1948,118,16,"abort"],[1,1968,119,13,"this"],[1,1973,119,18,"_envelopes"],[1,1984,119,29,"message"],[1,1986,119,37,"id"],[1,1990,123,4,"envelope"],[1,1992,123,13,"timer"],[1,1998,123,21,"global"],[1,2000,123,28,"setTimeout"],[1,2011,123,39],[1,2022,124,6,"self"],[1,2024,124,11,"handleError"],[1,2036,124,23,"message"],[1,2040,125,32],[1,2044,125,7,"scheduler"],[1,2046,125,17,"getTimeout"],[1,2060,127,4,"scheduler"],[1,2062,127,14,"send"],[1,2069,128,4,"envelope"],[1,2071,128,13,"request"],[1,2079,128,23,"this"],[1,2084,128,28,"_transport"],[1,2095,128,39,"sendMessage"],[1,2107,128,51,"message"],[1,2112,131,2,"handleResponse"],[1,2127,131,18],[1,2136,131,27,"reply"],[1,2139,132,4],[1,2143,132,8,"envelope"],[1,2145,132,19,"this"],[1,2150,132,24,"_envelopes"],[1,2161,132,35,"reply"],[1,2163,132,41,"id"],[1,2172,134,29,"undefined"],[1,2176,134,8,"reply"],[1,2178,134,14,"successful"],[1,2190,134,42,"envelope"],[1,2194,135,6,"envelope"],[1,2196,135,15,"scheduler"],[1,2206,135,25,"succeed"],[1,2223,136,13,"this"],[1,2228,136,18,"_envelopes"],[1,2239,136,29,"reply"],[1,2241,136,35,"id"],[1,2245,137,6,"global"],[1,2247,137,13,"clearTimeout"],[1,2260,137,26,"envelope"],[1,2262,137,35,"timer"],[1,2270,140,4,"this"],[1,2275,140,9,"trigger"],[1,2283,140,17],[1,2293,140,28,"reply"],[1,2296,142,8,"this"],[1,2301,142,13,"_state"],[1,2310,142,24,"this"],[1,2315,142,29,"UP"],[1,2320,143,4,"this"],[1,2325,143,9,"_state"],[1,2332,143,18,"this"],[1,2337,143,23,"UP"],[1,2340,144,4,"this"],[1,2345,144,9,"_client"],[1,2353,144,17,"trigger"],[1,2361,144,25],[1,2379,147,2,"handleError"],[1,2391,147,15],[1,2400,147,24,"message"],[1,2402,147,33,"immediate"],[1,2405,148,4],[1,2409,148,8,"envelope"],[1,2411,148,19,"this"],[1,2416,148,24,"_envelopes"],[1,2427,148,35,"message"],[1,2429,148,43,"id"],[1,2433,149,8,"request"],[1,2435,149,19,"envelope"],[1,2438,149,31,"envelope"],[1,2440,149,40,"request"],[1,2448,150,8,"self"],[1,2450,150,19,"this"],[1,2455,152,4],[1,2458,152,9,"request"],[1,2460,152,4],[1,2461,154,4,"request"],[1,2463,154,12,"then"],[1,2468,154,17],[1,2477,154,26,"req"],[1,2480,155,10,"req"],[1,2483,155,17,"req"],[1,2485,155,21,"abort"],[1,2492,155,28,"req"],[1,2494,155,32,"abort"],[1,2504,158,4],[1,2508,158,8,"scheduler"],[1,2510,158,20,"envelope"],[1,2512,158,29,"scheduler"],[1,2522,159,4,"scheduler"],[1,2524,159,14,"fail"],[1,2531,161,4,"global"],[1,2533,161,11,"clearTimeout"],[1,2546,161,24,"envelope"],[1,2548,161,33,"timer"],[1,2555,162,4,"envelope"],[1,2557,162,13,"request"],[1,2565,162,23,"envelope"],[1,2567,162,32,"timer"],[1,2573,162,40],[1,2578,164,8,"immediate"],[1,2580,165,6,"this"],[1,2585,165,11,"_sendEnvelope"],[1,2599,165,25,"envelope"],[1,2602,167,6,"envelope"],[1,2604,167,15,"timer"],[1,2610,167,23,"global"],[1,2612,167,30,"setTimeout"],[1,2623,167,41],[1,2634,168,8,"envelope"],[1,2636,168,17,"timer"],[1,2642,168,25],[1,2647,169,8,"self"],[1,2649,169,13,"_sendEnvelope"],[1,2663,169,27,"envelope"],[1,2667,170,35],[1,2671,170,9,"scheduler"],[1,2673,170,19,"getInterval"],[1,2688,173,8,"this"],[1,2693,173,13,"_state"],[1,2702,173,24,"this"],[1,2707,173,29,"DOWN"],[1,2714,174,4,"this"],[1,2719,174,9,"_state"],[1,2726,174,18,"this"],[1,2731,174,23,"DOWN"],[1,2736,175,4,"this"],[1,2741,175,9,"_client"],[1,2749,175,17,"trigger"],[1,2757,175,25],[1,2780,179,0,"Dispatcher"],[1,2782,179,11,"create"],[1,2789,179,20],[1,2798,179,29,"client"],[1,2800,179,37,"endpoint"],[1,2802,179,47,"options"],[1,2805,180,2],[1,2812,180,9],[1,2816,180,13,"Dispatcher"],[1,2818,180,24,"client"],[1,2820,180,32,"endpoint"],[1,2822,180,42,"options"],[1,2826,183,0,"assign"],[1,2828,183,7,"Dispatcher"],[1,2830,183,18,"prototype"],[1,2840,183,29,"Publisher"],[1,2843,184,0,"assign"],[1,2845,184,7,"Dispatcher"],[1,2847,184,18,"prototype"],[1,2857,184,29,"Logging"],[1,2860,186,0,"module"],[1,2862,186,7,"exports"],[1,2870,186,17,"Dispatcher"]],"functionMap":{"names":["<global>","Class$argument_0.initialize","Class$argument_0.endpointFor","Class$argument_0.addWebsocketExtension","Class$argument_0.disable","Class$argument_0.setHeader","Class$argument_0.close","Class$argument_0.getConnectionTypes","Class$argument_0.selectTransport","Transport.get$argument_3","Class$argument_0.sendMessage","Class$argument_0._sendEnvelope","global.setTimeout$argument_0","Class$argument_0.handleResponse","Class$argument_0.handleError","request.then$argument_0","Dispatcher.create"],"mappings":"AAA;cCkB;GDgC;eEE;GFE;yBGE;GHE;WIE;GJG;aKE;GLE;SME;GNI;sBOE;GPE;mBQE;wDCC;KDQ;GRC;eUE;GVe;iBWE;uCCc;KDE;GXI;kBaE;Gbc;ecE;iBCO;KDE;yCFW;OEG;GdM;oBgBG;ChBE"}},"type":"js/module"}]}