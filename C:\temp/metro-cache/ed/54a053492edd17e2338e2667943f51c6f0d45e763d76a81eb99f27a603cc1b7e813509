{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/helpers/interopRequireWildcard","data":{"isAsync":false}},{"name":"react","data":{"isAsync":false}},{"name":"./NavigationBuilderContext","data":{"isAsync":false}},{"name":"./useOnPreventRemove","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  var _interopRequireWildcard = _$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/helpers/interopRequireWildcard\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = useOnAction;\n\n  var React = _interopRequireWildcard(_$$_REQUIRE(_dependencyMap[2], \"react\"));\n\n  var _NavigationBuilderContext = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[3], \"./NavigationBuilderContext\"));\n\n  var _useOnPreventRemove = _interopRequireWildcard(_$$_REQUIRE(_dependencyMap[4], \"./useOnPreventRemove\"));\n\n  function useOnAction(_ref) {\n    var router = _ref.router,\n        getState = _ref.getState,\n        setState = _ref.setState,\n        key = _ref.key,\n        actionListeners = _ref.actionListeners,\n        beforeRemoveListeners = _ref.beforeRemoveListeners,\n        routerConfigOptions = _ref.routerConfigOptions,\n        emitter = _ref.emitter;\n\n    var _React$useContext = React.useContext(_NavigationBuilderContext.default),\n        onActionParent = _React$useContext.onAction,\n        onRouteFocusParent = _React$useContext.onRouteFocus,\n        addListenerParent = _React$useContext.addListener,\n        onDispatchAction = _React$useContext.onDispatchAction;\n\n    var routerConfigOptionsRef = React.useRef(routerConfigOptions);\n    React.useEffect(function () {\n      routerConfigOptionsRef.current = routerConfigOptions;\n    });\n    var onAction = React.useCallback(function (action) {\n      var visitedNavigators = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new Set();\n      var state = getState();\n\n      if (visitedNavigators.has(state.key)) {\n        return false;\n      }\n\n      visitedNavigators.add(state.key);\n\n      if (typeof action.target !== 'string' || action.target === state.key) {\n        var result = router.getStateForAction(state, action, routerConfigOptionsRef.current);\n        result = result === null && action.target === state.key ? state : result;\n\n        if (result !== null) {\n          onDispatchAction(action, state === result);\n\n          if (state !== result) {\n            var nextRouteKeys = result.routes.map(function (route) {\n              return route.key;\n            });\n            var removedRoutes = state.routes.filter(function (route) {\n              return !nextRouteKeys.includes(route.key);\n            });\n            var isPrevented = (0, _useOnPreventRemove.shouldPreventRemove)(emitter, beforeRemoveListeners, removedRoutes, action);\n\n            if (isPrevented) {\n              return true;\n            }\n\n            setState(result);\n          }\n\n          if (onRouteFocusParent !== undefined) {\n            var shouldFocus = router.shouldActionChangeFocus(action);\n\n            if (shouldFocus && key !== undefined) {\n              onRouteFocusParent(key);\n            }\n          }\n\n          return true;\n        }\n      }\n\n      if (onActionParent !== undefined) {\n        if (onActionParent(action, visitedNavigators)) {\n          return true;\n        }\n      }\n\n      for (var i = actionListeners.length - 1; i >= 0; i--) {\n        var listener = actionListeners[i];\n\n        if (listener(action, visitedNavigators)) {\n          return true;\n        }\n      }\n\n      return false;\n    }, [actionListeners, beforeRemoveListeners, emitter, getState, key, onActionParent, onDispatchAction, onRouteFocusParent, router, setState]);\n    (0, _useOnPreventRemove.default)({\n      getState: getState,\n      emitter: emitter,\n      beforeRemoveListeners: beforeRemoveListeners\n    });\n    React.useEffect(function () {\n      return addListenerParent == null ? void 0 : addListenerParent('action', onAction);\n    }, [addListenerParent, onAction]);\n    return onAction;\n  }\n});","lineCount":108,"map":[[11,0,1,0],[13,0,9,0],[15,0,13,0],[17,0,37,15],[17,11,37,24,"useOnAction"],[17,22,37,15],[17,29,46,12],[18,0,46,12],[18,8,38,2,"router"],[18,14,46,12],[18,22,38,2,"router"],[18,28,46,12],[19,0,46,12],[19,8,39,2,"getState"],[19,16,46,12],[19,24,39,2,"getState"],[19,32,46,12],[20,0,46,12],[20,8,40,2,"setState"],[20,16,46,12],[20,24,40,2,"setState"],[20,32,46,12],[21,0,46,12],[21,8,41,2,"key"],[21,11,46,12],[21,19,41,2,"key"],[21,22,46,12],[22,0,46,12],[22,8,42,2,"actionListeners"],[22,23,46,12],[22,31,42,2,"actionListeners"],[22,46,46,12],[23,0,46,12],[23,8,43,2,"beforeRemoveListeners"],[23,29,46,12],[23,37,43,2,"beforeRemoveListeners"],[23,58,46,12],[24,0,46,12],[24,8,44,2,"routerConfigOptions"],[24,27,46,12],[24,35,44,2,"routerConfigOptions"],[24,54,46,12],[25,0,46,12],[25,8,45,2,"emitter"],[25,15,46,12],[25,23,45,2,"emitter"],[25,30,46,12],[27,0,46,12],[27,28,52,6,"React"],[27,33,52,11],[27,34,52,12,"useContext"],[27,44,52,6],[27,45,52,23,"NavigationBuilderContext"],[27,78,52,6],[27,79,46,12],[28,0,46,12],[28,8,48,14,"onActionParent"],[28,22,46,12],[28,43,48,4,"onAction"],[28,51,46,12],[29,0,46,12],[29,8,49,18,"onRouteFocusParent"],[29,26,46,12],[29,47,49,4,"onRouteFocus"],[29,59,46,12],[30,0,46,12],[30,8,50,17,"addListenerParent"],[30,25,46,12],[30,46,50,4,"addListener"],[30,57,46,12],[31,0,46,12],[31,8,51,4,"onDispatchAction"],[31,24,46,12],[31,45,51,4,"onDispatchAction"],[31,61,46,12],[33,0,54,2],[33,8,54,8,"routerConfigOptionsRef"],[33,30,54,30],[33,33,54,33,"React"],[33,38,54,38],[33,39,54,39,"useRef"],[33,45,54,33],[33,46,55,4,"routerConfigOptions"],[33,65,54,33],[33,66,54,2],[34,0,58,2,"React"],[34,4,58,2,"React"],[34,9,58,7],[34,10,58,8,"useEffect"],[34,19,58,2],[34,20,58,18],[34,32,58,24],[35,0,59,4,"routerConfigOptionsRef"],[35,6,59,4,"routerConfigOptionsRef"],[35,28,59,26],[35,29,59,27,"current"],[35,36,59,4],[35,39,59,37,"routerConfigOptions"],[35,58,59,4],[36,0,60,3],[36,5,58,2],[37,0,62,2],[37,8,62,8,"onAction"],[37,16,62,16],[37,19,62,19,"React"],[37,24,62,24],[37,25,62,25,"useCallback"],[37,36,62,19],[37,37,63,4],[37,47,64,6,"action"],[37,53,63,4],[37,55,66,9],[38,0,66,9],[38,10,65,6,"visitedNavigators"],[38,27,66,9],[38,98,65,39],[38,102,65,43,"Set"],[38,105,65,39],[38,107,66,9],[39,0,67,6],[39,10,67,12,"state"],[39,15,67,17],[39,18,67,20,"getState"],[39,26,67,28],[39,28,67,6],[41,0,71,6],[41,10,71,10,"visitedNavigators"],[41,27,71,27],[41,28,71,28,"has"],[41,31,71,10],[41,32,71,32,"state"],[41,37,71,37],[41,38,71,38,"key"],[41,41,71,10],[41,42,71,6],[41,44,71,44],[42,0,72,8],[42,15,72,15],[42,20,72,8],[43,0,73,7],[45,0,75,6,"visitedNavigators"],[45,6,75,6,"visitedNavigators"],[45,23,75,23],[45,24,75,24,"add"],[45,27,75,6],[45,28,75,28,"state"],[45,33,75,33],[45,34,75,34,"key"],[45,37,75,6],[47,0,77,6],[47,10,77,10],[47,17,77,17,"action"],[47,23,77,23],[47,24,77,24,"target"],[47,30,77,10],[47,35,77,35],[47,43,77,10],[47,47,77,47,"action"],[47,53,77,53],[47,54,77,54,"target"],[47,60,77,47],[47,65,77,65,"state"],[47,70,77,70],[47,71,77,71,"key"],[47,74,77,6],[47,76,77,76],[48,0,78,8],[48,12,78,12,"result"],[48,18,78,18],[48,21,78,21,"router"],[48,27,78,27],[48,28,78,28,"getStateForAction"],[48,45,78,21],[48,46,79,10,"state"],[48,51,78,21],[48,53,80,10,"action"],[48,59,78,21],[48,61,81,10,"routerConfigOptionsRef"],[48,83,81,32],[48,84,81,33,"current"],[48,91,78,21],[48,92,78,8],[49,0,86,8,"result"],[49,8,86,8,"result"],[49,14,86,14],[49,17,87,10,"result"],[49,23,87,16],[49,28,87,21],[49,32,87,10],[49,36,87,29,"action"],[49,42,87,35],[49,43,87,36,"target"],[49,49,87,29],[49,54,87,47,"state"],[49,59,87,52],[49,60,87,53,"key"],[49,63,87,10],[49,66,87,59,"state"],[49,71,87,10],[49,74,87,67,"result"],[49,80,86,8],[51,0,89,8],[51,12,89,12,"result"],[51,18,89,18],[51,23,89,23],[51,27,89,8],[51,29,89,29],[52,0,90,10,"onDispatchAction"],[52,10,90,10,"onDispatchAction"],[52,26,90,26],[52,27,90,27,"action"],[52,33,90,26],[52,35,90,35,"state"],[52,40,90,40],[52,45,90,45,"result"],[52,51,90,26],[52,52,90,10],[54,0,92,10],[54,14,92,14,"state"],[54,19,92,19],[54,24,92,24,"result"],[54,30,92,10],[54,32,92,32],[55,0,93,12],[55,16,93,18,"nextRouteKeys"],[55,29,93,31],[55,32,93,35,"result"],[55,38,93,41],[55,39,93,42,"routes"],[55,45,93,34],[55,46,93,59,"map"],[55,49,93,34],[55,50,94,14],[55,60,94,15,"route"],[55,65,94,14],[56,0,94,14],[56,21,94,43,"route"],[56,26,94,48],[56,27,94,49,"key"],[56,30,94,14],[57,0,94,14],[57,13,93,34],[57,14,93,12],[58,0,97,12],[58,16,97,18,"removedRoutes"],[58,29,97,31],[58,32,97,34,"state"],[58,37,97,39],[58,38,97,40,"routes"],[58,44,97,34],[58,45,97,47,"filter"],[58,51,97,34],[58,52,98,14],[58,62,98,15,"route"],[58,67,98,14],[59,0,98,14],[59,21,98,25],[59,22,98,26,"nextRouteKeys"],[59,35,98,39],[59,36,98,40,"includes"],[59,44,98,26],[59,45,98,49,"route"],[59,50,98,54],[59,51,98,55,"key"],[59,54,98,26],[59,55,98,14],[60,0,98,14],[60,13,97,34],[60,14,97,12],[61,0,101,12],[61,16,101,18,"isPrevented"],[61,27,101,29],[61,30,101,32],[61,75,102,14,"emitter"],[61,82,101,32],[61,84,103,14,"beforeRemoveListeners"],[61,105,101,32],[61,107,104,14,"removedRoutes"],[61,120,101,32],[61,122,105,14,"action"],[61,128,101,32],[61,129,101,12],[63,0,108,12],[63,16,108,16,"isPrevented"],[63,27,108,12],[63,29,108,29],[64,0,109,14],[64,21,109,21],[64,25,109,14],[65,0,110,13],[67,0,112,12,"setState"],[67,12,112,12,"setState"],[67,20,112,20],[67,21,112,21,"result"],[67,27,112,20],[67,28,112,12],[68,0,113,11],[70,0,115,10],[70,14,115,14,"onRouteFocusParent"],[70,32,115,32],[70,37,115,37,"undefined"],[70,46,115,10],[70,48,115,48],[71,0,118,12],[71,16,118,18,"shouldFocus"],[71,27,118,29],[71,30,118,32,"router"],[71,36,118,38],[71,37,118,39,"shouldActionChangeFocus"],[71,60,118,32],[71,61,118,63,"action"],[71,67,118,32],[71,68,118,12],[73,0,120,12],[73,16,120,16,"shouldFocus"],[73,27,120,27],[73,31,120,31,"key"],[73,34,120,34],[73,39,120,39,"undefined"],[73,48,120,12],[73,50,120,50],[74,0,121,14,"onRouteFocusParent"],[74,14,121,14,"onRouteFocusParent"],[74,32,121,32],[74,33,121,33,"key"],[74,36,121,32],[74,37,121,14],[75,0,122,13],[76,0,123,11],[78,0,125,10],[78,17,125,17],[78,21,125,10],[79,0,126,9],[80,0,127,7],[82,0,129,6],[82,10,129,10,"onActionParent"],[82,24,129,24],[82,29,129,29,"undefined"],[82,38,129,6],[82,40,129,40],[83,0,131,8],[83,12,131,12,"onActionParent"],[83,26,131,26],[83,27,131,27,"action"],[83,33,131,26],[83,35,131,35,"visitedNavigators"],[83,52,131,26],[83,53,131,8],[83,55,131,55],[84,0,132,10],[84,17,132,17],[84,21,132,10],[85,0,133,9],[86,0,134,7],[88,0,137,6],[88,11,137,11],[88,15,137,15,"i"],[88,16,137,16],[88,19,137,19,"actionListeners"],[88,34,137,34],[88,35,137,35,"length"],[88,41,137,19],[88,44,137,44],[88,45,137,6],[88,47,137,47,"i"],[88,48,137,48],[88,52,137,52],[88,53,137,6],[88,55,137,55,"i"],[88,56,137,56],[88,58,137,6],[88,60,137,60],[89,0,138,8],[89,12,138,14,"listener"],[89,20,138,22],[89,23,138,25,"actionListeners"],[89,38,138,40],[89,39,138,41,"i"],[89,40,138,40],[89,41,138,8],[91,0,140,8],[91,12,140,12,"listener"],[91,20,140,20],[91,21,140,21,"action"],[91,27,140,20],[91,29,140,29,"visitedNavigators"],[91,46,140,20],[91,47,140,8],[91,49,140,49],[92,0,141,10],[92,17,141,17],[92,21,141,10],[93,0,142,9],[94,0,143,7],[96,0,145,6],[96,13,145,13],[96,18,145,6],[97,0,146,5],[97,5,62,19],[97,7,147,4],[97,8,148,6,"actionListeners"],[97,23,147,4],[97,25,149,6,"beforeRemoveListeners"],[97,46,147,4],[97,48,150,6,"emitter"],[97,55,147,4],[97,57,151,6,"getState"],[97,65,147,4],[97,67,152,6,"key"],[97,70,147,4],[97,72,153,6,"onActionParent"],[97,86,147,4],[97,88,154,6,"onDispatchAction"],[97,104,147,4],[97,106,155,6,"onRouteFocusParent"],[97,124,147,4],[97,126,156,6,"router"],[97,132,147,4],[97,134,157,6,"setState"],[97,142,147,4],[97,143,62,19],[97,144,62,2],[98,0,161,2],[98,37,161,21],[99,0,162,4,"getState"],[99,6,162,4,"getState"],[99,14,162,12],[99,16,162,4,"getState"],[99,24,161,21],[100,0,163,4,"emitter"],[100,6,163,4,"emitter"],[100,13,163,11],[100,15,163,4,"emitter"],[100,22,161,21],[101,0,164,4,"beforeRemoveListeners"],[101,6,164,4,"beforeRemoveListeners"],[101,27,164,25],[101,29,164,4,"beforeRemoveListeners"],[102,0,161,21],[102,5,161,2],[103,0,167,2,"React"],[103,4,167,2,"React"],[103,9,167,7],[103,10,167,8,"useEffect"],[103,19,167,2],[103,20,167,18],[104,0,167,18],[104,13,167,24,"addListenerParent"],[104,30,167,18],[104,50,167,24,"addListenerParent"],[104,67,167,41],[104,68,167,44],[104,76,167,41],[104,78,167,54,"onAction"],[104,86,167,41],[104,87,167,18],[105,0,167,18],[105,5,167,2],[105,7,167,65],[105,8,168,4,"addListenerParent"],[105,25,167,65],[105,27,169,4,"onAction"],[105,35,167,65],[105,36,167,2],[106,0,172,2],[106,11,172,9,"onAction"],[106,19,172,2],[107,0,173,1]],"functionMap":{"names":["<global>","useOnAction","React.useEffect$argument_0","React.useCallback$argument_0","map$argument_0","state.routes.filter$argument_0"],"mappings":"AAA;eCoC;kBCqB;GDE;IEG;cC+B,sCD;cEI,6CF;KFgD;kBCqB,6CD;CDM"}},"type":"js/module"}]}