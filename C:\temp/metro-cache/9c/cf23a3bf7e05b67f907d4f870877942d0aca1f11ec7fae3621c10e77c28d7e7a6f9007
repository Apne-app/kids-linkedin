{"dependencies":[{"name":"../util/class","data":{"isAsync":false,"locs":[{"start":{"line":3,"column":16},"end":{"line":3,"column":40}}]}},{"name":"../util/set","data":{"isAsync":false,"locs":[{"start":{"line":4,"column":16},"end":{"line":4,"column":38}}]}},{"name":"../util/uri","data":{"isAsync":false,"locs":[{"start":{"line":5,"column":16},"end":{"line":5,"column":38}}]}},{"name":"../util/assign","data":{"isAsync":false,"locs":[{"start":{"line":6,"column":16},"end":{"line":6,"column":41}}]}},{"name":"../util/to_json","data":{"isAsync":false,"locs":[{"start":{"line":7,"column":16},"end":{"line":7,"column":42}}]}},{"name":"./transport","data":{"isAsync":false,"locs":[{"start":{"line":8,"column":16},"end":{"line":8,"column":38}}]}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var Class = _$$_REQUIRE(_dependencyMap[0], \"../util/class\"),\n      Set = _$$_REQUIRE(_dependencyMap[1], \"../util/set\"),\n      URI = _$$_REQUIRE(_dependencyMap[2], \"../util/uri\"),\n      assign = _$$_REQUIRE(_dependencyMap[3], \"../util/assign\"),\n      toJSON = _$$_REQUIRE(_dependencyMap[4], \"../util/to_json\"),\n      Transport = _$$_REQUIRE(_dependencyMap[5], \"./transport\");\n\n  var CORS = assign(Class(Transport, {\n    encode: function encode(messages) {\n      return 'message=' + encodeURIComponent(toJSON(messages));\n    },\n    request: function request(messages) {\n      var xhrClass = global.XDomainRequest ? XDomainRequest : XMLHttpRequest,\n          xhr = new xhrClass(),\n          id = ++CORS._id,\n          headers = this._dispatcher.headers,\n          self = this,\n          key;\n      xhr.open('POST', this.endpoint.href, true);\n      xhr.withCredentials = true;\n\n      if (xhr.setRequestHeader) {\n        xhr.setRequestHeader('Pragma', 'no-cache');\n\n        for (key in headers) {\n          if (!headers.hasOwnProperty(key)) continue;\n          xhr.setRequestHeader(key, headers[key]);\n        }\n      }\n\n      var cleanUp = function cleanUp() {\n        if (!xhr) return false;\n\n        CORS._pending.remove(id);\n\n        xhr.onload = xhr.onerror = xhr.ontimeout = xhr.onprogress = null;\n        xhr = null;\n      };\n\n      xhr.onload = function () {\n        var replies;\n\n        try {\n          replies = JSON.parse(xhr.responseText);\n        } catch (error) {}\n\n        cleanUp();\n        if (replies) self._receive(replies);else self._handleError(messages);\n      };\n\n      xhr.onerror = xhr.ontimeout = function () {\n        cleanUp();\n\n        self._handleError(messages);\n      };\n\n      xhr.onprogress = function () {};\n\n      if (xhrClass === global.XDomainRequest) CORS._pending.add({\n        id: id,\n        xhr: xhr\n      });\n      xhr.send(this.encode(messages));\n      return xhr;\n    }\n  }), {\n    _id: 0,\n    _pending: new Set(),\n    isUsable: function isUsable(dispatcher, endpoint, callback, context) {\n      if (URI.isSameOrigin(endpoint)) return callback.call(context, false);\n      if (global.XDomainRequest) return callback.call(context, endpoint.protocol === location.protocol);\n\n      if (global.XMLHttpRequest) {\n        var xhr = new XMLHttpRequest();\n        return callback.call(context, xhr.withCredentials !== undefined);\n      }\n\n      return callback.call(context, false);\n    }\n  });\n  module.exports = CORS;\n});","lineCount":85,"map":[[2,0,1,0],[4,0,3,0],[4,6,3,4,"Class"],[4,11,3,9],[4,14,3,16,"require"],[4,25,3,23],[4,61,3,0],[5,0,3,0],[5,6,4,4,"Set"],[5,9,4,7],[5,12,4,16,"require"],[5,23,4,23],[5,57,3,0],[6,0,3,0],[6,6,5,4,"URI"],[6,9,5,7],[6,12,5,16,"require"],[6,23,5,23],[6,57,3,0],[7,0,3,0],[7,6,6,4,"assign"],[7,12,6,10],[7,15,6,16,"require"],[7,26,6,23],[7,63,3,0],[8,0,3,0],[8,6,7,4,"toJSON"],[8,12,7,10],[8,15,7,16,"require"],[8,26,7,23],[8,64,3,0],[9,0,3,0],[9,6,8,4,"Transport"],[9,15,8,13],[9,18,8,16,"require"],[9,29,8,23],[9,63,3,0],[11,0,10,0],[11,6,10,4,"CORS"],[11,10,10,8],[11,13,10,11,"assign"],[11,19,10,17],[11,20,10,18,"Class"],[11,25,10,23],[11,26,10,24,"Transport"],[11,35,10,23],[11,37,10,35],[12,0,11,2,"encode"],[12,4,11,2,"encode"],[12,10,11,8],[12,12,11,10],[12,28,11,19,"messages"],[12,36,11,10],[12,38,11,29],[13,0,12,4],[13,13,12,11],[13,26,12,24,"encodeURIComponent"],[13,44,12,42],[13,45,12,43,"toJSON"],[13,51,12,49],[13,52,12,50,"messages"],[13,60,12,49],[13,61,12,42],[13,62,12,4],[14,0,13,3],[14,5,10,35],[15,0,15,2,"request"],[15,4,15,2,"request"],[15,11,15,9],[15,13,15,11],[15,30,15,20,"messages"],[15,38,15,11],[15,40,15,30],[16,0,16,4],[16,10,16,8,"xhrClass"],[16,18,16,16],[16,21,16,19,"global"],[16,27,16,25],[16,28,16,26,"XDomainRequest"],[16,42,16,19],[16,45,16,43,"XDomainRequest"],[16,59,16,19],[16,62,16,60,"XMLHttpRequest"],[16,76,16,4],[17,0,16,4],[17,10,17,8,"xhr"],[17,13,17,11],[17,16,17,19],[17,20,17,23,"xhrClass"],[17,28,17,19],[17,30,16,4],[18,0,16,4],[18,10,18,8,"id"],[18,12,18,10],[18,15,18,19],[18,17,18,21,"CORS"],[18,21,18,25],[18,22,18,26,"_id"],[18,25,16,4],[19,0,16,4],[19,10,19,8,"headers"],[19,17,19,15],[19,20,19,19],[19,25,19,24,"_dispatcher"],[19,36,19,19],[19,37,19,36,"headers"],[19,44,16,4],[20,0,16,4],[20,10,20,8,"self"],[20,14,20,12],[20,17,20,19],[20,21,16,4],[21,0,16,4],[21,10,21,8,"key"],[21,13,16,4],[22,0,23,4,"xhr"],[22,6,23,4,"xhr"],[22,9,23,7],[22,10,23,8,"open"],[22,14,23,4],[22,15,23,13],[22,21,23,4],[22,23,23,21],[22,28,23,26,"endpoint"],[22,36,23,21],[22,37,23,35,"href"],[22,41,23,4],[22,43,23,41],[22,47,23,4],[23,0,24,4,"xhr"],[23,6,24,4,"xhr"],[23,9,24,7],[23,10,24,8,"withCredentials"],[23,25,24,4],[23,28,24,26],[23,32,24,4],[25,0,26,4],[25,10,26,8,"xhr"],[25,13,26,11],[25,14,26,12,"setRequestHeader"],[25,30,26,4],[25,32,26,30],[26,0,27,6,"xhr"],[26,8,27,6,"xhr"],[26,11,27,9],[26,12,27,10,"setRequestHeader"],[26,28,27,6],[26,29,27,27],[26,37,27,6],[26,39,27,37],[26,49,27,6],[28,0,28,6],[28,13,28,11,"key"],[28,16,28,6],[28,20,28,18,"headers"],[28,27,28,6],[28,29,28,27],[29,0,29,8],[29,14,29,12],[29,15,29,13,"headers"],[29,22,29,20],[29,23,29,21,"hasOwnProperty"],[29,37,29,13],[29,38,29,36,"key"],[29,41,29,13],[29,42,29,8],[29,44,29,42],[30,0,30,8,"xhr"],[30,10,30,8,"xhr"],[30,13,30,11],[30,14,30,12,"setRequestHeader"],[30,30,30,8],[30,31,30,29,"key"],[30,34,30,8],[30,36,30,34,"headers"],[30,43,30,41],[30,44,30,42,"key"],[30,47,30,41],[30,48,30,8],[31,0,31,7],[32,0,32,5],[34,0,34,4],[34,10,34,8,"cleanUp"],[34,17,34,15],[34,20,34,18],[34,29,34,8,"cleanUp"],[34,36,34,18],[34,39,34,29],[35,0,35,6],[35,12,35,10],[35,13,35,11,"xhr"],[35,16,35,6],[35,18,35,16],[35,25,35,23],[35,30,35,16],[37,0,36,6,"CORS"],[37,8,36,6,"CORS"],[37,12,36,10],[37,13,36,11,"_pending"],[37,21,36,6],[37,22,36,20,"remove"],[37,28,36,6],[37,29,36,27,"id"],[37,31,36,6],[39,0,37,6,"xhr"],[39,8,37,6,"xhr"],[39,11,37,9],[39,12,37,10,"onload"],[39,18,37,6],[39,21,37,19,"xhr"],[39,24,37,22],[39,25,37,23,"onerror"],[39,32,37,19],[39,35,37,33,"xhr"],[39,38,37,36],[39,39,37,37,"ontimeout"],[39,48,37,33],[39,51,37,49,"xhr"],[39,54,37,52],[39,55,37,53,"onprogress"],[39,65,37,49],[39,68,37,66],[39,72,37,6],[40,0,38,6,"xhr"],[40,8,38,6,"xhr"],[40,11,38,9],[40,14,38,12],[40,18,38,6],[41,0,39,5],[41,7,34,4],[43,0,41,4,"xhr"],[43,6,41,4,"xhr"],[43,9,41,7],[43,10,41,8,"onload"],[43,16,41,4],[43,19,41,17],[43,31,41,28],[44,0,42,6],[44,12,42,10,"replies"],[44,19,42,6],[46,0,43,6],[46,12,43,10],[47,0,43,12,"replies"],[47,10,43,12,"replies"],[47,17,43,19],[47,20,43,22,"JSON"],[47,24,43,26],[47,25,43,27,"parse"],[47,30,43,22],[47,31,43,33,"xhr"],[47,34,43,36],[47,35,43,37,"responseText"],[47,47,43,22],[47,48,43,12],[48,0,43,52],[48,9,43,6],[48,10,43,53],[48,17,43,60,"error"],[48,22,43,53],[48,24,43,67],[48,25,43,69],[50,0,45,6,"cleanUp"],[50,8,45,6,"cleanUp"],[50,15,45,13],[51,0,47,6],[51,12,47,10,"replies"],[51,19,47,6],[51,21,48,8,"self"],[51,25,48,12],[51,26,48,13,"_receive"],[51,34,48,8],[51,35,48,22,"replies"],[51,42,48,8],[51,44,47,6],[51,49,50,8,"self"],[51,53,50,12],[51,54,50,13,"_handleError"],[51,66,50,8],[51,67,50,26,"messages"],[51,75,50,8],[52,0,51,5],[52,7,41,4],[54,0,53,4,"xhr"],[54,6,53,4,"xhr"],[54,9,53,7],[54,10,53,8,"onerror"],[54,17,53,4],[54,20,53,18,"xhr"],[54,23,53,21],[54,24,53,22,"ontimeout"],[54,33,53,18],[54,36,53,34],[54,48,53,45],[55,0,54,6,"cleanUp"],[55,8,54,6,"cleanUp"],[55,15,54,13],[57,0,55,6,"self"],[57,8,55,6,"self"],[57,12,55,10],[57,13,55,11,"_handleError"],[57,25,55,6],[57,26,55,24,"messages"],[57,34,55,6],[58,0,56,5],[58,7,53,4],[60,0,58,4,"xhr"],[60,6,58,4,"xhr"],[60,9,58,7],[60,10,58,8,"onprogress"],[60,20,58,4],[60,23,58,21],[60,35,58,32],[60,36,58,34],[60,37,58,4],[62,0,60,4],[62,10,60,8,"xhrClass"],[62,18,60,16],[62,23,60,21,"global"],[62,29,60,27],[62,30,60,28,"XDomainRequest"],[62,44,60,4],[62,46,61,6,"CORS"],[62,50,61,10],[62,51,61,11,"_pending"],[62,59,61,6],[62,60,61,20,"add"],[62,63,61,6],[62,64,61,24],[63,0,61,26,"id"],[63,8,61,26,"id"],[63,10,61,28],[63,12,61,30,"id"],[63,14,61,24],[64,0,61,34,"xhr"],[64,8,61,34,"xhr"],[64,11,61,37],[64,13,61,39,"xhr"],[65,0,61,24],[65,7,61,6],[66,0,63,4,"xhr"],[66,6,63,4,"xhr"],[66,9,63,7],[66,10,63,8,"send"],[66,14,63,4],[66,15,63,13],[66,20,63,18,"encode"],[66,26,63,13],[66,27,63,25,"messages"],[66,35,63,13],[66,36,63,4],[67,0,64,4],[67,13,64,11,"xhr"],[67,16,64,4],[68,0,65,3],[69,0,10,35],[69,3,10,23],[69,4,10,17],[69,6,66,4],[70,0,67,2,"_id"],[70,4,67,2,"_id"],[70,7,67,5],[70,9,67,12],[70,10,66,4],[71,0,68,2,"_pending"],[71,4,68,2,"_pending"],[71,12,68,10],[71,14,68,12],[71,18,68,16,"Set"],[71,21,68,12],[71,23,66,4],[72,0,70,2,"isUsable"],[72,4,70,2,"isUsable"],[72,12,70,10],[72,14,70,12],[72,32,70,21,"dispatcher"],[72,42,70,12],[72,44,70,33,"endpoint"],[72,52,70,12],[72,54,70,43,"callback"],[72,62,70,12],[72,64,70,53,"context"],[72,71,70,12],[72,73,70,62],[73,0,71,4],[73,10,71,8,"URI"],[73,13,71,11],[73,14,71,12,"isSameOrigin"],[73,26,71,8],[73,27,71,25,"endpoint"],[73,35,71,8],[73,36,71,4],[73,38,72,6],[73,45,72,13,"callback"],[73,53,72,21],[73,54,72,22,"call"],[73,58,72,13],[73,59,72,27,"context"],[73,66,72,13],[73,68,72,36],[73,73,72,13],[73,74,72,6],[74,0,74,4],[74,10,74,8,"global"],[74,16,74,14],[74,17,74,15,"XDomainRequest"],[74,31,74,4],[74,33,75,6],[74,40,75,13,"callback"],[74,48,75,21],[74,49,75,22,"call"],[74,53,75,13],[74,54,75,27,"context"],[74,61,75,13],[74,63,75,36,"endpoint"],[74,71,75,44],[74,72,75,45,"protocol"],[74,80,75,36],[74,85,75,58,"location"],[74,93,75,66],[74,94,75,67,"protocol"],[74,102,75,13],[74,103,75,6],[76,0,77,4],[76,10,77,8,"global"],[76,16,77,14],[76,17,77,15,"XMLHttpRequest"],[76,31,77,4],[76,33,77,31],[77,0,78,6],[77,12,78,10,"xhr"],[77,15,78,13],[77,18,78,16],[77,22,78,20,"XMLHttpRequest"],[77,36,78,16],[77,38,78,6],[78,0,79,6],[78,15,79,13,"callback"],[78,23,79,21],[78,24,79,22,"call"],[78,28,79,13],[78,29,79,27,"context"],[78,36,79,13],[78,38,79,36,"xhr"],[78,41,79,39],[78,42,79,40,"withCredentials"],[78,57,79,36],[78,62,79,60,"undefined"],[78,71,79,13],[78,72,79,6],[79,0,80,5],[81,0,81,4],[81,13,81,11,"callback"],[81,21,81,19],[81,22,81,20,"call"],[81,26,81,11],[81,27,81,25,"context"],[81,34,81,11],[81,36,81,34],[81,41,81,11],[81,42,81,4],[82,0,82,3],[83,0,66,4],[83,3,10,17],[83,4,10,0],[84,0,85,0,"module"],[84,2,85,0,"module"],[84,8,85,6],[84,9,85,7,"exports"],[84,16,85,0],[84,19,85,17,"CORS"],[84,23,85,0]],"functionMap":{"names":["<global>","Class$argument_1.encode","Class$argument_1.request","cleanUp","xhr.onload","xhr.ontimeout","xhr.onprogress","assign$argument_1.isUsable"],"mappings":"AAA;UCU;GDE;WEE;kBCmB;KDK;iBEE;KFU;kCGE;KHG;qBIE,aJ;GFO;YOK;GPY"}},"type":"js/module"}]}