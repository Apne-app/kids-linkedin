{"dependencies":[{"name":"./socket-io","data":{"isAsync":false}},{"name":"./constants","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  var socket_io_1 = _$$_REQUIRE(_dependencyMap[0], \"./socket-io\");\n\n  var constants_1 = _$$_REQUIRE(_dependencyMap[1], \"./constants\");\n\n  exports.attachListeners = function (webSocketInstance, setters, optionsRef, reconnect, reconnectCount) {\n    var setLastMessage = setters.setLastMessage,\n        setReadyState = setters.setReadyState;\n    var interval;\n    var reconnectTimeout;\n\n    if (optionsRef.current.fromSocketIO) {\n      interval = socket_io_1.setUpSocketIOPing(webSocketInstance);\n    }\n\n    webSocketInstance.onmessage = function (message) {\n      optionsRef.current.onMessage && optionsRef.current.onMessage(message);\n\n      if (typeof optionsRef.current.filter === 'function' && optionsRef.current.filter(message) !== true) {\n        return;\n      }\n\n      setLastMessage(message);\n    };\n\n    webSocketInstance.onopen = function (event) {\n      optionsRef.current.onOpen && optionsRef.current.onOpen(event);\n      reconnectCount.current = 0;\n      setReadyState(constants_1.ReadyState.OPEN);\n    };\n\n    webSocketInstance.onclose = function (event) {\n      var _a, _b;\n\n      optionsRef.current.onClose && optionsRef.current.onClose(event);\n      setReadyState(constants_1.ReadyState.CLOSED);\n\n      if (optionsRef.current.shouldReconnect && optionsRef.current.shouldReconnect(event)) {\n        var reconnectAttempts = (_a = optionsRef.current.reconnectAttempts, _a !== null && _a !== void 0 ? _a : constants_1.DEFAULT_RECONNECT_LIMIT);\n\n        if (reconnectCount.current < reconnectAttempts) {\n          reconnectTimeout = setTimeout(function () {\n            reconnectCount.current++;\n            reconnect();\n          }, (_b = optionsRef.current.reconnectInterval, _b !== null && _b !== void 0 ? _b : constants_1.DEFAULT_RECONNECT_INTERVAL_MS));\n        } else {\n          console.error(\"Max reconnect attempts of \" + reconnectAttempts + \" exceeded\");\n        }\n      }\n    };\n\n    webSocketInstance.onerror = function (error) {\n      var _a, _b;\n\n      optionsRef.current.onError && optionsRef.current.onError(error);\n\n      if (optionsRef.current.retryOnError) {\n        if (reconnectCount.current < (_a = optionsRef.current.reconnectAttempts, _a !== null && _a !== void 0 ? _a : constants_1.DEFAULT_RECONNECT_LIMIT)) {\n          reconnectTimeout = setTimeout(function () {\n            reconnectCount.current++;\n            reconnect();\n          }, (_b = optionsRef.current.reconnectInterval, _b !== null && _b !== void 0 ? _b : constants_1.DEFAULT_RECONNECT_INTERVAL_MS));\n        }\n      }\n    };\n\n    return function () {\n      setReadyState(constants_1.ReadyState.CLOSING);\n      if (reconnectTimeout) clearTimeout(reconnectTimeout);\n      webSocketInstance.close();\n      if (interval) clearInterval(interval);\n    };\n  };\n});","lineCount":80,"map":[[2,0,1,0],[4,0,2,0,"Object"],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,0],[4,24,2,22,"exports"],[4,31,2,0],[4,33,2,31],[4,45,2,0],[4,47,2,45],[5,0,2,47,"value"],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,0,2,45],[6,3,2,0],[8,0,3,0],[8,6,3,4,"socket_io_1"],[8,17,3,15],[8,20,3,18,"require"],[8,31,3,25],[8,65,3,0],[10,0,4,0],[10,6,4,4,"constants_1"],[10,17,4,15],[10,20,4,18,"require"],[10,31,4,25],[10,65,4,0],[12,0,5,0,"exports"],[12,2,5,0,"exports"],[12,9,5,7],[12,10,5,8,"attachListeners"],[12,25,5,0],[12,28,5,26],[12,38,5,36,"webSocketInstance"],[12,55,5,26],[12,57,5,55,"setters"],[12,64,5,26],[12,66,5,64,"optionsRef"],[12,76,5,26],[12,78,5,76,"reconnect"],[12,87,5,26],[12,89,5,87,"reconnectCount"],[12,103,5,26],[12,105,5,103],[13,0,6,4],[13,8,6,8,"setLastMessage"],[13,22,6,22],[13,25,6,25,"setters"],[13,32,6,32],[13,33,6,33,"setLastMessage"],[13,47,6,4],[14,0,6,4],[14,8,6,49,"setReadyState"],[14,21,6,62],[14,24,6,65,"setters"],[14,31,6,72],[14,32,6,73,"setReadyState"],[14,45,6,4],[15,0,7,4],[15,8,7,8,"interval"],[15,16,7,4],[16,0,8,4],[16,8,8,8,"reconnectTimeout"],[16,24,8,4],[18,0,9,4],[18,8,9,8,"optionsRef"],[18,18,9,18],[18,19,9,19,"current"],[18,26,9,8],[18,27,9,27,"fromSocketIO"],[18,39,9,4],[18,41,9,41],[19,0,10,8,"interval"],[19,6,10,8,"interval"],[19,14,10,16],[19,17,10,19,"socket_io_1"],[19,28,10,30],[19,29,10,31,"setUpSocketIOPing"],[19,46,10,19],[19,47,10,49,"webSocketInstance"],[19,64,10,19],[19,65,10,8],[20,0,11,5],[22,0,12,4,"webSocketInstance"],[22,4,12,4,"webSocketInstance"],[22,21,12,21],[22,22,12,22,"onmessage"],[22,31,12,4],[22,34,12,34],[22,44,12,44,"message"],[22,51,12,34],[22,53,12,53],[23,0,13,8,"optionsRef"],[23,6,13,8,"optionsRef"],[23,16,13,18],[23,17,13,19,"current"],[23,24,13,8],[23,25,13,27,"onMessage"],[23,34,13,8],[23,38,13,40,"optionsRef"],[23,48,13,50],[23,49,13,51,"current"],[23,56,13,40],[23,57,13,59,"onMessage"],[23,66,13,40],[23,67,13,69,"message"],[23,74,13,40],[23,75,13,8],[25,0,14,8],[25,10,14,12],[25,17,14,19,"optionsRef"],[25,27,14,29],[25,28,14,30,"current"],[25,35,14,19],[25,36,14,38,"filter"],[25,42,14,12],[25,47,14,49],[25,57,14,12],[25,61,14,63,"optionsRef"],[25,71,14,73],[25,72,14,74,"current"],[25,79,14,63],[25,80,14,82,"filter"],[25,86,14,63],[25,87,14,89,"message"],[25,94,14,63],[25,100,14,102],[25,104,14,8],[25,106,14,108],[26,0,15,12],[27,0,16,9],[29,0,17,8,"setLastMessage"],[29,6,17,8,"setLastMessage"],[29,20,17,22],[29,21,17,23,"message"],[29,28,17,22],[29,29,17,8],[30,0,18,5],[30,5,12,4],[32,0,19,4,"webSocketInstance"],[32,4,19,4,"webSocketInstance"],[32,21,19,21],[32,22,19,22,"onopen"],[32,28,19,4],[32,31,19,31],[32,41,19,41,"event"],[32,46,19,31],[32,48,19,48],[33,0,20,8,"optionsRef"],[33,6,20,8,"optionsRef"],[33,16,20,18],[33,17,20,19,"current"],[33,24,20,8],[33,25,20,27,"onOpen"],[33,31,20,8],[33,35,20,37,"optionsRef"],[33,45,20,47],[33,46,20,48,"current"],[33,53,20,37],[33,54,20,56,"onOpen"],[33,60,20,37],[33,61,20,63,"event"],[33,66,20,37],[33,67,20,8],[34,0,21,8,"reconnectCount"],[34,6,21,8,"reconnectCount"],[34,20,21,22],[34,21,21,23,"current"],[34,28,21,8],[34,31,21,33],[34,32,21,8],[35,0,22,8,"setReadyState"],[35,6,22,8,"setReadyState"],[35,19,22,21],[35,20,22,22,"constants_1"],[35,31,22,33],[35,32,22,34,"ReadyState"],[35,42,22,22],[35,43,22,45,"OPEN"],[35,47,22,21],[35,48,22,8],[36,0,23,5],[36,5,19,4],[38,0,24,4,"webSocketInstance"],[38,4,24,4,"webSocketInstance"],[38,21,24,21],[38,22,24,22,"onclose"],[38,29,24,4],[38,32,24,32],[38,42,24,42,"event"],[38,47,24,32],[38,49,24,49],[39,0,25,8],[39,10,25,12,"_a"],[39,12,25,8],[39,14,25,16,"_b"],[39,16,25,8],[41,0,26,8,"optionsRef"],[41,6,26,8,"optionsRef"],[41,16,26,18],[41,17,26,19,"current"],[41,24,26,8],[41,25,26,27,"onClose"],[41,32,26,8],[41,36,26,38,"optionsRef"],[41,46,26,48],[41,47,26,49,"current"],[41,54,26,38],[41,55,26,57,"onClose"],[41,62,26,38],[41,63,26,65,"event"],[41,68,26,38],[41,69,26,8],[42,0,27,8,"setReadyState"],[42,6,27,8,"setReadyState"],[42,19,27,21],[42,20,27,22,"constants_1"],[42,31,27,33],[42,32,27,34,"ReadyState"],[42,42,27,22],[42,43,27,45,"CLOSED"],[42,49,27,21],[42,50,27,8],[44,0,28,8],[44,10,28,12,"optionsRef"],[44,20,28,22],[44,21,28,23,"current"],[44,28,28,12],[44,29,28,31,"shouldReconnect"],[44,44,28,12],[44,48,28,50,"optionsRef"],[44,58,28,60],[44,59,28,61,"current"],[44,66,28,50],[44,67,28,69,"shouldReconnect"],[44,82,28,50],[44,83,28,85,"event"],[44,88,28,50],[44,89,28,8],[44,91,28,93],[45,0,29,12],[45,12,29,16,"reconnectAttempts"],[45,29,29,33],[45,33,29,37,"_a"],[45,35,29,39],[45,38,29,42,"optionsRef"],[45,48,29,52],[45,49,29,53,"current"],[45,56,29,42],[45,57,29,61,"reconnectAttempts"],[45,74,29,37],[45,76,29,81,"_a"],[45,78,29,83],[45,83,29,88],[45,87,29,81],[45,91,29,96,"_a"],[45,93,29,98],[45,98,29,103],[45,103,29,108],[45,104,29,81],[45,107,29,112,"_a"],[45,109,29,81],[45,112,29,117,"constants_1"],[45,123,29,128],[45,124,29,129,"DEFAULT_RECONNECT_LIMIT"],[45,147,29,33],[45,148,29,12],[47,0,30,12],[47,12,30,16,"reconnectCount"],[47,26,30,30],[47,27,30,31,"current"],[47,34,30,16],[47,37,30,41,"reconnectAttempts"],[47,54,30,12],[47,56,30,60],[48,0,31,16,"reconnectTimeout"],[48,10,31,16,"reconnectTimeout"],[48,26,31,32],[48,29,31,35,"setTimeout"],[48,39,31,45],[48,40,31,46],[48,52,31,58],[49,0,32,20,"reconnectCount"],[49,12,32,20,"reconnectCount"],[49,26,32,34],[49,27,32,35,"current"],[49,34,32,20],[50,0,33,20,"reconnect"],[50,12,33,20,"reconnect"],[50,21,33,29],[51,0,34,17],[51,11,31,45],[51,14,34,20,"_b"],[51,16,34,22],[51,19,34,25,"optionsRef"],[51,29,34,35],[51,30,34,36,"current"],[51,37,34,25],[51,38,34,44,"reconnectInterval"],[51,55,34,20],[51,57,34,64,"_b"],[51,59,34,66],[51,64,34,71],[51,68,34,64],[51,72,34,79,"_b"],[51,74,34,81],[51,79,34,86],[51,84,34,91],[51,85,34,64],[51,88,34,95,"_b"],[51,90,34,64],[51,93,34,100,"constants_1"],[51,104,34,111],[51,105,34,112,"DEFAULT_RECONNECT_INTERVAL_MS"],[51,134,31,45],[51,136,31,16],[52,0,35,13],[52,9,30,12],[52,15,36,17],[53,0,37,16,"console"],[53,10,37,16,"console"],[53,17,37,23],[53,18,37,24,"error"],[53,23,37,16],[53,24,37,30],[53,55,37,61,"reconnectAttempts"],[53,72,37,30],[53,75,37,81],[53,86,37,16],[54,0,38,13],[55,0,39,9],[56,0,40,5],[56,5,24,4],[58,0,41,4,"webSocketInstance"],[58,4,41,4,"webSocketInstance"],[58,21,41,21],[58,22,41,22,"onerror"],[58,29,41,4],[58,32,41,32],[58,42,41,42,"error"],[58,47,41,32],[58,49,41,49],[59,0,42,8],[59,10,42,12,"_a"],[59,12,42,8],[59,14,42,16,"_b"],[59,16,42,8],[61,0,43,8,"optionsRef"],[61,6,43,8,"optionsRef"],[61,16,43,18],[61,17,43,19,"current"],[61,24,43,8],[61,25,43,27,"onError"],[61,32,43,8],[61,36,43,38,"optionsRef"],[61,46,43,48],[61,47,43,49,"current"],[61,54,43,38],[61,55,43,57,"onError"],[61,62,43,38],[61,63,43,65,"error"],[61,68,43,38],[61,69,43,8],[63,0,44,8],[63,10,44,12,"optionsRef"],[63,20,44,22],[63,21,44,23,"current"],[63,28,44,12],[63,29,44,31,"retryOnError"],[63,41,44,8],[63,43,44,45],[64,0,45,12],[64,12,45,16,"reconnectCount"],[64,26,45,30],[64,27,45,31,"current"],[64,34,45,16],[64,38,45,42,"_a"],[64,40,45,44],[64,43,45,47,"optionsRef"],[64,53,45,57],[64,54,45,58,"current"],[64,61,45,47],[64,62,45,66,"reconnectAttempts"],[64,79,45,42],[64,81,45,86,"_a"],[64,83,45,88],[64,88,45,93],[64,92,45,86],[64,96,45,101,"_a"],[64,98,45,103],[64,103,45,108],[64,108,45,113],[64,109,45,86],[64,112,45,117,"_a"],[64,114,45,86],[64,117,45,122,"constants_1"],[64,128,45,133],[64,129,45,134,"DEFAULT_RECONNECT_LIMIT"],[64,152,45,16],[64,153,45,12],[64,155,45,161],[65,0,46,16,"reconnectTimeout"],[65,10,46,16,"reconnectTimeout"],[65,26,46,32],[65,29,46,35,"setTimeout"],[65,39,46,45],[65,40,46,46],[65,52,46,58],[66,0,47,20,"reconnectCount"],[66,12,47,20,"reconnectCount"],[66,26,47,34],[66,27,47,35,"current"],[66,34,47,20],[67,0,48,20,"reconnect"],[67,12,48,20,"reconnect"],[67,21,48,29],[68,0,49,17],[68,11,46,45],[68,14,49,20,"_b"],[68,16,49,22],[68,19,49,25,"optionsRef"],[68,29,49,35],[68,30,49,36,"current"],[68,37,49,25],[68,38,49,44,"reconnectInterval"],[68,55,49,20],[68,57,49,64,"_b"],[68,59,49,66],[68,64,49,71],[68,68,49,64],[68,72,49,79,"_b"],[68,74,49,81],[68,79,49,86],[68,84,49,91],[68,85,49,64],[68,88,49,95,"_b"],[68,90,49,64],[68,93,49,100,"constants_1"],[68,104,49,111],[68,105,49,112,"DEFAULT_RECONNECT_INTERVAL_MS"],[68,134,46,45],[68,136,46,16],[69,0,50,13],[70,0,51,9],[71,0,52,5],[71,5,41,4],[73,0,53,4],[73,11,53,11],[73,23,53,23],[74,0,54,8,"setReadyState"],[74,6,54,8,"setReadyState"],[74,19,54,21],[74,20,54,22,"constants_1"],[74,31,54,33],[74,32,54,34,"ReadyState"],[74,42,54,22],[74,43,54,45,"CLOSING"],[74,50,54,21],[74,51,54,8],[75,0,55,8],[75,10,55,12,"reconnectTimeout"],[75,26,55,8],[75,28,56,12,"clearTimeout"],[75,40,56,24],[75,41,56,25,"reconnectTimeout"],[75,57,56,24],[75,58,56,12],[76,0,57,8,"webSocketInstance"],[76,6,57,8,"webSocketInstance"],[76,23,57,25],[76,24,57,26,"close"],[76,29,57,8],[77,0,58,8],[77,10,58,12,"interval"],[77,18,58,8],[77,20,59,12,"clearInterval"],[77,33,59,25],[77,34,59,26,"interval"],[77,42,59,25],[77,43,59,12],[78,0,60,5],[78,5,53,4],[79,0,61,1],[79,3,5,0]],"functionMap":{"names":["<global>","exports.attachListeners","webSocketInstance.onmessage","webSocketInstance.onopen","webSocketInstance.onclose","setTimeout$argument_0","webSocketInstance.onerror","<anonymous>"],"mappings":"AAA;0BCI;kCCO;KDM;+BEC;KFI;gCGC;8CCO;iBDG;KHM;gCKC;8CDK;iBCG;KLG;WMC;KNO;CDC"}},"type":"js/module"}]}